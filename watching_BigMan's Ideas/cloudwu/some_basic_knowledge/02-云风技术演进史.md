# 云风技术演进史:从 ejoy2d 到 Ant Engine

## 👤 云风是谁?

**云风**(cloudwu)是中国游戏开发界的传奇程序员:
- 📖 《游戏之旅》作者
- 🎮 《大话西游2》《梦幻西游》核心开发者
- 🌟 开源项目:skynet, ejoy2d, Soluna, Ant Engine
- 📝 技术博客:https://blog.codingnow.com/

**为什么学习云风的技术?**
- ✅ 代码质量极高
- ✅ 设计理念清晰
- ✅ 适合中国开发者学习
- ✅ 从2D到3D,从客户端到服务器,技术全面

---

## 📅 技术演进时间线

```
2012          2014      2018           2025
  ↓             ↓         ↓              ↓
ejoy2d  →   skynet  →  Ant Engine  →  Soluna
(2D引擎)   (服务器)    (3D引擎)      (新2D引擎)
```

### 核心项目对比

| 项目 | 类型 | 开发时间 | 状态 | 定位 |
|------|------|---------|------|------|
| **ejoy2d** | 2D引擎 | 2012 | 已停止 | 早期2D手游引擎 |
| **skynet** | 服务器 | 2014 | 活跃 | 游戏服务器框架 |
| **Ant Engine** | 3D引擎 | 2018+ | 活跃 | 类Unity商业引擎 |
| **Soluna** | 2D引擎 | 2025 | 新项目 | 现代化2D引擎 |

---

## 🎨 ejoy2d (2012-2016)

### 项目简介

**ejoy2d** 是云风早期开发的2D游戏引擎,用于手机游戏开发。

### 技术特点

```
架构:
  ┌─────────────┐
  │  Lua 脚本   │  游戏逻辑
  └─────────────┘
         ↕
  ┌─────────────┐
  │  C 渲染层   │  OpenGL ES 2.0
  └─────────────┘
```

| 特性 | 说明 |
|------|------|
| **渲染** | OpenGL ES 2.0 |
| **脚本** | Lua 5.2 |
| **平台** | iOS, Android |
| **特色** | Sprite批量渲染,粒子系统 |

### 核心技术

1. **Sprite 系统**
   ```lua
   -- ejoy2d 示例
   sprite = sprite.load("player")
   sprite:play("walk")
   sprite:draw(x, y)
   ```

2. **批量渲染**
   - 将多个Sprite合并到一个draw call
   - 使用图集(Texture Atlas)优化

3. **粒子系统**
   - 用于火焰、爆炸等效果

### 为什么停止维护?

> "ejoy2d 设计时针对手机平台,但随着技术发展,一些设计决策已经过时。"

**问题**:
- ❌ 过度优化手机性能(现在手机已经很强)
- ❌ OpenGL ES 2.0 过时(现在有Vulkan/Metal)
- ❌ 架构不够灵活

---

## 🚀 skynet (2014-至今)

### 项目简介

**skynet** 是云风开发的**游戏服务器框架**,基于Actor模型。

### 与游戏客户端的关系

```
客户端(Unity/Soluna)
        ↕ 网络通信
服务器(skynet)
        ↕
    数据库/Redis
```

**skynet 不是游戏引擎!**它是服务器框架,负责:
- ✅ 处理玩家登录
- ✅ 同步游戏状态
- ✅ 保存玩家数据
- ✅ 实现游戏逻辑(服务端)

### 架构设计

```
┌──────────────────────────────────┐
│  Lua Services (Actor模型)        │
│  • Login Service                 │
│  • Game Logic Service            │
│  • Database Service              │
└──────────────────────────────────┘
         ↕ 消息传递
┌──────────────────────────────────┐
│  C Core (调度器)                  │
│  • 多线程工作队列                 │
│  • 消息分发                       │
└──────────────────────────────────┘
```

### 核心概念

#### Actor 模型

```lua
-- 每个Service是一个Actor
local SERVICE = {}

-- 接收消息
function SERVICE.login(player_id, password)
    -- 验证登录
    return true
end

-- 发送消息到其他Service
skynet.send(db_service, "lua", "save_player", player_data)
```

#### 消息传递

```
Player Service      Database Service
      ↓ send              ↓
   消息队列
      ↓ dispatch          ↓
   处理消息
```

### 典型应用场景

| 游戏类型 | skynet 作用 |
|---------|------------|
| **MMO** | 处理大量玩家,场景管理 |
| **卡牌游戏** | 战斗逻辑,抽卡系统 |
| **策略游戏** | 回合计算,同步 |

### 学习价值

1. **理解Actor模型** - 与ltask类似
2. **高并发架构** - 如何处理百万玩家
3. **Lua实践** - 大型Lua项目经验

### 与 Soluna 的关系

```
Soluna(客户端)  ←→  skynet(服务器)
   ↓                    ↓
 ltask               Actor模型
 (相同设计理念!)
```

---

## 🏛️ Ant Engine (2018-至今)

### 项目简介

**Ant Engine** 是云风目前正在开发的**3D游戏引擎**,定位类似Unity。

### 与其他项目的关系

```
Ant Engine = Soluna(2D部分) + 3D渲染 + 编辑器

Soluna ⊂ Ant Engine
(Soluna是Ant的简化版)
```

### 技术栈

| 模块 | 技术 |
|------|------|
| **图形API** | BGFX(多后端) |
| **物理** | 自研 |
| **脚本** | Lua + ltask |
| **编辑器** | 开发中 |

### 核心特点

1. **ECS 架构**(Entity Component System)
   ```lua
   -- 创建实体
   entity = world.create_entity()

   -- 添加组件
   entity:add_component("transform", {x=0, y=0, z=0})
   entity:add_component("mesh_renderer", {mesh="cube"})
   ```

2. **虚拟文件系统**(VFS)
   - 统一管理资源
   - 支持Mod加载

3. **数据驱动设计**
   - 游戏数据与代码分离
   - 便于策划修改

### 为什么从 Ant 简化出 Soluna?

云风在 Discussion #1 中说:

> "做2D策略游戏不需要3D的复杂性。ANT专注3D,增加了不必要的开销。"

**Soluna的简化**:
- ❌ 移除VFS(直接读本地文件)
- ❌ 移除3D渲染
- ✅ 保留ltask多线程
- ✅ 改用Sokol(更轻量)

---

## 🌙 Soluna (2025-至今)

### 项目简介

**Soluna** 是云风最新的**2D游戏引擎**,吸取了ejoy2d和Ant的经验。

### 与 ejoy2d 的对比

| 特性 | ejoy2d | Soluna |
|------|--------|--------|
| **图形API** | OpenGL ES 2.0 | Sokol(多后端) |
| **多线程** | 无 | ltask |
| **纹理管理** | 手动 | 运行时打包 |
| **平台** | 移动为主 | PC为主(可扩展) |
| **设计理念** | 优化性能 | 优化工作流 |

### 技术进步

```
ejoy2d (2012)               Soluna (2025)
     ↓                           ↓
单线程                        多线程(ltask)
     ↓                           ↓
OpenGL ES 2.0               Sokol(Vulkan/Metal)
     ↓                           ↓
手动图集                     运行时打包
     ↓                           ↓
手机优化                     PC优先(工作流优化)
```

### 学习价值

1. **现代2D引擎设计** - 最新理念
2. **Sokol实践** - 轻量图形API
3. **ltask应用** - 多线程Lua
4. **简洁代码** - 易于学习

---

## 🔄 技术演进的核心逻辑

### 云风的设计哲学

1. **简洁优于复杂**
   ```
   ejoy2d → 过度优化 → 复杂
   Soluna → 简化 → 易维护
   ```

2. **实用主义**
   ```
   需要3D → 开发Ant
   只需2D → 简化为Soluna
   ```

3. **技术选型灵活**
   ```
   移动时代 → OpenGL ES
   现代PC → Sokol(多后端)
   ```

### 从项目中学到的教训

| 项目 | 教训 | 在Soluna中的体现 |
|------|------|-----------------|
| **ejoy2d** | 过度优化导致复杂 | 简化设计 |
| **Ant** | 3D带来不必要开销 | 专注2D |
| **skynet** | Actor模型优秀 | 采用ltask |

---

## 📚 学习路径建议

### 路径1:从简单到复杂

```
1. Soluna (2D,简单)
   ↓ 学习2D渲染、Sokol
2. skynet (服务器)
   ↓ 学习Actor模型、高并发
3. Ant Engine (3D,复杂)
   ↓ 学习3D渲染、ECS
```

### 路径2:按兴趣方向

**客户端开发**:
```
Soluna → Ant Engine
```

**服务器开发**:
```
skynet → 研究Actor模型
```

**全栈开发**:
```
Soluna(客户端) + skynet(服务器)
```

### 路径3:时间顺序(了解演进)

```
ejoy2d(看设计) → skynet(深入学) → Ant(了解) → Soluna(实践)
```

---

## 🎯 各项目适合的学习目标

### Soluna 适合学习

✅ 2D渲染基础
✅ Sokol使用
✅ ltask多线程
✅ 引擎架构入门
✅ Lua实践

**适合人群**: 初学者、2D游戏开发者

### skynet 适合学习

✅ Actor模型
✅ 高并发架构
✅ 服务器开发
✅ Lua进阶
✅ 消息传递

**适合人群**: 后端开发者、有并发需求的项目

### Ant Engine 适合学习

✅ 3D渲染
✅ ECS架构
✅ 复杂引擎设计
✅ 数据驱动
✅ 编辑器开发

**适合人群**: 有经验的开发者、想做3D游戏

---

## 💡 常见问题解答

### Q1: Soluna 和 ejoy2d 有什么关系?

**A**: Soluna 是 ejoy2d 的精神续作,但完全重写。

- ejoy2d: 2012年,针对手机
- Soluna: 2025年,针对PC,技术更现代

### Q2: Ant Engine 是商业引擎吗?

**A**: 目前是ejoy团队内部使用,未来可能开源或商业化。

### Q3: skynet 能用于Web应用吗?

**A**: 可以,但主要为游戏服务器设计。Web应用有更好的选择(Node.js/Go)。

### Q4: 我应该先学哪个?

**A**:
- 想做游戏 → Soluna
- 想做服务器 → skynet
- 想了解全貌 → 都看一点

---

## 🔗 相关资源

### 项目地址

- **Soluna**: https://github.com/cloudwu/soluna
- **skynet**: https://github.com/cloudwu/skynet
- **Ant Engine**: https://github.com/ejoy/ant
- **ejoy2d**: https://github.com/ejoy/ejoy2d (已停止)

### 云风Blog关键文章

- [2D渲染管线设计](https://blog.codingnow.com/2025/02/2d_pipeline_design.html)
- [skynet设计综述](https://blog.codingnow.com/2012/09/the_design_of_skynet.html)

---

## 📊 总结对比表

| 项目 | 年代 | 类型 | 复杂度 | 推荐学习优先级 |
|------|------|------|--------|---------------|
| **Soluna** | 2025 | 2D引擎 | ⭐⭐ | 🥇 第一优先(新手友好) |
| **skynet** | 2014 | 服务器 | ⭐⭐⭐ | 🥈 第二优先(服务器方向) |
| **Ant** | 2018 | 3D引擎 | ⭐⭐⭐⭐ | 🥉 第三优先(有经验后) |
| **ejoy2d** | 2012 | 2D引擎 | ⭐⭐ | 📚 了解历史即可 |

---

**下一步**: 阅读 [图形API详解](./03-图形API详解.md) 了解OpenGL/Vulkan等底层技术
