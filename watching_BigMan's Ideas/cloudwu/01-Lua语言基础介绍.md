# Lua è¯­è¨€åŸºç¡€ä»‹ç»

## ğŸ“š ä»€ä¹ˆæ˜¯ Lua?

**Lua** æ˜¯ä¸€ç§è½»é‡çº§ã€é«˜æ•ˆçš„è„šæœ¬è¯­è¨€,ä¸“ä¸ºåµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­è€Œè®¾è®¡ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **è½»é‡çº§** | æ•´ä¸ªè§£é‡Šå™¨åªæœ‰çº¦ 200KB |
| **å¿«é€Ÿ** | è„šæœ¬è¯­è¨€ä¸­æ€§èƒ½æœ€å¥½çš„ä¹‹ä¸€ |
| **å¯åµŒå…¥** | è®¾è®¡ç›®æ ‡å°±æ˜¯åµŒå…¥åˆ° C/C++ ç¨‹åºä¸­ |
| **ç®€å•** | è¯­æ³•ç®€æ´,å®¹æ˜“å­¦ä¹  |
| **åŠ¨æ€ç±»å‹** | å˜é‡ä¸éœ€è¦å£°æ˜ç±»å‹ |

### åå­—ç”±æ¥

**Lua** åœ¨è‘¡è„ç‰™è¯­ä¸­æ„ä¸º"æœˆäº®"ğŸŒ™,ç”±å·´è¥¿é‡Œçº¦çƒ­å†…å¢å¤©ä¸»æ•™å¤§å­¦çš„å›¢é˜Ÿåœ¨ 1993 å¹´åˆ›å»ºã€‚

---

## ğŸ® Lua åœ¨æ¸¸æˆå¼€å‘ä¸­çš„åº”ç”¨

Lua æ˜¯æ¸¸æˆå¼€å‘ä¸­**æœ€æµè¡Œçš„è„šæœ¬è¯­è¨€**ä¹‹ä¸€!

### è‘—åæ¸¸æˆæ¡ˆä¾‹

| æ¸¸æˆ | ç”¨é€” |
|------|------|
| **é­”å…½ä¸–ç•Œ (World of Warcraft)** | æ’ä»¶ç³»ç»Ÿ(UI Addons) |
| **æ„¤æ€’çš„å°é¸Ÿ** | æ¸¸æˆé€»è¾‘ |
| **Roblox** | æ¸¸æˆè„šæœ¬ |
| **Cocos2d-x** | æ¸¸æˆå¼•æ“è„šæœ¬å±‚ |
| **ç‹è€…è£è€€** | æ¸¸æˆé€»è¾‘(åŸºäºäº‘é£çš„ skynet) |

### ä¸ºä»€ä¹ˆæ¸¸æˆå¼€å‘å–œæ¬¢ Lua?

```
C/C++ (å¼•æ“å±‚)
  â†“ åµŒå…¥
Lua (æ¸¸æˆé€»è¾‘å±‚)

ä¼˜åŠ¿:
âœ… çƒ­æ›´æ–° - æ— éœ€é‡æ–°ç¼–è¯‘
âœ… å¿«é€Ÿè¿­ä»£ - ä¿®æ”¹ä»£ç ç«‹å³ç”Ÿæ•ˆ
âœ… å®‰å…¨ - è„šæœ¬é”™è¯¯ä¸ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ
âœ… æ˜“å­¦ - ç­–åˆ’/è®¾è®¡å¸ˆä¹Ÿèƒ½å†™è„šæœ¬
```

---

## ğŸ“ Lua åŸºç¡€è¯­æ³•

### 1. Hello World

```lua
-- è¿™æ˜¯æ³¨é‡Š(å•è¡Œ)

--[[
    è¿™æ˜¯å¤šè¡Œæ³¨é‡Š
    å¯ä»¥å†™å¾ˆå¤šè¡Œ
]]

-- è¾“å‡º Hello World
print("Hello, World!")
```

### 2. å˜é‡å’Œæ•°æ®ç±»å‹

```lua
-- æ•°å­—(Number)
local x = 10
local y = 3.14

-- å­—ç¬¦ä¸²(String)
local name = "äº‘é£"
local message = 'Hello'

-- å¸ƒå°”å€¼(Boolean)
local isReady = true
local isDone = false

-- Nil(ç©ºå€¼)
local empty = nil

-- è¡¨(Table,Lua çš„æ ¸å¿ƒæ•°æ®ç»“æ„)
local player = {
    name = "Hero",
    hp = 100,
    level = 5
}

-- å‡½æ•°(Function)
local function greet(name)
    print("ä½ å¥½, " .. name)
end
```

### 3. æ§åˆ¶ç»“æ„

```lua
-- if-else
if hp > 50 then
    print("å¥åº·")
elseif hp > 20 then
    print("å—ä¼¤")
else
    print("å±é™©")
end

-- for å¾ªç¯
for i = 1, 10 do
    print(i)
end

-- while å¾ªç¯
local count = 0
while count < 5 do
    count = count + 1
    print(count)
end
```

### 4. è¡¨(Table)- Lua æœ€å¼ºå¤§çš„æ•°æ®ç»“æ„

```lua
-- æ•°ç»„å½¢å¼(ç´¢å¼•ä» 1 å¼€å§‹!)
local fruits = {"apple", "banana", "orange"}
print(fruits[1])  -- è¾“å‡º: apple

-- å­—å…¸å½¢å¼
local player = {
    name = "Hero",
    hp = 100,
    attack = function(self, target)
        print(self.name .. " æ”»å‡» " .. target)
    end
}

player:attack("æ€ªç‰©")  -- è¾“å‡º: Hero æ”»å‡» æ€ªç‰©

-- éå†è¡¨
for key, value in pairs(player) do
    print(key, value)
end
```

### 5. å‡½æ•°

```lua
-- åŸºç¡€å‡½æ•°
function add(a, b)
    return a + b
end

-- å¤šè¿”å›å€¼
function minmax(a, b)
    if a < b then
        return a, b
    else
        return b, a
    end
end

local min, max = minmax(10, 5)
print(min, max)  -- è¾“å‡º: 5 10

-- åŒ¿åå‡½æ•°
local square = function(x)
    return x * x
end

-- é—­åŒ…
function counter()
    local count = 0
    return function()
        count = count + 1
        return count
    end
end

local c = counter()
print(c())  -- 1
print(c())  -- 2
```

---

## ğŸ”§ Lua ä¸ C/C++ äº¤äº’

### ä¸ºä»€ä¹ˆéœ€è¦åµŒå…¥?

```
æ¸¸æˆæ¶æ„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lua è„šæœ¬å±‚(æ¸¸æˆé€»è¾‘)            â”‚
â”‚  - å…³å¡è„šæœ¬                      â”‚
â”‚  - AI è¡Œä¸º                       â”‚
â”‚  - ä»»åŠ¡ç³»ç»Ÿ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘â†“ C API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  C/C++ å¼•æ“å±‚(æ€§èƒ½å…³é”®éƒ¨åˆ†)      â”‚
â”‚  - æ¸²æŸ“                          â”‚
â”‚  - ç‰©ç†                          â”‚
â”‚  - ç½‘ç»œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### C è°ƒç”¨ Lua ç¤ºä¾‹

```c
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>

int main() {
    // 1. åˆ›å»º Lua è™šæ‹Ÿæœº
    lua_State *L = luaL_newstate();

    // 2. åŠ è½½æ ‡å‡†åº“
    luaL_openlibs(L);

    // 3. æ‰§è¡Œ Lua ä»£ç 
    luaL_dostring(L, "print('Hello from Lua!')");

    // 4. è°ƒç”¨ Lua å‡½æ•°
    luaL_dostring(L, "function add(a, b) return a + b end");

    lua_getglobal(L, "add");      // è·å–å‡½æ•°
    lua_pushnumber(L, 10);        // å‹å…¥å‚æ•° 1
    lua_pushnumber(L, 20);        // å‹å…¥å‚æ•° 2
    lua_call(L, 2, 1);            // è°ƒç”¨(2 ä¸ªå‚æ•°, 1 ä¸ªè¿”å›å€¼)

    double result = lua_tonumber(L, -1);  // è·å–ç»“æœ
    printf("Result: %f\n", result);       // è¾“å‡º: 30

    // 5. å…³é—­è™šæ‹Ÿæœº
    lua_close(L);
    return 0;
}
```

### Lua è°ƒç”¨ C å‡½æ•°

```c
// C å‡½æ•°(éœ€è¦ç¬¦åˆ lua_CFunction ç­¾å)
static int c_add(lua_State *L) {
    double a = lua_tonumber(L, 1);  // è·å–å‚æ•° 1
    double b = lua_tonumber(L, 2);  // è·å–å‚æ•° 2
    lua_pushnumber(L, a + b);       // å‹å…¥ç»“æœ
    return 1;                       // è¿”å›å€¼æ•°é‡
}

int main() {
    lua_State *L = luaL_newstate();
    luaL_openlibs(L);

    // æ³¨å†Œ C å‡½æ•°åˆ° Lua
    lua_register(L, "c_add", c_add);

    // åœ¨ Lua ä¸­è°ƒç”¨
    luaL_dostring(L, "result = c_add(5, 3); print(result)");

    lua_close(L);
    return 0;
}
```

---

## ğŸš€ Lua çš„ä¼˜åŠ¿ä¸åŠ£åŠ¿

### âœ… ä¼˜åŠ¿

1. **æå…¶è½»é‡**
   - æºç åªæœ‰å‡ ä¸‡è¡Œ
   - ç¼–è¯‘ååªæœ‰ 200KB å·¦å³
   - å†…å­˜å ç”¨æå°

2. **æ€§èƒ½ä¼˜ç§€**
   - ä½¿ç”¨ LuaJIT å¯ä»¥æ¥è¿‘ C çš„æ€§èƒ½
   - å­—èŠ‚ç è§£é‡Šæ‰§è¡Œé€Ÿåº¦å¿«

3. **åµŒå…¥å‹å¥½**
   - C API è®¾è®¡ä¼˜é›…
   - æ ˆå¼äº¤äº’æ¨¡å‹ç®€å•æ˜äº†
   - ä¸ C/C++ æ— ç¼é›†æˆ

4. **è¯­æ³•ç®€æ´**
   - å­¦ä¹ æ›²çº¿å¹³ç¼“
   - ä»£ç å¯è¯»æ€§å¥½

5. **è¡¨ç»“æ„å¼ºå¤§**
   - ä¸€ç§æ•°æ®ç»“æ„å®ç°æ•°ç»„ã€å­—å…¸ã€å¯¹è±¡
   - å…ƒè¡¨(Metatable)æä¾›å¼ºå¤§çš„å…ƒç¼–ç¨‹èƒ½åŠ›

### âŒ åŠ£åŠ¿

1. **ç´¢å¼•ä» 1 å¼€å§‹**
   ```lua
   local arr = {10, 20, 30}
   print(arr[1])  -- è¾“å‡º 10(ä¸æ˜¯ 0!)
   ```
   - å¯¹ä¹ æƒ¯ 0 ç´¢å¼•çš„ç¨‹åºå‘˜ä¸å‹å¥½

2. **å…¨å±€å˜é‡é»˜è®¤**
   ```lua
   x = 10  -- å…¨å±€å˜é‡
   local y = 20  -- å±€éƒ¨å˜é‡
   ```
   - å®¹æ˜“é€ æˆå‘½åå†²çª
   - éœ€è¦å…»æˆå†™ `local` çš„ä¹ æƒ¯

3. **æ ‡å‡†åº“ç®€é™‹**
   - æ²¡æœ‰æ­£åˆ™è¡¨è¾¾å¼
   - æ²¡æœ‰çº¿ç¨‹/åç¨‹æ ‡å‡†åº“
   - æ–‡ä»¶æ“ä½œåŠŸèƒ½æœ‰é™

4. **é”™è¯¯å¤„ç†å¼±**
   - æ²¡æœ‰å¼‚å¸¸æœºåˆ¶(try-catch)
   - åªæœ‰ pcall/xpcall

5. **å•çº¿ç¨‹**
   - Lua è™šæ‹Ÿæœºæœ¬èº«æ˜¯å•çº¿ç¨‹çš„
   - éœ€è¦é€šè¿‡å¤–éƒ¨åº“(å¦‚ ltask)å®ç°å¤šçº¿ç¨‹

---

## ğŸ› ï¸ Lua åœ¨ Soluna é¡¹ç›®ä¸­çš„åº”ç”¨

### Soluna é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lua æ¸¸æˆè„šæœ¬                    â”‚
â”‚  - æ¸¸æˆé€»è¾‘                      â”‚
â”‚  - å…³å¡æ•°æ®                      â”‚
â”‚  - UI äº¤äº’                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ltask (å¤šçº¿ç¨‹ Lua)              â”‚
â”‚  - å¤šçº¿ç¨‹ä»»åŠ¡è°ƒåº¦                â”‚
â”‚  - æ¸²æŸ“çº¿ç¨‹ + é€»è¾‘çº¿ç¨‹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sokol (C å›¾å½¢åº“)                â”‚
â”‚  - OpenGL/Metal/D3D11 æŠ½è±¡       â”‚
â”‚  - ç€è‰²å™¨ç®¡ç†                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### lua2c æŠ€æœ¯

Soluna ä½¿ç”¨ **lua2c** å°† Lua ä»£ç åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­:

```bash
# ä¼ ç»Ÿæ–¹å¼:éœ€è¦åˆ†å‘ .lua æ–‡ä»¶
game.exe
game_script.lua  â† éœ€è¦ä¸€èµ·æ‰“åŒ…

# lua2c æ–¹å¼:Lua ä»£ç ç¼–è¯‘è¿›å¯æ‰§è¡Œæ–‡ä»¶
game.exe  â† åŒ…å«äº†æ‰€æœ‰ Lua ä»£ç 
```

**ä¼˜åŠ¿**:
- âœ… ä¸éœ€è¦åˆ†å‘ .lua æ–‡ä»¶
- âœ… é˜²æ­¢è„šæœ¬è¢«ä¿®æ”¹
- âœ… å¯åŠ¨é€Ÿåº¦æ›´å¿«
- âœ… éƒ¨ç½²æ›´ç®€å•

---

## ğŸ“– å­¦ä¹ èµ„æº

### å®˜æ–¹èµ„æº

- **å®˜ç½‘**: https://www.lua.org/
- **åœ¨çº¿æ‰‹å†Œ**: https://www.lua.org/manual/5.4/
- **å‚è€ƒä¹¦**: *Programming in Lua* (PIL)

### ä¸­æ–‡èµ„æº

- **äº‘é£çš„ BLOG**: https://blog.codingnow.com/ (å¤§é‡ Lua å®æˆ˜ç»éªŒ)
- **Lua ä¸­æ–‡ç¤¾åŒº**: https://www.lua.org.cn/

### å®æˆ˜é¡¹ç›®

- **skynet**: äº‘é£å¼€å‘çš„ Lua æœåŠ¡å™¨æ¡†æ¶
- **soluna**: æœ¬é¡¹ç›®,2D æ¸¸æˆå¼•æ“

---

## ğŸ¯ å¿«é€Ÿä¸Šæ‰‹ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•è®¡ç®—å™¨

```lua
-- calculator.lua
local function add(a, b) return a + b end
local function sub(a, b) return a - b end
local function mul(a, b) return a * b end
local function div(a, b)
    if b == 0 then
        return nil, "é™¤æ•°ä¸èƒ½ä¸º 0"
    end
    return a / b
end

-- æµ‹è¯•
print("10 + 5 =", add(10, 5))      -- 15
print("10 - 5 =", sub(10, 5))      -- 5
print("10 * 5 =", mul(10, 5))      -- 50

local result, err = div(10, 0)
if result then
    print("10 / 0 =", result)
else
    print("é”™è¯¯:", err)
end
```

### ç¤ºä¾‹ 2: ç®€å•æ¸¸æˆè§’è‰²

```lua
-- player.lua

-- å®šä¹‰ç©å®¶ç±»
Player = {}
Player.__index = Player

-- æ„é€ å‡½æ•°
function Player:new(name, hp)
    local obj = {
        name = name,
        hp = hp,
        max_hp = hp,
        level = 1
    }
    setmetatable(obj, Player)
    return obj
end

-- æ–¹æ³•
function Player:attack(target)
    local damage = math.random(10, 20)
    print(self.name .. " æ”»å‡» " .. target.name .. ", é€ æˆ " .. damage .. " ç‚¹ä¼¤å®³")
    target:take_damage(damage)
end

function Player:take_damage(damage)
    self.hp = self.hp - damage
    print(self.name .. " å—åˆ° " .. damage .. " ç‚¹ä¼¤å®³, å‰©ä½™ HP: " .. self.hp)

    if self.hp <= 0 then
        print(self.name .. " å·²æ­»äº¡!")
    end
end

function Player:heal(amount)
    self.hp = math.min(self.hp + amount, self.max_hp)
    print(self.name .. " æ¢å¤ " .. amount .. " HP, å½“å‰ HP: " .. self.hp)
end

-- ä½¿ç”¨ç¤ºä¾‹
local hero = Player:new("å‹‡è€…", 100)
local monster = Player:new("å²è±å§†", 50)

hero:attack(monster)
monster:attack(hero)
hero:heal(20)
```

---

## ğŸ” Lua vs å…¶ä»–è„šæœ¬è¯­è¨€

| ç‰¹æ€§ | Lua | Python | JavaScript |
|------|-----|--------|------------|
| **å¤§å°** | æå°(200KB) | å¤§(20MB+) | ä¸­ç­‰ |
| **é€Ÿåº¦** | éå¸¸å¿«(LuaJIT) | è¾ƒæ…¢ | å¿«(V8/JIT) |
| **åµŒå…¥æ€§** | æä½³ | ä¸€èˆ¬ | ä¸€èˆ¬ |
| **æ ‡å‡†åº“** | ç®€é™‹ | ä¸°å¯Œ | ä¸°å¯Œ |
| **åº”ç”¨åœºæ™¯** | æ¸¸æˆ/åµŒå…¥å¼ | é€šç”¨ç¼–ç¨‹ | Web/Node.js |
| **ç´¢å¼•èµ·å§‹** | 1 | 0 | 0 |

---

## ğŸ’¡ æ€»ç»“

### Lua çš„æ ¸å¿ƒä»·å€¼

1. **åµŒå…¥å¼è„šæœ¬ä¹‹ç‹** - ä¸“ä¸ºåµŒå…¥è®¾è®¡
2. **æ¸¸æˆå¼€å‘é¦–é€‰** - å¤§é‡æˆåŠŸæ¡ˆä¾‹
3. **è½»é‡é«˜æ•ˆ** - æå°çš„ä½“ç§¯,æå¿«çš„é€Ÿåº¦
4. **ç®€å•ä¼˜é›…** - è¯­æ³•ç®€æ´,æ˜“äºå­¦ä¹ 

### é€‚åˆä½¿ç”¨ Lua çš„åœºæ™¯

âœ… æ¸¸æˆè„šæœ¬å±‚
âœ… åµŒå…¥å¼ç³»ç»Ÿé…ç½®
âœ… éœ€è¦çƒ­æ›´æ–°çš„åº”ç”¨
âœ… æ€§èƒ½æ•æ„Ÿçš„è„šæœ¬éœ€æ±‚

### ä¸é€‚åˆä½¿ç”¨ Lua çš„åœºæ™¯

âŒ éœ€è¦ä¸°å¯Œæ ‡å‡†åº“çš„åº”ç”¨
âŒ ç‹¬ç«‹çš„å¤§å‹åº”ç”¨ç¨‹åº
âŒ éœ€è¦å¼ºç±»å‹æ£€æŸ¥çš„é¡¹ç›®

---

## ä¸‹ä¸€æ­¥å­¦ä¹ 

- ğŸ“„ [Sokol å›¾å½¢åº“ä»‹ç»](./02-Sokolå›¾å½¢åº“ä»‹ç».md)
- ğŸ“„ [ltask å¤šçº¿ç¨‹æ¡†æ¶](./03-ltaskå¤šçº¿ç¨‹æ¡†æ¶.md)
- ğŸ“„ [2D æ¸¸æˆå¼•æ“æ¶æ„](./04-2Dæ¸¸æˆå¼•æ“æ¶æ„.md)
