# 包管理工具对照手册:Void Linux vs Arch Linux

## 核心功能对比

| 功能 | Void Linux (xbps) | Arch Linux (pacman) |
|------|-------------------|---------------------|
| 包管理器 | xbps-query | pacman |
| 查找文件所属包 | `xbps-query -o <file>` | `pacman -Qo <file>` |
| 列出包的文件 | `xbps-query -f <pkg>` | `pacman -Ql <pkg>` |
| 搜索包 | `xbps-query -Rs <pattern>` | `pacman -Ss <pattern>` |
| 查看依赖 | `xbps-query -x <pkg>` | `pactree -r <pkg>` |


## 一、查询库文件所属包


### Void Linux


```bash
# 查询文件所属包(需要完整路径)
xbps-query -o /usr/lib/libffi.so
# 输出:libffi-3.4.4_1: /usr/lib/libffi.so.8.1.2 (link)
```


### Arch Linux
```bash
# 查询文件所属包(需要完整路径)
pacman -Qo /usr/lib/libffi.so
# 输出:/usr/lib/libffi.so 由 libffi 3.5.2-1 所拥有

# 只提供文件名会报错
pacman -Qo libffi.so
# 错误:没有软件包拥有 libffi.so
```

**关键区别:**
- 两者都需要**完整的文件路径**
- 只提供文件名都无法工作

## 二、查询文件名对应的包(不需要完整路径)

### Void Linux
```bash
# xbps 没有直接支持,需要结合其他工具
```

### Arch Linux
```bash
# 使用 pkgfile 工具
pkgfile libffi.so

# 输出:
# core/libffi
# extra/intel-oneapi-basekit
# extra/intel-oneapi-dpcpp-debugger
# multilib/lib32-libffi
```

**Arch Linux 优势:**
- `pkgfile` 可以只用文件名搜索
- 会搜索所有仓库(包括未安装的包)
- 显示哪些包包含该文件

## 三、查看包的所有文件

### Void Linux
```bash
# 列出包的所有文件
xbps-query -f libffi

# 只显示 .so 库文件
xbps-query -f libffi | grep '\.so'
```

### Arch Linux
```bash
# 列出包的所有文件
pacman -Ql libffi

# 只显示 .so 库文件
pacman -Ql libffi | grep '\.so'

# 示例输出:
# libffi /usr/lib/libffi.so
# libffi /usr/lib/libffi.so.8
# libffi /usr/lib/libffi.so.8.1.4
```

## 四、搜索包

### Void Linux
```bash
# 搜索远程仓库
xbps-query -Rs libffi

# 搜索本地已安装
xbps-query -s libffi
```

### Arch Linux
```bash
# 搜索远程仓库
pacman -Ss libffi

# 搜索本地已安装
pacman -Qs libffi
```

## 五、查看依赖关系

### Void Linux
```bash
# 查看哪些包依赖此包(反向依赖)
xbps-query -x libffi

# 查看此包依赖哪些包
xbps-query -X libffi
```

### Arch Linux

```bash
# 查看包信息(包括依赖)
pacman -Qi libffi | grep Depends

# 使用 pactree 查看依赖树
pactree libffi        # 正向依赖
pactree -r libffi     # 反向依赖(谁依赖它)

# 需要安装:sudo pacman -S pacman-contrib
```

## 六、工具安装与初始化

### Arch Linux 额外工具

#### pkgfile
```bash
# 安装
sudo pacman -S pkgfile

# 更新数据库(首次使用必须执行)
sudo pkgfile -u

# 使用
pkgfile libffi.so
```

#### pactree
```bash
# 安装
sudo pacman -S pacman-contrib

# 使用
pactree -r libffi
```

## 七、实际使用场景对比

### 场景1:我有一个 .so 文件,想知道它属于哪个包

#### Void Linux
```bash
# 必须提供完整路径
xbps-query -o /usr/lib/libffi.so.8
```

#### Arch Linux
```bash
# 方法1:提供完整路径
pacman -Qo /usr/lib/libffi.so.8

# 方法2:只知道文件名(推荐)
pkgfile libffi.so
```

### 场景2:查看 libffi 包含哪些库文件

#### Void Linux
```bash
xbps-query -f libffi | grep '\.so'
```

#### Arch Linux
```bash
pacman -Ql libffi | grep '\.so'
```

### 场景3:查找提供 libffi.so 的所有包

#### Void Linux
```bash
# 没有直接方法,需要搜索包名
xbps-query -Rs libffi
```

#### Arch Linux
```bash
# 直接搜索文件名
pkgfile libffi.so

# 输出所有提供该文件的包:
# core/libffi
# multilib/lib32-libffi
```

## 八、命令速查表

### 基础命令对照

| 操作 | Void (xbps) | Arch (pacman) |
|------|-------------|---------------|
| 查文件归属 | `xbps-query -o /path/to/file` | `pacman -Qo /path/to/file` |
| 按文件名搜包 | ❌ 不支持 | `pkgfile filename` |
| 列包文件 | `xbps-query -f pkg` | `pacman -Ql pkg` |
| 搜索包 | `xbps-query -Rs pattern` | `pacman -Ss pattern` |
| 包详情 | `xbps-query -R pkg` | `pacman -Si pkg` |
| 已装包详情 | `xbps-query pkg` | `pacman -Qi pkg` |
| 正向依赖 | `xbps-query -X pkg` | `pactree pkg` |
| 反向依赖 | `xbps-query -x pkg` | `pactree -r pkg` |

### 常用组合命令

```bash
# Arch: 查找并查看 raylib 的库文件
pacman -Ss raylib              # 1.搜索包名
pacman -Ql raylib | grep '\.so' # 2.查看库文件

# Arch: 从 .so 文件追溯到包
pkgfile libraylib.so           # 1.找到包名
pacman -Qi raylib              # 2.查看包信息

# Arch: 查看 libffi 的依赖链
pactree libffi                 # 查看它依赖谁
pactree -r libffi              # 查看谁依赖它
```

## 九、关键注意事项

1. **路径要求:**
   - `pacman -Qo` 和 `xbps-query -o` 都需要完整路径
   - 只有 `pkgfile` 支持文件名搜索

2. **pkgfile 必须初始化:**
   ```bash
   sudo pkgfile -u  # 首次使用必须执行
   ```

3. **符号链接处理:**
   ```bash
   # 如果 /usr/lib/libffi.so 是符号链接
   ls -la /usr/lib/libffi.so
   # lrwxrwxrwx 1 root root 15 Dec  4 10:00 /usr/lib/libffi.so -> libffi.so.8.1.4

   # 两者都可以查询
   pacman -Qo /usr/lib/libffi.so
   pacman -Qo /usr/lib/libffi.so.8.1.4
   ```

4. **多架构支持(Arch):**
   ```bash
   pkgfile libffi.so
   # core/libffi          # 64位
   # multilib/lib32-libffi # 32位
   ```

## 十、总结

### Void Linux 的特点
- 命令简洁统一(`xbps-query`)
- 依赖查询直接(`-x` 和 `-X`)

### Arch Linux 的特点
- 功能更强大(`pkgfile` 支持文件名搜索)
- 工具更丰富(`pactree` 可视化依赖树)
- 需要额外安装工具(`pkgfile`, `pacman-contrib`)

### 推荐工作流

#### Arch Linux 完整设置
```bash
# 1.安装工具
sudo pacman -S pkgfile pacman-contrib

# 2.初始化 pkgfile
sudo pkgfile -u

# 3.日常使用
pkgfile <filename>          # 查文件属于哪个包
pacman -Ql <pkg> | grep .so # 查包有哪些库
pactree -r <pkg>            # 查谁依赖此包
```

这样你就可以在 Arch Linux 上实现与 Void Linux 相同甚至更强的包查询功能!
