# Emacs 基础操作入门:从零开始的实战指南

## 目录
1. [Emacs 基本概念](#emacs-基本概念)
2. [启动与退出](#启动与退出)
3. [光标移动](#光标移动)
4. [文本编辑](#文本编辑)
5. [文件操作](#文件操作)
6. [窗口与缓冲区](#窗口与缓冲区)
7. [搜索与替换](#搜索与替换)
8. [撤销与重做](#撤销与重做)

---

## Emacs 基本概念

### 快捷键符号说明

| 符号 | 含义 | 示例 | 说明 |
|------|------|------|------|
| `C-` | Control 键 | `C-x` | 按住 Ctrl,再按 x |
| `M-` | Meta 键(Alt/Esc) | `M-x` | 按住 Alt,再按 x |
| `C-M-` | Ctrl + Meta | `C-M-f` | 同时按 Ctrl+Alt,再按 f |
| `SPC` | 空格键 | `C-x SPC` | Ctrl+x 后按空格 |
| `RET` | 回车键 | `C-x C-s RET` | 最后按回车 |

### 核心哲学

```
Emacs = Editor MACroS (编辑器宏系统)
一切皆命令,快捷键只是命令的绑定
```

**重要概念:**
- **Buffer(缓冲区):** 编辑的内容区域(可能对应文件,也可能不对应)
- **Window(窗口):** 显示 Buffer 的区域(一个 Frame 可以有多个 Window)
- **Frame(框架):** 操作系统意义上的窗口
- **Minibuffer(迷你缓冲):** 屏幕底部的命令输入区域

---

## 启动与退出

### 启动 Emacs

```bash
# 图形界面启动
emacs

# 终端模式启动(不启动 GUI)
emacs -nw

# 打开指定文件
emacs filename.txt

# 直接执行命令
emacs --eval "(message \"Hello\")"
```

### 退出 Emacs

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **保存并退出** | `C-x C-c` | 如果有未保存文件会提示 |
| **强制退出** | `C-x C-c` 后输入 `no` | 放弃所有未保存修改 |
| **挂起 Emacs(终端模式)** | `C-z` | 返回 shell,用 `fg` 恢复 |

**实战操作:**
```
1. 启动 Emacs
   $ emacs

2. 编辑一些内容
   输入: Hello Emacs!

3. 退出(会提示保存)
   按 C-x C-c

   提示:Save file /home/user/*scratch*? (y, n, !, ., q, C-h)
   输入 n (不保存)
```

---

## 光标移动

### 基础移动

| 操作 | 快捷键 | 记忆方法 |
|------|--------|----------|
| **前移一个字符** | `C-f` | Forward |
| **后移一个字符** | `C-b` | Backward |
| **下移一行** | `C-n` | Next line |
| **上移一行** | `C-p` | Previous line |
| **行首** | `C-a` | A = 第一个字母 |
| **行尾** | `C-e` | End |

**实战操作:**
```
输入以下文本:
Hello World
This is Emacs
Welcome to editing

练习:
1. 按 C-p (光标上移到第二行)
2. 按 C-a (光标移到行首)
3. 按 C-e (光标移到行尾)
4. 按 C-n (光标下移)
```

### 按词移动

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **前移一个词** | `M-f` | Forward word |
| **后移一个词** | `M-b` | Backward word |

**实战操作:**
```
文本: hello_world this_is_a_test

光标在行首:
按 M-f → 光标移到 "hello_world" 后
再按 M-f → 光标移到 "this_is_a_test" 后
按 M-b → 光标移回 "this_is_a_test" 前
```

### 按句/段移动

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **句首** | `M-a` | 移到句首 |
| **句尾** | `M-e` | 移到句尾 |
| **段首** | `M-{` | 上一段 |
| **段尾** | `M-}` | 下一段 |

### 屏幕滚动

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **向下翻页** | `C-v` | View next |
| **向上翻页** | `M-v` | View previous |
| **光标置中** | `C-l` | 连按三次循环(中/顶/底) |

**实战操作:**
```
1. 打开一个长文件
   C-x C-f /etc/profile

2. 翻页练习
   C-v (向下翻页)
   M-v (向上翻页)

3. 居中显示
   C-l (光标行移到屏幕中央)
   C-l (再按一次,移到顶部)
   C-l (再按一次,移到底部)
```

### 跳转

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **文件开头** | `M-<` | 记作 "小于开始" |
| **文件结尾** | `M->` | 记作 "大于结束" |
| **跳转到行号** | `M-g g` | Go to line |

**实战操作:**
```
1. 跳到文件开头
   M-< (实际按 Alt+Shift+,)

2. 跳到文件结尾
   M-> (实际按 Alt+Shift+.)

3. 跳到第 10 行
   M-g g
   输入: 10
   按回车
```

---

## 文本编辑

### 删除操作

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **删除光标后字符** | `C-d` | Delete |
| **删除光标前字符** | `DEL` 或 `Backspace` | 退格键 |
| **删除到行尾** | `C-k` | Kill line |
| **删除整行** | `C-S-Backspace` | 整行删除 |
| **删除光标后的词** | `M-d` | Delete word |
| **删除光标前的词** | `M-DEL` | 向前删词 |

**实战操作:**
```
文本: Hello World Emacs Editor

光标在 "World" 的 "W" 上:

1. 按 C-d
   结果: Hello orld Emacs Editor (删除 W)

2. 按 M-d
   结果: Hello  Emacs Editor (删除 "orld")

3. 按 C-k
   结果: Hello (删除到行尾)
```

### 剪切、复制、粘贴

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **设置标记** | `C-SPC` 或 `C-@` | 标记选区起点 |
| **选择区域** | `C-SPC` 后移动光标 | 标记与光标间区域 |
| **剪切区域** | `C-w` | Kill region |
| **复制区域** | `M-w` | Copy region |
| **粘贴** | `C-y` | Yank (粘贴) |
| **循环粘贴历史** | `M-y` | 在 `C-y` 后使用 |

**实战操作:**
```
文本: Hello Emacs World

1. 选择并复制 "Emacs"
   - 光标移到 "E" 前
   - 按 C-SPC (显示 "Mark set")
   - 按 M-f (选中 "Emacs")
   - 按 M-w (复制)

2. 粘贴
   - 光标移到末尾
   - 按 C-y
   结果: Hello Emacs World Emacs

3. 剪切 "World"
   - 光标移到 "W" 前
   - 按 C-SPC
   - 按 M-f
   - 按 C-w
   结果: Hello Emacs  Emacs
```

### Kill Ring(剪切板历史)

Emacs 的剪切板是一个**环形缓冲区**,保存多次剪切/复制的内容。

**实战操作:**
```
1. 依次剪切三个词
   文本: apple banana cherry date

   - 光标在行首,按 M-d (剪切 "apple")
   - 再按 M-d (剪切 "banana")
   - 再按 M-d (剪切 "cherry")

2. 循环粘贴
   - 按 C-y (粘贴 "cherry")
   - 按 M-y (替换为 "banana")
   - 再按 M-y (替换为 "apple")
```

### 矩形编辑

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **矩形剪切** | `C-x r k` | Kill rectangle |
| **矩形复制** | `C-x r M-w` | Copy rectangle |
| **矩形粘贴** | `C-x r y` | Yank rectangle |
| **矩形插入文本** | `C-x r t` | Insert text |

**实战操作:**
```
文本:
1. apple
2. banana
3. cherry

目标:在每行前插入 "- "

1. 光标移到 "1" 前
2. 按 C-SPC (设置标记)
3. 按 C-n C-n (向下两行,选中矩形区域)
4. 按 C-x r t
5. 输入: "- "
6. 按回车

结果:
- 1. apple
- 2. banana
- 3. cherry
```

---

## 文件操作

### 打开文件

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **打开文件** | `C-x C-f` | Find file |
| **插入文件内容** | `C-x i` | Insert file |
| **最近文件** | `C-x C-r` | Recent files (需要配置) |

**实战操作:**
```
1. 打开文件
   C-x C-f
   输入路径: ~/test.txt
   按回车

2. 如果文件不存在,会创建新文件

3. Tab 自动补全
   C-x C-f
   输入: ~/Doc [按 Tab]
   自动补全为: ~/Documents/
```

### 保存文件

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **保存当前文件** | `C-x C-s` | Save |
| **另存为** | `C-x C-w` | Write file |
| **保存所有文件** | `C-x s` | 逐个询问 |

**实战操作:**
```
1. 修改文件后保存
   编辑内容...
   按 C-x C-s
   显示: Wrote /path/to/file

2. 另存为新文件
   按 C-x C-w
   输入: ~/new_file.txt
   按回车
```

### Buffer 操作

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **列出所有 buffer** | `C-x C-b` | List buffers |
| **切换 buffer** | `C-x b` | Switch buffer |
| **下一个 buffer** | `C-x →` | Next buffer |
| **上一个 buffer** | `C-x ←` | Previous buffer |
| **关闭 buffer** | `C-x k` | Kill buffer |

**实战操作:**
```
1. 打开多个文件
   C-x C-f file1.txt [回车]
   C-x C-f file2.txt [回车]

2. 列出所有 buffer
   C-x C-b

   显示:
   MR Buffer           Size  Mode            File
   -- ------           ----  ----            ----
   .  file2.txt        100   Text            ~/file2.txt
      file1.txt        200   Text            ~/file1.txt
   *  *Messages*       500   Messages

3. 切换到 file1.txt
   C-x b file1.txt [回车]

4. 或者用方向键快速切换
   C-x → (切换到下一个 buffer)
   C-x ← (切换回上一个 buffer)
```

---

## 窗口与缓冲区

### 窗口分割

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **水平分割** | `C-x 2` | 上下分割 |
| **垂直分割** | `C-x 3` | 左右分割 |
| **切换窗口** | `C-x o` | Other window |
| **关闭其他窗口** | `C-x 1` | 只保留当前窗口 |
| **关闭当前窗口** | `C-x 0` | 关闭当前窗口 |

**实战操作:**
```
1. 水平分割(上下)
   C-x 2

   结果:
   ┌─────────────┐
   │   窗口1     │
   ├─────────────┤
   │   窗口2     │
   └─────────────┘

2. 在下方窗口再垂直分割(左右)
   C-x o (切换到下方窗口)
   C-x 3

   结果:
   ┌─────────────┐
   │   窗口1     │
   ├──────┬──────┤
   │ 窗口2│窗口3 │
   └──────┴──────┘

3. 在各窗口打开不同文件
   C-x o (切换窗口)
   C-x C-f file1.txt

   C-x o
   C-x C-f file2.txt

4. 只保留当前窗口
   C-x 1
```

### 窗口大小调整

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **放大窗口(垂直)** | `C-x ^` | 向上扩展 |
| **加宽窗口** | `C-x }` | 向右扩展 |
| **缩窄窗口** | `C-x {` | 向左收缩 |
| **平衡窗口** | `C-x +` | 所有窗口等大 |

**实战操作:**
```
1. 分割成上下两个窗口
   C-x 2

2. 放大上方窗口
   C-x ^ (按多次)

3. 恢复平衡
   C-x +
```

---

## 搜索与替换

### 增量搜索

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **向前搜索** | `C-s` | 输入内容实时搜索 |
| **向后搜索** | `C-r` | Reverse search |
| **下一个匹配** | `C-s` | 在搜索模式下再按 |
| **上一个匹配** | `C-r` | 在搜索模式下再按 |
| **退出搜索** | `RET` 或 `C-g` | 留在匹配位置/返回起点 |

**实战操作:**
```
文本:
The quick brown fox jumps over the lazy dog.
The fox is quick and clever.

1. 向前搜索 "fox"
   C-s
   输入: fox
   (光标跳到第一个 "fox")

2. 查找下一个
   再按 C-s
   (光标跳到第二个 "fox")

3. 查找上一个
   按 C-r

4. 结束搜索
   按 RET (留在当前位置)
```

### 正则搜索

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **正则向前搜索** | `C-M-s` | Regex search |
| **正则向后搜索** | `C-M-r` | Regex reverse |

**实战操作:**
```
文本:
test123
test456
test789

1. 搜索所有 test + 数字
   C-M-s
   输入: test[0-9]+

2. 继续匹配
   C-M-s (跳到下一个)
```

### 替换

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **查找替换** | `M-%` | Query replace |
| **正则替换** | `C-M-%` | Regex replace |

**替换时的选项:**
- `y` - 替换这个
- `n` - 跳过这个
- `!` - 替换剩余所有
- `q` - 退出
- `^` - 返回上一个

**实战操作:**
```
文本:
Hello world
Hello Emacs
Hello user

目标:将所有 "Hello" 替换为 "Hi"

1. 开始替换
   M-%
   输入: Hello
   按回车
   输入: Hi
   按回车

2. 逐个确认
   第一个:按 y (替换)
   第二个:按 n (跳过)
   第三个:按 ! (替换剩余所有)

结果:
Hi world
Hello Emacs
Hi user
```

---

## 撤销与重做

### 撤销

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **撤销** | `C-/` 或 `C-_` 或 `C-x u` | Undo |
| **重做** | `C-g` 后再 `C-/` | 打断撤销链 |

**Emacs 的撤销哲学:**
- Emacs 的撤销是**线性**的
- 撤销本身也是一个操作,可以被撤销
- 要"重做",先按 `C-g` 打断撤销,再撤销

**实战操作:**
```
1. 输入文本
   输入: ABCDEF

2. 撤销输入
   C-/ (变成 ABCDE)
   C-/ (变成 ABCD)
   C-/ (变成 ABC)

3. "重做"(实际是撤销撤销操作)
   C-g (打断撤销链)
   C-/ (恢复到 ABCD)
   C-/ (恢复到 ABCDE)
```

---

## 实用技巧

### 命令执行

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **执行命令** | `M-x` | 输入命令名 |
| **重复命令** | `C-u` 数字 | 如 `C-u 10 C-n` |
| **取消命令** | `C-g` | 中断当前命令 |

**实战操作:**
```
1. 执行命令
   M-x
   输入: version
   按回车
   (显示 Emacs 版本)

2. 重复命令
   C-u 5 C-n (向下移动 5 行)
   C-u 10 C-k (删除 10 行)
   C-u 80 - (插入 80 个 "-")

3. 取消输错的命令
   C-x C-f (打开文件)
   输入错误路径
   C-g (取消操作)
```

### 帮助系统

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **帮助前缀** | `C-h` | Help |
| **查看快捷键** | `C-h k` | 然后按快捷键 |
| **查看函数** | `C-h f` | Describe function |
| **查看变量** | `C-h v` | Describe variable |
| **教程** | `C-h t` | Tutorial |
| **模式帮助** | `C-h m` | 当前 mode 帮助 |

**实战操作:**
```
1. 查看快捷键功能
   C-h k
   按 C-x C-s
   显示: C-x C-s runs the command save-buffer...

2. 查看函数文档
   C-h f
   输入: save-buffer
   按回车
   (显示函数详细说明)

3. 启动教程
   C-h t
   (进入 Emacs 官方教程)
```

### 标记与跳转

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| **设置标记** | `C-SPC C-SPC` | 不激活选区 |
| **跳回标记** | `C-u C-SPC` | 跳到标记栈 |
| **交换光标与标记** | `C-x C-x` | Exchange |

**实战操作:**
```
1. 在重要位置设置标记
   C-SPC C-SPC (设置标记但不激活选区)

2. 移动到其他地方编辑
   ...

3. 跳回标记
   C-u C-SPC (跳回上一个标记)
   C-u C-SPC (继续跳回更早的标记)
```

---

## 常用快捷键总结

### 必记快捷键(生存技能)

```
启动退出:
  C-x C-c    退出 Emacs
  C-g        取消命令

文件操作:
  C-x C-f    打开文件
  C-x C-s    保存文件
  C-x C-w    另存为

光标移动:
  C-f/b/n/p  前/后/下/上
  C-a/e      行首/尾
  M-</M->    文件首/尾

编辑:
  C-d        删除字符
  C-k        删除到行尾
  C-SPC      设置标记
  C-w        剪切
  M-w        复制
  C-y        粘贴

撤销:
  C-/        撤销

搜索:
  C-s        搜索
  M-%        替换

帮助:
  C-h k      查看快捷键
  C-h t      教程
```

---

## 下一步学习

完成基础操作后,可以继续学习:

1. **02-Emacs配置入门.md** - 自定义 Emacs
2. **03-Emacs插件管理.md** - 使用 package.el
3. **04-Emacs编程实战.md** - 编程相关功能
4. **05-Emacs高级技巧.md** - 宏、寄存器等

---

## 练习任务

### 任务1:基础文件编辑
```
1. 创建文件 test.txt
2. 输入 10 行文本
3. 复制第 3 行到文件末尾
4. 删除第 5 行
5. 将所有 "test" 替换为 "demo"
6. 保存并退出
```

### 任务2:多窗口编辑
```
1. 打开两个文件
2. 水平分割窗口
3. 在上方窗口打开 file1.txt
4. 在下方窗口打开 file2.txt
5. 从 file1 复制一段到 file2
6. 保存两个文件
```

### 任务3:搜索替换
```
1. 打开一个代码文件
2. 搜索所有函数名
3. 使用正则替换添加注释
```

完成这些练习后,你就掌握了 Emacs 的基础操作!
