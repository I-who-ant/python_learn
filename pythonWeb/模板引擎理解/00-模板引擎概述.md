# 模板引擎概述 - 什么是模板引擎?

## 1. 核心概念

### 什么是模板引擎?

**模板引擎**是一种将**数据**和**模板**结合,生成最终**HTML**的工具。

简单理解:
```
数据 (Python 变量) + 模板 (HTML + 占位符) = 最终 HTML
```

### 最简单的例子

#### 不使用模板引擎 (硬编码)
```python
def hello(name):
    html = "<h1>Hello, " + name + "!</h1>"
    return html

# 调用
print(hello("张三"))  # <h1>Hello, 张三!</h1>
```

**问题:**
- HTML 和 Python 代码混在一起
- 难以维护复杂的页面
- 设计师无法独立修改样式

#### 使用模板引擎 (Jinja2)
```python
# template.html (模板文件)
<h1>Hello, {{ name }}!</h1>

# Python 代码
from jinja2 import Template

template = Template("<h1>Hello, {{ name }}!</h1>")
html = template.render(name="张三")
print(html)  # <h1>Hello, 张三!</h1>
```

**优点:**
- 数据和展示分离
- 模板可以独立维护
- 支持复杂逻辑(循环、条件等)

## 2. 模板引擎的作用

### 核心功能:填充数据

```
┌─────────────────────────────────────────┐
│          后端 (Python/Flask)            │
│                                         │
│  users = [                              │
│    {"name": "张三", "age": 25},         │
│    {"name": "李四", "age": 30}          │
│  ]                                      │
└────────────────┬────────────────────────┘
                 │ 传递数据
                 ▼
┌─────────────────────────────────────────┐
│        模板引擎 (Jinja2)                │
│                                         │
│  template.html:                         │
│  <ul>                                   │
│  {% for user in users %}                │
│    <li>{{ user.name }} - {{ user.age }}</li>│
│  {% endfor %}                           │
│  </ul>                                  │
└────────────────┬────────────────────────┘
                 │ 渲染生成
                 ▼
┌─────────────────────────────────────────┐
│          最终 HTML                      │
│                                         │
│  <ul>                                   │
│    <li>张三 - 25</li>                   │
│    <li>李四 - 30</li>                   │
│  </ul>                                  │
└────────────────┬────────────────────────┘
                 │ 发送给浏览器
                 ▼
┌─────────────────────────────────────────┐
│          浏览器显示                     │
│                                         │
│  • 张三 - 25                            │
│  • 李四 - 30                            │
└─────────────────────────────────────────┘
```

## 3. 为什么需要模板引擎?

### 问题场景

假设你要生成一个用户列表页面:

#### 方式1: 纯 Python 字符串拼接 ❌

```python
def user_list(users):
    html = "<html><body><ul>"
    for user in users:
        html += "<li>" + user["name"] + " - " + str(user["age"]) + "</li>"
    html += "</ul></body></html>"
    return html
```

**问题:**
- 代码混乱,难以阅读
- 无法处理复杂的 HTML 结构
- 前端设计师无法参与
- 容易出现 XSS 安全问题

#### 方式2: 使用模板引擎 ✅

```html
<!-- users.html -->
<html>
<body>
  <ul>
  {% for user in users %}
    <li>{{ user.name }} - {{ user.age }}</li>
  {% endfor %}
  </ul>
</body>
</html>
```

```python
# Python 代码
from flask import render_template

@app.route('/users')
def user_list():
    users = [
        {"name": "张三", "age": 25},
        {"name": "李四", "age": 30}
    ]
    return render_template('users.html', users=users)
```

**优点:**
- HTML 结构清晰
- 设计师可以独立修改模板
- 自动处理 XSS 安全问题
- 支持模板继承、包含等高级功能

## 4. 模板引擎的核心特性

### 4.1 变量替换

```html
<!-- 模板 -->
<h1>{{ title }}</h1>
<p>{{ content }}</p>

<!-- Python -->
render_template('page.html', title='首页', content='欢迎来到我的网站')

<!-- 输出 -->
<h1>首页</h1>
<p>欢迎来到我的网站</p>
```

### 4.2 循环



```html
<!-- 模板 -->
<ul>
{% for item in items %}
  <li>{{ item }}</li>
{% endfor %}
</ul>

<!-- Python -->
render_template('list.html', items=['苹果', '香蕉', '橙子'])

<!-- 输出 -->
<ul>
  <li>苹果</li>
  <li>香蕉</li>
  <li>橙子</li>
</ul>
```



### 4.3 条件判断

```html
<!-- 模板 -->
{% if user.is_admin %}
  <button>管理面板</button>
{% else %}
  <p>您没有管理权限</p>
{% endif %}

<!-- Python -->
render_template('dashboard.html', user={'is_admin': True})

<!-- 输出 -->
<button>管理面板</button>
```

### 4.4 模板继承 (重要!)

```html
<!-- base.html (基础模板) -->
<!DOCTYPE html>
<html>
<head>
  <title>{% block title %}默认标题{% endblock %}</title>
</head>
<body>
  <nav>导航栏</nav>
  {% block content %}{% endblock %}
  <footer>页脚</footer>
</body>
</html>

<!-- home.html (继承 base.html) -->
{% extends "base.html" %}

{% block title %}首页{% endblock %}

{% block content %}
  <h1>欢迎来到首页</h1>
{% endblock %}

<!-- 最终输出 -->
<!DOCTYPE html>
<html>
<head>
  <title>首页</title>
</head>
<body>
  <nav>导航栏</nav>
  <h1>欢迎来到首页</h1>
  <footer>页脚</footer>
</body>
</html>
```

## 5. 常见的模板引擎

### Python 生态

| 模板引擎 | 使用框架 | 特点 |
|---------|---------|------|
| **Jinja2** | Flask, Ansible | 功能强大,语法优雅 |
| **Django Templates** | Django | 简单易用,功能较少 |
| **Mako** | Pyramid | 高性能,支持 Python 代码 |
| **Chameleon** | Pyramid | XML 属性语法 |

### 其他语言

| 模板引擎 | 语言 | 特点 |
|---------|------|------|
| **EJS** | JavaScript/Node.js | 嵌入 JavaScript |
| **Handlebars** | JavaScript | 逻辑少的模板 |
| **Blade** | PHP/Laravel | 简洁优雅 |
| **Thymeleaf** | Java/Spring | 自然模板 |

## 6. 模板引擎 vs 前端框架

### 这是关键的区别! ⭐

```
传统模板引擎 (Jinja2)        现代前端框架 (Vue/React)
──────────────────          ───────────────────
服务端渲染 (SSR)             客户端渲染 (CSR)
后端生成 HTML                前端生成 HTML
每次请求都渲染               一次加载,动态更新
简单,SEO 友好                交互性强,用户体验好
```

### 详细对比

#### 传统模板引擎 (Jinja2)

```
浏览器请求
    ↓
Flask 服务器
    ↓
Jinja2 渲染模板 (服务器端)
    ↓
生成完整的 HTML
    ↓
发送给浏览器
    ↓
浏览器直接显示 (不需要 JavaScript)
```

**特点:**
- ✅ 服务端渲染,SEO 友好
- ✅ 首屏加载快
- ✅ 支持禁用 JavaScript 的浏览器
- ❌ 每次操作都要刷新页面
- ❌ 用户体验较差

#### 现代前端框架 (Vue/React)

```
浏览器首次加载
    ↓
下载 JavaScript 框架
    ↓
下载应用代码
    ↓
JavaScript 运行 (客户端)
    ↓
请求数据 (API)
    ↓
前端渲染 HTML (客户端)
    ↓
用户交互 → 只更新变化的部分 (不刷新页面)
```

**特点:**
- ✅ 用户体验好 (无刷新切换)
- ✅ 交互性强
- ✅ 前后端分离
- ❌ 首屏加载慢
- ❌ SEO 较差 (需要 SSR 方案)
- ❌ 依赖 JavaScript

## 7. 实际应用场景

### 使用模板引擎 (Jinja2) 的场景

1. **企业官网**: 内容为主,不需要复杂交互
2. **博客系统**: 文章展示,评论等
3. **后台管理**: 简单的 CRUD 操作
4. **快速原型**: 快速开发 MVP

### 使用前端框架 (Vue/React) 的场景

1. **单页应用 (SPA)**: Gmail, Twitter 等
2. **复杂交互**: 表单验证,实时更新
3. **移动端应用**: React Native, Vue Native
4. **数据可视化**: 图表,仪表盘

### 混合使用的场景 ⭐

很多现代应用会**同时使用**:

```
Flask 后端
    ↓
Jinja2 渲染基础页面框架
    ↓
页面中嵌入 Vue/React 组件
    ↓
交互部分由前端框架处理
```

**例如:**
```html
<!-- Flask + Jinja2 渲染 -->
<!DOCTYPE html>
<html>
<head>
  <title>{{ title }}</title>
</head>
<body>
  <nav>{% include 'nav.html' %}</nav>

  <!-- Vue 接管的部分 -->
  <div id="app">
    <user-dashboard></user-dashboard>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
  <script src="/static/app.js"></script>
</body>
</html>
```

## 8. 技术演进历史

```
1990s: 早期 Web
├─ CGI 脚本直接输出 HTML
└─ print "<html>...</html>"

2000s: 模板引擎兴起
├─ PHP, JSP, ASP
├─ Jinja2, Django Templates
└─ 服务端渲染为主

2010s: 前端框架崛起
├─ AngularJS (2010)
├─ React (2013)
├─ Vue (2014)
└─ 客户端渲染为主

2015s+: 现代混合架构
├─ SSR (服务端渲染)
├─ SSG (静态站点生成)
├─ ISR (增量静态再生)
└─ Next.js, Nuxt.js
```

## 9. 总结

### 关键理解点

1. **模板引擎 = 数据 + 模板 → HTML**
   - 在**服务器端**生成 HTML
   - Python 代码和 HTML 分离

2. **Jinja2 是 Python 的模板引擎**
   - Flask 默认使用
   - 语法: `{{ variable }}`, `{% for %}`, `{% if %}`

3. **模板引擎 ≠ 前端框架**
   - 模板引擎: 服务端渲染,简单直接
   - 前端框架: 客户端渲染,交互性强

4. **两者可以共存**
   - 基础页面用 Jinja2
   - 交互部分用 Vue/React

### 下一步

阅读:
- **01-Jinja2详解.md**: 深入学习 Jinja2 语法和功能
- **02-模板引擎vs前端框架.md**: 详细对比两种技术
- **03-技术演进历史.md**: 了解 Web 开发的发展历程

---

**现在您应该理解了:模板引擎是在服务器端将数据填充到 HTML 模板中,生成最终页面的工具。它与 Vue/React 等前端框架是不同层面的技术,但可以配合使用!**
