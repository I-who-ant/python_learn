# 00 - å®¹å™¨æŠ€æœ¯æ€»è§ˆ

> ç†è§£å®¹å™¨çš„æœ¬è´¨ï¼šå®ƒåªæ˜¯ä¸€ä¸ªè¢«é™åˆ¶çš„è¿›ç¨‹

## ç›®å½•

- [ä»€ä¹ˆæ˜¯å®¹å™¨](#ä»€ä¹ˆæ˜¯å®¹å™¨)
- [å®¹å™¨çš„å†å²](#å®¹å™¨çš„å†å²)
- [å®¹å™¨ vs è™šæ‹Ÿæœº](#å®¹å™¨-vs-è™šæ‹Ÿæœº)
- [å®¹å™¨çš„æ ¸å¿ƒæŠ€æœ¯](#å®¹å™¨çš„æ ¸å¿ƒæŠ€æœ¯)
- [å®¹å™¨ç”Ÿæ€ç³»ç»Ÿ](#å®¹å™¨ç”Ÿæ€ç³»ç»Ÿ)
- [å­¦ä¹ è·¯çº¿å›¾](#å­¦ä¹ è·¯çº¿å›¾)

---

## ä»€ä¹ˆæ˜¯å®¹å™¨

### æœ€ç®€å•çš„å®šä¹‰

> **å®¹å™¨å°±æ˜¯ä¸€ä¸ªè¢«éš”ç¦»å’Œé™åˆ¶çš„è¿›ç¨‹**

```bash
# åœ¨å®¿ä¸»æœºä¸Šï¼Œå®¹å™¨åªæ˜¯ä¸€ä¸ªæ™®é€šè¿›ç¨‹
ps aux | grep docker

# ä½†åœ¨å®¹å™¨å†…éƒ¨ï¼Œå®ƒ"è®¤ä¸º"è‡ªå·±æ˜¯ç‹¬ç«‹çš„ç³»ç»Ÿ
docker exec -it mycontainer ps aux
```

### æœ¬è´¨ç†è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®¿ä¸»æœº (Host OS)                  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å®¹å™¨è¿›ç¨‹1 â”‚  â”‚ å®¹å™¨è¿›ç¨‹2 â”‚  â”‚ æ™®é€šè¿›ç¨‹â”‚ â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚        â”‚ â”‚
â”‚  â”‚ PID=1234â”‚  â”‚ PID=5678â”‚  â”‚ PID=999â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â†“              â†“                   â”‚
â”‚  [éš”ç¦»è§†å›¾]      [éš”ç¦»è§†å›¾]               â”‚
â”‚                                          â”‚
â”‚  Linux Kernel (Namespace + Cgroups)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼š
1. å®¹å™¨è¿›ç¨‹ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºå†…æ ¸ä¸Š
2. é€šè¿‡ Namespace å®ç°éš”ç¦»
3. é€šè¿‡ Cgroups é™åˆ¶èµ„æº
4. é€šè¿‡ Chroot/UnionFS éš”ç¦»æ–‡ä»¶ç³»ç»Ÿ

### å®¹å™¨ â‰  è™šæ‹Ÿæœº

```
è™šæ‹Ÿæœºæ¨¡å‹                     å®¹å™¨æ¨¡å‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App   App     â”‚          â”‚   App   App     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚          â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   Bins/Libs     â”‚          â”‚   Bins/Libs     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚          â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   Guest OS      â”‚          â”‚   Container     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Hypervisor    â”‚          â”‚   Docker Engine â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Host OS       â”‚          â”‚   Host OS       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Hardware      â”‚          â”‚   Hardware      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯åŠ¨æ—¶é—´: åˆ†é’Ÿçº§               å¯åŠ¨æ—¶é—´: ç§’çº§
èµ„æºå ç”¨: GBçº§                èµ„æºå ç”¨: MBçº§
æ€§èƒ½: è™šæ‹ŸåŒ–æŸè€—              æ€§èƒ½: æ¥è¿‘åŸç”Ÿ
```

---

## å®¹å™¨çš„å†å²

### æ¼”è¿›æ—¶é—´çº¿

```
1979 - chroot
         â†“
2000 - FreeBSD Jails
         â†“
2004 - Solaris Zones
         â†“
2006 - Linux Namespace (PID)
         â†“
2007 - Cgroups (Google)
         â†“
2008 - LXC (Linux Containers)
         â†“
2013 - Docker è¯ç”Ÿ ğŸš€
         â†“
2014 - Kubernetes è¯ç”Ÿ
         â†“
2015 - OCI æ ‡å‡†
         â†“
2016 - containerd
         â†“
2025 - ç°åœ¨ (å®¹å™¨å·²æˆä¸ºäº‘åŸç”ŸåŸºç¡€è®¾æ–½)
```

### å…³é”®é‡Œç¨‹ç¢‘

#### 1. chroot (1979)
```bash
# Unix V7 å¼•å…¥ chroot
# æ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•
sudo chroot /new/root /bin/bash
```

#### 2. Linux Namespace (2006-2013)
```bash
# å†…æ ¸é€æ­¥å¼•å…¥å„ç§å‘½åç©ºé—´
# PID (2006)
# Network (2009)
# User (2013)
```

#### 3. Docker (2013) ğŸ¯

```bash
# Solomon Hykes åœ¨ PyCon ä¸Šå‘å¸ƒ Docker
# å°†å®¹å™¨æŠ€æœ¯å¸¦ç»™å¤§ä¼—
docker run hello-world
```

#### 4. Kubernetes (2014)
```bash
# Google å¼€æº K8s
# å®¹å™¨ç¼–æ’æˆä¸ºæ ‡å‡†
kubectl get pods
```

---

## å®¹å™¨ vs è™šæ‹Ÿæœº

### è¯¦ç»†å¯¹æ¯”è¡¨

| ç‰¹æ€§ | å®¹å™¨ | è™šæ‹Ÿæœº |
|-----|------|--------|
| **å¯åŠ¨é€Ÿåº¦** | ç§’çº§ï¼ˆå‡ ç™¾æ¯«ç§’ï¼‰ | åˆ†é’Ÿçº§ï¼ˆ30-60ç§’ï¼‰ |
| **èµ„æºå ç”¨** | MBçº§ï¼ˆ10-100MBï¼‰ | GBçº§ï¼ˆ1-10GBï¼‰ |
| **æ€§èƒ½** | æ¥è¿‘åŸç”Ÿï¼ˆ95%+ï¼‰ | æœ‰æŸè€—ï¼ˆ80-90%ï¼‰ |
| **éš”ç¦»æ€§** | è¿›ç¨‹çº§ | æ“ä½œç³»ç»Ÿçº§ |
| **å®‰å…¨æ€§** | è¾ƒå¼±ï¼ˆå…±äº«å†…æ ¸ï¼‰ | è¾ƒå¼ºï¼ˆç‹¬ç«‹å†…æ ¸ï¼‰ |
| **ç³»ç»Ÿå†…æ ¸** | å…±äº«å®¿ä¸»æœºå†…æ ¸ | æ¯ä¸ª VM ç‹¬ç«‹å†…æ ¸ |
| **å¯ç§»æ¤æ€§** | éå¸¸é«˜ | ä¸€èˆ¬ |
| **èµ„æºåˆ©ç”¨ç‡** | é«˜ï¼ˆå¯è¿è¡Œæ›´å¤šå®ä¾‹ï¼‰ | ä½ |
| **éƒ¨ç½²å¯†åº¦** | é«˜ï¼ˆå•æœºæ•°ç™¾ä¸ªï¼‰ | ä½ï¼ˆå•æœºåå‡ ä¸ªï¼‰ |

### å®é™…æµ‹è¯•

```bash
# å¯åŠ¨ 100 ä¸ªå®¹å™¨ vs 100 ä¸ªè™šæ‹Ÿæœº

# å®¹å™¨
time for i in {1..100}; do
  docker run -d alpine sleep 1000
done
# ç»“æœ: çº¦ 10-20 ç§’

# è™šæ‹Ÿæœº
# ç»“æœ: ä¸å¯èƒ½å®Œæˆï¼ˆèµ„æºä¸è¶³ï¼‰
```

### ä½•æ—¶ä½¿ç”¨å®¹å™¨ vs è™šæ‹Ÿæœº

#### ä½¿ç”¨å®¹å™¨çš„åœºæ™¯ âœ…
- å¾®æœåŠ¡æ¶æ„
- CI/CD æµæ°´çº¿
- å¿«é€Ÿéƒ¨ç½²å’Œæ‰©å±•
- å¼€å‘æµ‹è¯•ç¯å¢ƒ
- æ— çŠ¶æ€åº”ç”¨

#### ä½¿ç”¨è™šæ‹Ÿæœºçš„åœºæ™¯ âœ…
- éœ€è¦å®Œå…¨éš”ç¦»ï¼ˆå®‰å…¨è¦æ±‚é«˜ï¼‰
- è¿è¡Œä¸åŒæ“ä½œç³»ç»Ÿ
- éœ€è¦å†…æ ¸çº§æ§åˆ¶
- é—ç•™åº”ç”¨è¿ç§»
- Windows åº”ç”¨ï¼ˆåœ¨ Linux ä¸»æœºä¸Šï¼‰

#### æ··åˆä½¿ç”¨ ğŸ¯
```
ç‰©ç†æœº
  â”œâ”€â”€ VM 1 (å®‰å…¨éš”ç¦»)
  â”‚    â”œâ”€â”€ å®¹å™¨ 1 (å¾®æœåŠ¡ A)
  â”‚    â”œâ”€â”€ å®¹å™¨ 2 (å¾®æœåŠ¡ B)
  â”‚    â””â”€â”€ å®¹å™¨ 3 (å¾®æœåŠ¡ C)
  â””â”€â”€ VM 2 (å¦ä¸€ä¸ªéš”ç¦»ç¯å¢ƒ)
       â”œâ”€â”€ å®¹å™¨ 4 (å¾®æœåŠ¡ D)
       â””â”€â”€ å®¹å™¨ 5 (å¾®æœåŠ¡ E)
```

---

## å®¹å™¨çš„æ ¸å¿ƒæŠ€æœ¯

### 1. Linux Namespace (éš”ç¦»)

**ä½œç”¨**: è®©è¿›ç¨‹"çœ‹åˆ°"ä¸åŒçš„ç³»ç»Ÿè§†å›¾

```bash
# æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å‘½åç©ºé—´
ls -l /proc/$$/ns/
```

**7 ç§å‘½åç©ºé—´**:

| Namespace | éš”ç¦»å†…å®¹ | å¼•å…¥ç‰ˆæœ¬ |
|-----------|---------|---------|
| PID | è¿›ç¨‹ ID | Linux 2.6.24 (2008) |
| Network | ç½‘ç»œè®¾å¤‡ã€IPã€ç«¯å£ | Linux 2.6.29 (2009) |
| Mount | æŒ‚è½½ç‚¹ | Linux 2.4.19 (2002) |
| IPC | è¿›ç¨‹é—´é€šä¿¡ | Linux 2.6.19 (2006) |
| UTS | ä¸»æœºåå’ŒåŸŸå | Linux 2.6.19 (2006) |
| User | ç”¨æˆ·å’Œç»„ ID | Linux 3.8 (2013) |
| Cgroup | Cgroup æ ¹ç›®å½• | Linux 4.6 (2016) |

**ç¤ºä¾‹**:
```bash
# åˆ›å»ºæ–°çš„ PID Namespace
sudo unshare --fork --pid --mount-proc /bin/bash

# åœ¨æ–°å‘½åç©ºé—´ä¸­ï¼Œå½“å‰ bash çš„ PID æ˜¯ 1
echo $$  # è¾“å‡º: 1

# æŸ¥çœ‹è¿›ç¨‹æ ‘
ps aux  # åªèƒ½çœ‹åˆ°å½“å‰å‘½åç©ºé—´çš„è¿›ç¨‹
```

### 2. Cgroups (èµ„æºé™åˆ¶)

**ä½œç”¨**: é™åˆ¶ã€è®°å½•å’Œéš”ç¦»è¿›ç¨‹ç»„çš„èµ„æºä½¿ç”¨

```bash
# æŸ¥çœ‹ Cgroups å­ç³»ç»Ÿ
cat /proc/cgroups
```

**ä¸»è¦å­ç³»ç»Ÿ**:

| å­ç³»ç»Ÿ | åŠŸèƒ½ |
|-------|------|
| cpu | é™åˆ¶ CPU ä½¿ç”¨ |
| cpuacct | ç»Ÿè®¡ CPU ä½¿ç”¨æƒ…å†µ |
| cpuset | ç»‘å®šç‰¹å®š CPU æ ¸å¿ƒ |
| memory | é™åˆ¶å†…å­˜ä½¿ç”¨ |
| blkio | é™åˆ¶å—è®¾å¤‡ I/O |
| devices | æ§åˆ¶è®¾å¤‡è®¿é—® |
| net_cls | æ ‡è®°ç½‘ç»œæ•°æ®åŒ… |
| freezer | æŒ‚èµ·/æ¢å¤è¿›ç¨‹ |

**ç¤ºä¾‹**:

```bash
# é™åˆ¶è¿›ç¨‹å†…å­˜ä¸º 100MB
sudo mkdir /sys/fs/cgroup/memory/mycontainer
echo 104857600 | sudo tee /sys/fs/cgroup/memory/mycontainer/memory.limit_in_bytes
echo $$ | sudo tee /sys/fs/cgroup/memory/mycontainer/cgroup.procs

# å°è¯•åˆ†é… 200MB å†…å­˜
# ä¼šè¢« OOM Killer ç»ˆæ­¢
```


### 3. Chroot (æ–‡ä»¶ç³»ç»Ÿéš”ç¦»)

**ä½œç”¨**: æ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•

```bash
# å‡†å¤‡ rootfs
mkdir /tmp/myrootfs
cp -r /bin /lib /lib64 /tmp/myrootfs/

# åˆ‡æ¢æ ¹ç›®å½•
sudo chroot /tmp/myrootfs /bin/bash

# ç°åœ¨ / æ˜¯ /tmp/myrootfs
ls /  # åªèƒ½çœ‹åˆ° bin, lib, lib64

```

### 4. Union File System (åˆ†å±‚å­˜å‚¨)

**ä½œç”¨**: å°†å¤šä¸ªç›®å½•"è”åˆæŒ‚è½½"åˆ°ä¸€ä¸ªç›®å½•

```bash
# ä½¿ç”¨ OverlayFS
mkdir -p /tmp/overlay/{lower,upper,work,merged}

# åˆ›å»ºåŸºç¡€å±‚
echo "I'm from lower" > /tmp/overlay/lower/file1.txt

# åˆ›å»ºå¯å†™å±‚
echo "I'm from upper" > /tmp/overlay/upper/file2.txt

# è”åˆæŒ‚è½½
sudo mount -t overlay overlay \
  -o lowerdir=/tmp/overlay/lower,upperdir=/tmp/overlay/upper,workdir=/tmp/overlay/work \
  /tmp/overlay/merged

# æŸ¥çœ‹åˆå¹¶ç»“æœ
ls /tmp/overlay/merged/
# file1.txt (æ¥è‡ª lower)
# file2.txt (æ¥è‡ª upper)
```

---

## å®¹å™¨ç”Ÿæ€ç³»ç»Ÿ

### å®¹å™¨æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨å±‚ (Application)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ç¼–æ’å±‚ (Orchestration)               â”‚
â”‚    Kubernetes, Docker Swarm, Nomad      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    é•œåƒå±‚ (Image)                        â”‚
â”‚    Docker Hub, Harbor, ç§æœ‰ä»“åº“          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    å®¹å™¨è¿è¡Œæ—¶å±‚ (Container Runtime)       â”‚
â”‚    containerd, CRI-O, runc              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ“ä½œç³»ç»Ÿå±‚ (OS)                       â”‚
â”‚    Linux Kernel (Namespace + Cgroups)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    åŸºç¡€è®¾æ–½å±‚ (Infrastructure)           â”‚
â”‚    ç‰©ç†æœº, è™šæ‹Ÿæœº, äº‘æœåŠ¡                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. å®¹å™¨å¼•æ“
- **Docker** - æœ€æµè¡Œçš„å®¹å™¨å¹³å°
- **Podman** - æ— å®ˆæŠ¤è¿›ç¨‹çš„å®¹å™¨å¼•æ“
- **LXC** - Linux åŸç”Ÿå®¹å™¨

#### 2. å®¹å™¨è¿è¡Œæ—¶
- **runc** - OCI æ ‡å‡†è¿è¡Œæ—¶
- **containerd** - Docker ä½¿ç”¨çš„è¿è¡Œæ—¶
- **CRI-O** - Kubernetes ä¸“ç”¨è¿è¡Œæ—¶

#### 3. é•œåƒä»“åº“
- **Docker Hub** - å…¬å…±é•œåƒä»“åº“
- **Harbor** - ä¼ä¸šçº§ç§æœ‰ä»“åº“
- **Quay.io** - Red Hat çš„é•œåƒä»“åº“

#### 4. ç¼–æ’ç³»ç»Ÿ
- **Kubernetes** - äº‹å®æ ‡å‡†
- **Docker Swarm** - Docker åŸç”Ÿç¼–æ’
- **Apache Mesos** - å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†

### OCI æ ‡å‡†

**Open Container Initiative** - å®¹å™¨æ ‡å‡†åŒ–ç»„ç»‡

```
OCI è§„èŒƒ
â”œâ”€â”€ Runtime Spec (è¿è¡Œæ—¶è§„èŒƒ)
â”‚   â””â”€â”€ å¦‚ä½•è¿è¡Œå®¹å™¨
â”œâ”€â”€ Image Spec (é•œåƒè§„èŒƒ)
â”‚   â””â”€â”€ å¦‚ä½•æ„å»ºé•œåƒ
â””â”€â”€ Distribution Spec (åˆ†å‘è§„èŒƒ)
    â””â”€â”€ å¦‚ä½•åˆ†å‘é•œåƒ
```

---

## å­¦ä¹ è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šLinux åŸºç¡€ï¼ˆ1-2å‘¨ï¼‰

```bash
# å­¦ä¹ ç›®æ ‡
âœ“ ç†è§£è¿›ç¨‹ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œåŸºç¡€
âœ“ æŒæ¡ Linux å‘½ä»¤è¡Œ

# å­¦ä¹ å†…å®¹
- è¿›ç¨‹ç®¡ç† (ps, top, kill)
- æ–‡ä»¶ç³»ç»Ÿ (ls, cd, mount)
- ç½‘ç»œåŸºç¡€ (ip, netstat, iptables)
```

### é˜¶æ®µäºŒï¼šå®¹å™¨åº•å±‚æŠ€æœ¯ï¼ˆ2-3å‘¨ï¼‰

```bash
# å­¦ä¹ ç›®æ ‡
âœ“ ç†è§£ Namespaceã€Cgroupsã€Chroot
âœ“ èƒ½å¤Ÿæ‰‹åŠ¨åˆ›å»ºç®€å•å®¹å™¨

# å­¦ä¹ å†…å®¹
- 01-Namespaceè¯¦è§£.md
- 02-Cgroupsè¯¦è§£.md
- 03-Chrootè¯¦è§£.md
- 04-UnionFSè¯¦è§£.md
- 05-å®¹å™¨ç½‘ç»œè¯¦è§£.md
- 06-æ‰‹åŠ¨æ„å»ºå®¹å™¨.md
```

### é˜¶æ®µä¸‰ï¼šDocker å®æˆ˜ï¼ˆ2-3å‘¨ï¼‰

```bash
# å­¦ä¹ ç›®æ ‡
âœ“ æŒæ¡ Docker åŸºæœ¬ä½¿ç”¨
âœ“ èƒ½å¤Ÿç¼–å†™ Dockerfile
âœ“ ç†è§£ Docker åŸç†

# å­¦ä¹ å†…å®¹
- 07-å®¹å™¨è¿è¡Œæ—¶.md
- 08-Dockeræ·±å…¥ç†è§£.md
- å®æˆ˜: æ„å»ºå¤šå®¹å™¨åº”ç”¨
```

### é˜¶æ®µå››ï¼šKubernetesï¼ˆ4-6å‘¨ï¼‰

```bash
# å­¦ä¹ ç›®æ ‡
âœ“ ç†è§£ K8s æ¶æ„
âœ“ èƒ½å¤Ÿéƒ¨ç½² K8s é›†ç¾¤
âœ“ æŒæ¡å¸¸ç”¨èµ„æºå¯¹è±¡

# å­¦ä¹ å†…å®¹
- 09-Kubernetesæ¶æ„.md
- 10-K8så®æˆ˜è¿ç»´.md
- å®æˆ˜: éƒ¨ç½²å¾®æœåŠ¡åº”ç”¨
```

### å­¦ä¹ æ£€æŸ¥æ¸…å•

#### åŸºç¡€çŸ¥è¯† âœ…
- [ ] ç†è§£ä»€ä¹ˆæ˜¯å®¹å™¨
- [ ] çŸ¥é“å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«
- [ ] ç†è§£ Namespace çš„ä½œç”¨
- [ ] ç†è§£ Cgroups çš„ä½œç”¨
- [ ] ç†è§£åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿ

#### åŠ¨æ‰‹èƒ½åŠ› âœ…
- [ ] èƒ½ä½¿ç”¨ unshare åˆ›å»ºå‘½åç©ºé—´
- [ ] èƒ½ä½¿ç”¨ cgroups é™åˆ¶èµ„æº
- [ ] èƒ½æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç®€å•å®¹å™¨
- [ ] èƒ½ç¼–å†™ Dockerfile
- [ ] èƒ½ä½¿ç”¨ Docker Compose

#### é«˜çº§èƒ½åŠ› âœ…
- [ ] ç†è§£ Docker æ¶æ„
- [ ] ç†è§£å®¹å™¨ç½‘ç»œåŸç†
- [ ] ç†è§£å®¹å™¨å­˜å‚¨åŸç†
- [ ] èƒ½éƒ¨ç½² K8s é›†ç¾¤
- [ ] èƒ½æ’æŸ¥å®¹å™¨é—®é¢˜

---

## å®éªŒç¯å¢ƒå‡†å¤‡

### æ£€æŸ¥ç³»ç»Ÿæ”¯æŒ

```bash
# 1. æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼ˆæ¨è >= 5.0ï¼‰
uname -r

# 2. æ£€æŸ¥ Namespace æ”¯æŒ
ls -l /proc/$$/ns/
# åº”è¯¥çœ‹åˆ°: cgroup, ipc, mnt, net, pid, pid_for_children, user, uts

# 3. æ£€æŸ¥ Cgroups ç‰ˆæœ¬
mount | grep cgroup
# Cgroups v1: /sys/fs/cgroup
# Cgroups v2: /sys/fs/cgroup/unified

# 4. æ£€æŸ¥ OverlayFS æ”¯æŒ
cat /proc/filesystems | grep overlay
# åº”è¯¥çœ‹åˆ°: overlay

# 5. æ£€æŸ¥æ¨¡å—åŠ è½½
lsmod | grep overlay
lsmod | grep br_netfilter
```

### å®‰è£…å¿…è¦å·¥å…·ï¼ˆArch Linuxï¼‰

```bash
# 1. å®‰è£… Docker
sudo pacman -S docker docker-compose docker-buildx

# 2. å¯åŠ¨ Docker
sudo systemctl start docker
sudo systemctl enable docker

# 3. æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ï¼ˆé¿å…æ¯æ¬¡ sudoï¼‰
sudo usermod -aG docker $USER
# æ³¨é”€åé‡æ–°ç™»å½•ç”Ÿæ•ˆ

# 4. éªŒè¯å®‰è£…
docker --version
docker run hello-world

# 5. å®‰è£…è¾…åŠ©å·¥å…·
sudo pacman -S kubectl helm  # Kubernetes å·¥å…·
sudo pacman -S podman        # å¦ä¸€ä¸ªå®¹å™¨å¼•æ“
sudo pacman -S skopeo        # é•œåƒå·¥å…·
sudo pacman -S buildah       # é•œåƒæ„å»ºå·¥å…·
```

### é…ç½® Dockerï¼ˆå¯é€‰ï¼‰

```bash
# é…ç½®é•œåƒåŠ é€Ÿï¼ˆå›½å†…ç”¨æˆ·ï¼‰
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<EOF
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  },
  "storage-driver": "overlay2"
}
EOF

# é‡å¯ Docker
sudo systemctl restart docker

# éªŒè¯é…ç½®
docker info | grep -A 5 "Registry Mirrors"
```

---

## æ ¸å¿ƒæ¦‚å¿µæ€»ç»“

### å®¹å™¨çš„æœ¬è´¨

> **å®¹å™¨ = Namespace (éš”ç¦») + Cgroups (é™åˆ¶) + Chroot (æ–‡ä»¶ç³»ç»Ÿ) + UnionFS (åˆ†å±‚)**

```
æ™®é€šè¿›ç¨‹:
  è¿›ç¨‹ â†’ ç›´æ¥è¿è¡Œåœ¨ç³»ç»Ÿä¸Š â†’ å¯ä»¥çœ‹åˆ°æ‰€æœ‰èµ„æº

å®¹å™¨è¿›ç¨‹:
  è¿›ç¨‹ â†’ Namespace éš”ç¦» â†’ åªèƒ½çœ‹åˆ°è‡ªå·±çš„èµ„æº
       â†’ Cgroups é™åˆ¶ â†’ èµ„æºä½¿ç”¨å—é™
       â†’ Chroot éš”ç¦» â†’ ç‹¬ç«‹æ–‡ä»¶ç³»ç»Ÿ
       â†’ UnionFS â†’ é«˜æ•ˆé•œåƒå­˜å‚¨
```

### å®¹å™¨ä¸æ˜¯é­”æ³•

```bash
# å¯åŠ¨ä¸€ä¸ªå®¹å™¨
docker run -d nginx

# åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹
ps aux | grep nginx
# ä½ ä¼šçœ‹åˆ° nginx è¿›ç¨‹å°±åœ¨å®¿ä¸»æœºçš„è¿›ç¨‹åˆ—è¡¨ä¸­ï¼

# å®¹å™¨åªæ˜¯ä¸€ä¸ªè¢«"æ¬ºéª—"çš„è¿›ç¨‹
# å®ƒé€šè¿‡ Namespace "è®¤ä¸º"è‡ªå·±æ˜¯ç‹¬ç«‹çš„ç³»ç»Ÿ
# å®ƒé€šè¿‡ Cgroups è¢«é™åˆ¶äº†èµ„æºä½¿ç”¨
```

### å…³é”®ç†è§£

1. **å®¹å™¨å…±äº«å†…æ ¸**
   ```bash
   # å®¿ä¸»æœºå†…æ ¸ç‰ˆæœ¬
   uname -r  # 6.17.9-zen1-1-zen

   # å®¹å™¨å†…å†…æ ¸ç‰ˆæœ¬
   docker run alpine uname -r  # 6.17.9-zen1-1-zen (ç›¸åŒï¼)
   ```

2. **å®¹å™¨æ˜¯è¿›ç¨‹ï¼Œä¸æ˜¯miniè™šæ‹Ÿæœº**
   ```bash
   # é”™è¯¯ç†è§£: å®¹å™¨ = è½»é‡çº§è™šæ‹Ÿæœº
   # æ­£ç¡®ç†è§£: å®¹å™¨ = è¢«éš”ç¦»å’Œé™åˆ¶çš„è¿›ç¨‹
   ```

3. **é•œåƒæ˜¯åˆ†å±‚çš„**
   ```bash
   # Docker é•œåƒç”±å¤šå±‚ç»„æˆ
   # æ¯å±‚æ˜¯åªè¯»çš„
   # å®¹å™¨è¿è¡Œæ—¶åœ¨é¡¶éƒ¨æ·»åŠ å¯å†™å±‚
   ```

---

## ä¸‹ä¸€æ­¥

### æ¨èå­¦ä¹ è·¯å¾„

1. **å…ˆç†è§£æ¦‚å¿µ** â†’ é˜…è¯»æœ¬æ–‡æ¡£
2. **å­¦ä¹ åº•å±‚æŠ€æœ¯** â†’ [01-Namespaceè¯¦è§£](./01-Namespaceè¯¦è§£.md)
3. **åŠ¨æ‰‹å®éªŒ** â†’ è·Ÿéšæ–‡æ¡£ä¸­çš„ç¤ºä¾‹æ“ä½œ
4. **æ„å»ºå®¹å™¨** â†’ [06-æ‰‹åŠ¨æ„å»ºå®¹å™¨](./06-æ‰‹åŠ¨æ„å»ºå®¹å™¨.md)
5. **å­¦ä¹  Docker** â†’ [08-Dockeræ·±å…¥ç†è§£](./08-Dockeræ·±å…¥ç†è§£.md)
6. **è¿›é˜¶ K8s** â†’ [09-Kubernetesæ¶æ„](./09-Kubernetesæ¶æ„.md)

### å®è·µå»ºè®®

```bash
# 1. åˆ›å»ºå®éªŒç›®å½•
mkdir -p ~/container-lab
cd ~/container-lab

# 2. è·Ÿéšæ–‡æ¡£ï¼Œä¸€æ­¥æ­¥å®éªŒ
# 3. è®°å½•ç¬”è®°å’Œé‡åˆ°çš„é—®é¢˜
# 4. å°è¯•ä¿®æ”¹ç¤ºä¾‹ï¼Œç†è§£åŸç†
```

---

## å¸¸è§é—®é¢˜

### Q1: å®¹å™¨å’Œè™šæ‹Ÿæœºå¯ä»¥åŒæ—¶ä½¿ç”¨å—ï¼Ÿ
**A**: å¯ä»¥ï¼å¾ˆå¤šç”Ÿäº§ç¯å¢ƒåœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œå®¹å™¨ï¼Œè·å¾—åŒé‡éš”ç¦»ã€‚

### Q2: å®¹å™¨å®‰å…¨å—ï¼Ÿ
**A**: å®¹å™¨å…±äº«å†…æ ¸ï¼Œéš”ç¦»æ€§ä¸å¦‚è™šæ‹Ÿæœºã€‚ä½†é€šè¿‡æ­£ç¡®é…ç½®ï¼ˆUser Namespaceã€AppArmorã€SELinuxç­‰ï¼‰å¯ä»¥è¾¾åˆ°è¶³å¤Ÿçš„å®‰å…¨æ€§ã€‚

### Q3: Windows å¯ä»¥è¿è¡Œ Linux å®¹å™¨å—ï¼Ÿ
**A**: å¯ä»¥ï¼Œé€šè¿‡ WSL2ï¼ˆWindows Subsystem for Linux 2ï¼‰æˆ–è™šæ‹Ÿæœºã€‚

### Q4: å®¹å™¨é€‚åˆè¿è¡Œæ•°æ®åº“å—ï¼Ÿ
**A**: å¯ä»¥ï¼Œä½†éœ€è¦æ³¨æ„ï¼š
- ä½¿ç”¨ Volume æŒä¹…åŒ–æ•°æ®
- é…ç½®åˆé€‚çš„èµ„æºé™åˆ¶
- è€ƒè™‘æ€§èƒ½å½±å“

### Q5: å¦‚ä½•é€‰æ‹©å®¹å™¨è¿è¡Œæ—¶ï¼Ÿ
**A**:
- **å­¦ä¹ **: Dockerï¼ˆç”Ÿæ€æœ€å®Œæ•´ï¼‰
- **ç”Ÿäº§**: containerd + Kubernetes
- **æ—  root**: Podman

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Kubernetes æ–‡æ¡£](https://kubernetes.io/docs/)
- [Linux Namespace æ‰‹å†Œ](https://man7.org/linux/man-pages/man7/namespaces.7.html)
- [Cgroups æ–‡æ¡£](https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html)

### æ¨èé˜…è¯»
- ã€ŠDocker ä»å…¥é—¨åˆ°å®è·µã€‹
- ã€ŠKubernetes æƒå¨æŒ‡å—ã€‹
- ã€Šæ·±å…¥ç†è§£ Linux å†…æ ¸ã€‹

### åœ¨çº¿èµ„æº
- [Docker Blog](https://www.docker.com/blog/)
- [Kubernetes Blog](https://kubernetes.io/blog/)
- [CNCF](https://www.cncf.io/)

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ** è®©æˆ‘ä»¬ä» [01-Namespaceè¯¦è§£](./01-Namespaceè¯¦è§£.md) å¼€å§‹æ·±å…¥å­¦ä¹ å®¹å™¨çš„åº•å±‚æŠ€æœ¯ï¼

*æ›´æ–°æ—¥æœŸ: 2025-12-02*
*ä½œè€…: Claude Code*
