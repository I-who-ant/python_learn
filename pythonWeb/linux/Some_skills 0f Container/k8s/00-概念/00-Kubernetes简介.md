# Kubernetesç®€ä»‹

> Kubernetes æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆéœ€è¦å®ƒã€æ ¸å¿ƒä»·å€¼

## ä»€ä¹ˆæ˜¯ Kubernetes

Kubernetes (K8s) æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œç”¨äºè‡ªåŠ¨åŒ–å®¹å™¨åŒ–åº”ç”¨çš„éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚

### æ ¸å¿ƒå®šä¹‰

> **Kubernetes = å®¹å™¨ç¼–æ’ + è‡ªåŠ¨åŒ–è¿ç»´ + å£°æ˜å¼API**

```
ä¼ ç»Ÿéƒ¨ç½²                 å®¹å™¨åŒ–éƒ¨ç½²               Kubernetes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨ A   â”‚            â”‚ å®¹å™¨ A   â”‚            â”‚   è‡ªåŠ¨ç¼–æ’   â”‚
â”‚ åº”ç”¨ B   â”‚     â†’     â”‚ å®¹å™¨ B   â”‚     â†’     â”‚   è‡ªåŠ¨æ‰©å±•   â”‚
â”‚ ç‰©ç†æœº   â”‚            â”‚ å®¹å™¨ C   â”‚            â”‚   è‡ªæˆ‘ä¿®å¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   è´Ÿè½½å‡è¡¡   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åå­—ç”±æ¥

- **K8s**: "K" + 8ä¸ªå­—æ¯ + "s" = Kubernetes
- **èˆµæ‰‹/é£è¡Œå‘˜**: å¸Œè…Šè¯­ ÎºÏ…Î²ÎµÏÎ½Î®Ï„Î·Ï‚ (kuberná¸—tÄ“s)
- **Logo**: èˆ¹èˆµï¼Œè±¡å¾æŒæ§èˆªå‘

## ä¸ºä»€ä¹ˆéœ€è¦ Kubernetes

### è§£å†³çš„é—®é¢˜

#### 1. å®¹å™¨ç®¡ç†å¤æ‚

```bash
# æ²¡æœ‰ K8s - æ‰‹åŠ¨ç®¡ç†
docker run container1
docker run container2
docker run container3
# 100 ä¸ªå®¹å™¨ï¼Ÿå´©æºƒï¼

# æœ‰äº† K8s - å£°æ˜å¼ç®¡ç†
kubectl apply -f app.yaml
# è‡ªåŠ¨ç®¡ç†æ‰€æœ‰å®¹å™¨
```

#### 2. é«˜å¯ç”¨å›°éš¾

```
æ²¡æœ‰ K8s:
  å®¹å™¨æŒ‚äº† â†’ æ‰‹åŠ¨é‡å¯ â†’ å¯èƒ½å¿˜è®° â†’ æœåŠ¡ä¸­æ–­

æœ‰äº† K8s:
  å®¹å™¨æŒ‚äº† â†’ è‡ªåŠ¨æ£€æµ‹ â†’ è‡ªåŠ¨é‡å¯ â†’ æœåŠ¡ä¸ä¸­æ–­
```

#### 3. æ‰©å±•éº»çƒ¦

```
æµé‡æ¿€å¢:
  æ‰‹åŠ¨: é€ä¸ªå¯åŠ¨å®¹å™¨ â†’ é…ç½®è´Ÿè½½å‡è¡¡ â†’ å‡ åˆ†é’Ÿ
  K8s:  kubectl scale --replicas=10 â†’ å‡ ç§’é’Ÿ
```

#### 4. æ›´æ–°é£é™©é«˜

```
ä¼ ç»Ÿæ›´æ–°:
  åœæ­¢æœåŠ¡ â†’ æ›´æ–° â†’ é‡å¯ â†’ æœåŠ¡ä¸­æ–­

K8s æ»šåŠ¨æ›´æ–°:
  é€æ­¥æ›¿æ¢ â†’ å¥åº·æ£€æŸ¥ â†’ è‡ªåŠ¨å›æ»š â†’ é›¶åœæœº
```

### æ ¸å¿ƒä»·å€¼

#### å¯ç§»æ¤æ€§

```
å¼€å‘ç¯å¢ƒ â†’ æµ‹è¯•ç¯å¢ƒ â†’ ç”Ÿäº§ç¯å¢ƒ
   ç›¸åŒçš„ YAML é…ç½®ï¼Œä¸€é”®éƒ¨ç½²
```

#### è‡ªåŠ¨åŒ–
- âœ… è‡ªåŠ¨éƒ¨ç½²
- âœ… è‡ªåŠ¨æ‰©ç¼©å®¹
- âœ… è‡ªåŠ¨è´Ÿè½½å‡è¡¡
- âœ… è‡ªåŠ¨æ•…éšœæ¢å¤
- âœ… è‡ªåŠ¨æ»šåŠ¨æ›´æ–°

#### äº‘åŸç”Ÿ
- æ”¯æŒæ··åˆäº‘å’Œå¤šäº‘
- å‚å•†ä¸­ç«‹
- å¼€æºç”Ÿæ€ç¹è£

## Kubernetes æ ¸å¿ƒç‰¹æ€§

### 1. æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: MyApp
  ports:
  - port: 80
    targetPort: 9376
```

è‡ªåŠ¨ï¼š
- åˆ†é… IP åœ°å€
- DNS æœåŠ¡å‘ç°
- è´Ÿè½½å‡è¡¡è¯·æ±‚

### 2. å­˜å‚¨ç¼–æ’

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
```

æ”¯æŒï¼š
- æœ¬åœ°å­˜å‚¨
- äº‘å­˜å‚¨ (AWS EBS, GCE PD, Azure Disk)
- ç½‘ç»œå­˜å‚¨ (NFS, Ceph, GlusterFS)

### 3. è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  template:
    spec:
      containers:
      - name: nginx
        image: nginx:1.19
```

è‡ªåŠ¨ï¼š
- æ»šåŠ¨æ›´æ–°
- é‡‘ä¸é›€å‘å¸ƒ
- è“ç»¿éƒ¨ç½²
- å¤±è´¥è‡ªåŠ¨å›æ»š

### 4. è‡ªåŠ¨è£…ç®±ï¼ˆBin Packingï¼‰


```
K8s è‡ªåŠ¨å°†å®¹å™¨åˆ†é…åˆ°èŠ‚ç‚¹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 1  â”‚ Node 2  â”‚ Node 3  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Pod A   â”‚ Pod D   â”‚ Pod G   â”‚
â”‚ Pod B   â”‚ Pod E   â”‚ Pod H   â”‚
â”‚ Pod C   â”‚ Pod F   â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¹æ®èµ„æºéœ€æ±‚è‡ªåŠ¨åˆ†é…ï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡
```


### 5. è‡ªæˆ‘ä¿®å¤

```bash
# å®¹å™¨å´©æºƒ
Pod çŠ¶æ€: Running â†’ CrashLoopBackOff
K8s æ“ä½œ: è‡ªåŠ¨é‡å¯å®¹å™¨

# èŠ‚ç‚¹æ•…éšœ
Node çŠ¶æ€: Ready â†’ NotReady
K8s æ“ä½œ: å°† Pod é‡æ–°è°ƒåº¦åˆ°å¥åº·èŠ‚ç‚¹

# å¥åº·æ£€æŸ¥å¤±è´¥
å¥åº·æ£€æŸ¥: OK â†’ Failed
K8s æ“ä½œ: é‡å¯å®¹å™¨æˆ–åˆ é™¤ Pod
```

### 6. å¯†é’¥å’Œé…ç½®ç®¡ç†

```yaml
# ConfigMap - é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  database_url: "postgres://db:5432"

---
# Secret - å¯†é’¥
apiVersion: v1
kind: Secret
metadata:
  name: db-secret
type: Opaque
data:
  password: cGFzc3dvcmQ=  # base64
```

### 7. æ‰¹å¤„ç†

```yaml
# Job - ä¸€æ¬¡æ€§ä»»åŠ¡
apiVersion: batch/v1
kind: Job
metadata:
  name: data-import
spec:
  template:
    spec:
      containers:
      - name: importer
        image: myapp:latest
        command: ["./import.sh"]
      restartPolicy: Never

---
# CronJob - å®šæ—¶ä»»åŠ¡
apiVersion: batch/v1
kind: CronJob
metadata:
  name: backup
spec:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨2ç‚¹
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: backup
            image: backup:latest
          restartPolicy: OnFailure
```

### 8. æ°´å¹³æ‰©ç¼©å®¹

```yaml
# HPA - è‡ªåŠ¨æ‰©ç¼©å®¹
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: php-apache
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: php-apache
  minReplicas: 1
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 50
```

## Kubernetes æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Control Plane                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ API Server   â”‚  â”‚  etcd  â”‚  â”‚   Scheduler      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Controller Manager                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 1     â”‚  â”‚   Node 2     â”‚  â”‚   Node 3     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ kubelet  â”‚ â”‚  â”‚ â”‚ kubelet  â”‚ â”‚  â”‚ â”‚ kubelet  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Pods     â”‚ â”‚  â”‚ â”‚ Pods     â”‚ â”‚  â”‚ â”‚ Pods     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ§åˆ¶å¹³é¢ï¼ˆMasterï¼‰

- **API Server**: æ‰€æœ‰æ“ä½œçš„å…¥å£
- **etcd**: é›†ç¾¤æ•°æ®å­˜å‚¨
- **Scheduler**: Pod è°ƒåº¦å™¨
- **Controller Manager**: æ§åˆ¶å™¨ç®¡ç†

### å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰

- **kubelet**: èŠ‚ç‚¹ä»£ç†ï¼Œç®¡ç† Pod
- **kube-proxy**: ç½‘ç»œä»£ç†
- **Container Runtime**: å®¹å™¨è¿è¡Œæ—¶

## Kubernetes vs å…¶ä»–æ–¹æ¡ˆ

### vs Docker Swarm

| ç‰¹æ€§ | Kubernetes | Docker Swarm |
|-----|-----------|-------------|
| å¤æ‚åº¦ | è¾ƒé«˜ | ç®€å• |
| ç”Ÿæ€ | éå¸¸ä¸°å¯Œ | ä¸€èˆ¬ |
| ä¼ä¸šé‡‡ç”¨ | äº‹å®æ ‡å‡† | è¾ƒå°‘ |
| å­¦ä¹ æ›²çº¿ | é™¡å³­ | å¹³ç¼“ |
| åŠŸèƒ½ | éå¸¸å¼ºå¤§ | åŸºç¡€åŠŸèƒ½ |

### vs Apache Mesos

| ç‰¹æ€§ | Kubernetes | Mesos |
|-----|-----------|-------|
| ä¸“æ³¨ | å®¹å™¨ç¼–æ’ | é€šç”¨èµ„æºç®¡ç† |
| å®¹å™¨æ”¯æŒ | åŸç”Ÿ | é€šè¿‡ Marathon |
| ç¤¾åŒº | æ›´æ´»è·ƒ | ç›¸å¯¹å° |
| ä½¿ç”¨åœºæ™¯ | å®¹å™¨åº”ç”¨ | å¤§æ•°æ® + å®¹å™¨ |

## è°åœ¨ä½¿ç”¨ Kubernetes

### äº’è”ç½‘å…¬å¸
- Google (å‘æ˜è€…)
- é˜¿é‡Œå·´å·´
- è…¾è®¯
- å­—èŠ‚è·³åŠ¨
- ç¾å›¢

### ä¼ ç»Ÿä¼ä¸š
- é“¶è¡Œ
- ä¿é™©
- åˆ¶é€ ä¸š
- æ”¿åºœæœºæ„

### äº‘å‚å•†
- Google Cloud (GKE)
- AWS (EKS)
- Azure (AKS)
- é˜¿é‡Œäº‘ (ACK)

## Kubernetes ç”Ÿæ€ç³»ç»Ÿ

### CNCF é¡¹ç›®

```
å®¹å™¨è¿è¡Œæ—¶: containerd, CRI-O
ç½‘ç»œ: Calico, Flannel, Cilium, Weave
å­˜å‚¨: Rook, OpenEBS, Longhorn
æœåŠ¡ç½‘æ ¼: Istio, Linkerd, Consul
ç›‘æ§: Prometheus, Grafana
æ—¥å¿—: Fluentd, Loki
CI/CD: Argo CD, Flux, Tekton
å®‰å…¨: Falco, OPA, Cert-Manager
```

### å·¥å…·ç”Ÿæ€

```bash
# åŒ…ç®¡ç†
Helm - K8s çš„ npm/apt

# å¼€å‘å·¥å…·
Skaffold - æœ¬åœ°å¼€å‘
Tilt - å®æ—¶å¼€å‘

# è¿ç»´å·¥å…·
K9s - ç»ˆç«¯ UI
Lens - æ¡Œé¢ IDE
kubectl - å‘½ä»¤è¡Œ
```

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°ç¯å¢ƒ

```bash
# Minikube
minikube start

# æˆ– Kind
kind create cluster

# æˆ– K3d
k3d cluster create
```

### ç¬¬ä¸€ä¸ªåº”ç”¨

```bash
# 1. éƒ¨ç½²åº”ç”¨
kubectl create deployment nginx --image=nginx

# 2. æš´éœ²æœåŠ¡
kubectl expose deployment nginx --port=80 --type=NodePort

# 3. æŸ¥çœ‹
kubectl get pods
kubectl get services

# 4. è®¿é—®
minikube service nginx
```

## å­¦ä¹ è·¯å¾„

```
ç¬¬ä¸€å‘¨: åŸºç¡€æ¦‚å¿µ
  - Pod, Deployment, Service
  - kubectl åŸºæœ¬å‘½ä»¤
  - YAML é…ç½®æ–‡ä»¶

ç¬¬äºŒå‘¨: æ ¸å¿ƒåŠŸèƒ½
  - ConfigMap, Secret
  - Volume, PV/PVC
  - Namespace

ç¬¬ä¸‰å‘¨: ç½‘ç»œå’Œå­˜å‚¨
  - Service ç±»å‹
  - Ingress
  - StorageClass

ç¬¬å››å‘¨: é«˜çº§ç‰¹æ€§
  - StatefulSet
  - DaemonSet
  - Job, CronJob

åç»­: æ·±å…¥å®è·µ
  - RBAC å®‰å…¨
  - ç›‘æ§å‘Šè­¦
  - CI/CD é›†æˆ
```

## æ€»ç»“

### Kubernetes æ˜¯ä»€ä¹ˆ
- å®¹å™¨ç¼–æ’å¹³å°
- è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·
- äº‘åŸç”ŸåŸºç¡€è®¾æ–½

### æ ¸å¿ƒä»·å€¼
- ğŸš€ æé«˜å¼€å‘æ•ˆç‡
- ğŸ›¡ï¸ å¢å¼ºç³»ç»Ÿå¯é æ€§
- ğŸ“ˆ æ”¯æŒå¤§è§„æ¨¡æ‰©å±•
- ğŸŒ å®ç°å¤šäº‘éƒ¨ç½²
- ğŸ’° é™ä½è¿ç»´æˆæœ¬

### é€‚ç”¨åœºæ™¯
- âœ… å¾®æœåŠ¡æ¶æ„
- âœ… äº‘åŸç”Ÿåº”ç”¨
- âœ… æŒç»­äº¤ä»˜
- âœ… æ··åˆäº‘/å¤šäº‘
- âœ… å¤§è§„æ¨¡é›†ç¾¤

---

**ä¸‹ä¸€æ­¥**: å­¦ä¹  [Kuberneteså¯¹è±¡](./01-Kuberneteså¯¹è±¡.md)

*æ›´æ–°æ—¥æœŸ: 2025-12-03*
