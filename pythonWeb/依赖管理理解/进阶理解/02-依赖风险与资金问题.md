# 依赖风险与资金问题：可见性不等于重要性

## 文章来源

**标题**：Dependency Risk and Funding
**作者**：Armin Ronacher（Flask、Click、Jinja2 作者）
**发表日期**：2022年1月10日
**核心观点**：依赖的可见性（下载量）不等于其真正的重要性和价值

---

## 核心问题

### XKCD 漫画的启示

**XKCD #2347: Dependency**

**漫画描述**：
```
现代数字基础设施
┌─────────────────────────────────────┐
│  各种复杂的现代项目                  │
│  ┌──────┐ ┌──────┐ ┌──────┐        │
│  │项目A │ │项目B │ │项目C │        │
│  └──┬───┘ └��─┬───┘ └──┬───┘        │
│     └────────┴────────┘             │
│            │                        │
│     ┌──────┴──────┐                ���
│     │某个项目由某│                │
│     │人在内布拉斯│                │
│     │加维护了20年│                │
│     │从未被感谢  │                │
│     └────────────┘                 │
└─────────────────────────────────────┘
```

**作者的想象**：这个项目是 **Curl**

---

## Curl：真正关键的依赖

### Curl 的特征

**维护者**：Daniel Stenberg
**维护时间**：超过 20 年
**单人维护**：主要由一人维护

**无处不在**：


```
Curl 存在于：
✓ 游戏主机
✓ 汽车
✓ MP3 播放器
✓ 智能音箱
✓ 蓝光播放器
✓ 嵌入式设备
✓ 命令行工具
✓ 后端服务器
✓ ...无数其他设备
```


### 为什么 Curl 重要？

**三个标准**：

1. **解决复杂问题**
   - HTTP/HTTPS/FTP/SMTP 等多种协议
   - TLS/SSL 处理
   - 代理支持
   - 认证机制
   - ...

2. **不���小依赖**
   - 完整的功能包
   - 数万行代码
   - 经过充分测试

3. **社会影响**
   > "如果 curl 消失，对社会明显有害。"

### Curl 的韧性：不可摧毁的依赖

**为什么 Curl 无法被"杀死"？**

```
分发方式：
✓ 发行版镜像（Debian、Ubuntu、Red Hat...）
✓ Vendor 到其他库中
✓ 大量私有代码库中的 fork
✓ 系统预装
✓ 无数备份

结果：
→ 官网可以宕机，Curl 仍然存活
→ 原作者可以离开，有人会接手
→ 它太有用了，不可能消失
```

---

## Colors：脆弱的"关键"依赖

### Colors 的特征

**功能**：输出 ANSI 颜色代码
**npm 依赖量**：最高之一
**代码复杂度**：低

**典型用法**：
```javascript
import colors from 'colors'

console.log('错误'.red)
console.log('成功'.green)
console.log('警告'.yellow)

// 实际上就是输出：
// \x1b[31m错误\x1b[0m
// \x1b[32m成功\x1b[0m
// \x1b[33m警告\x1b[0m
```

### Curl vs Colors 对比

| 特性 | Curl | Colors |
|------|------|--------|
| **功能复杂度** | 高（多协议、TLS、认证） | 低（ANSI 代码） |
| **代码量** | 数万行 | 数百行 |
| **可替代性** | 难（需重写大量代码） | 易（很���人直接实现） |
| **分发方式** | 去中心化（镜像、vendor） | 中心化（npm） |
| **维护者权力** | 低（无法破坏生态） | 高（可一键破坏） |
| **社会价值** | 极高 | 中等 |

### 作者的例子

**作者写 Click 时的决定**：
> "当我写 click 时，我特意决定直接在我的库中实现 ANSI 着色，而不依赖其他东西。我的直觉是不需要很长时间就能撕掉和替换那个库。"

---

## 2022 年 Colors 事件

### 事件经过

**几天前（2022年1月）**：

```
1. colors 开发者发布新版本
2. 新版本不再提供宣传的功能
3. 因为是次要更新(minor update)，很多人自动升级
4. 项目崩溃
```

**用户甚至不知道依赖了它**：
- 他们不知道自己用了 "colors"
- 可能是依赖链中某个包引入的
- 传递依赖的隐形危害

### 开发���的理由

**在 GitHub repo 中找到**：

1. **README 包含**：阴谋论内容

2. **辩解理由**：
   - 对"财富 500 强"免费使用他的代码不满
   - 要求六位数合同
   - 否则让人们 fork

**作者的评论**：
```
这暴露了 npm (和其他包管理器) 发展成的问题：
→ 它们是难以置信的杠杆
→ 拥有大量依赖者的人可以轻易破坏现代数字基础设施
→ Daniel Stenberg (curl) 没有这种权力（可能也不想要）
```

---

## 依赖风险分析

### 高风险依赖的特征

```
高风险 = ��型 + 常用 + 单一维护者 + 包管理器分发

具体：
✓ 代码量小（<1000 行）
✓ 被大量项目依赖
✓ 单一未审核开发者
✓ 通过 npm/cargo/pypi 中心化分发
✓ 可以被作者随时破坏
```

### 为什么这些依赖成为基础？

**作者的洞察**：
> "许多这些依赖之所以变得基础性，不是因为它们解决了复杂问题，而是因为我们集体开始拥抱懒惰超过一切。"

**实例**：
- `is-odd`：每周 50 万下载
- `left-pad`：曾导致全球崩溃
- `colors`：可以随时破坏生态

**它们成为基础的原因**：
1. ❌ 不是因为技术复杂
2. ❌ 不是因为不可替代
3. ✅ 而是因为我们太懒得写几行代码

---

## 资金问题

### 当前的资金讨论

**现象**：
```
colors 事件发生
↓
所有人立即注意到
↓
人们呼吁资金支持
↓
焦点放在这类微依赖上
```

**问题**：
> "当我们把资金讨论聚焦在这些类型的依赖上时，我们隐含地也把焦点从真正重要的包上移开了。"

### GitHub Sponsors 的问题

**作者的态度**：
- ✅ 欣赏 GitHub Sponsors
- ✅ 这是个很棒的想法
- ✅ GitHub 指出开源资金是问题

**但是有阴暗面**：
> "不幸的是有阴暗面：它指向容易的地方。"

### 火星代码案例

**作者的经历**：

```
"我的代码飞向火星"
↓
这很棒！
↓
GitHub 爬取 Python 依赖列表
↓
我获得"火星代码"徽章
↓
lxml 开发者也获得徽章
```

**但是**：
```
Daniel Veillard (libxml2 维护者)
↓
没有获得徽章
↓
因为 libxml2 被 lxml 隐藏了
↓
人们甚至忘记 libxml2 的存在
```

### 安装过程的差异

**npm 包（lxml 的 Python 绑定）**：
```bash
pip install lxml
# 下载过程：
# 1. 从 PyPI 下载 lxml wheel
# 2. lxml 内部包含 libxml2（预编译）
# 3. 安装

# 依赖关系在 PyPI 中可见
```

**系统库（libxml2）**：
```bash
# lxml 安装时不从 PyPI 下载 libxml2
# libxml2 通常是：
# - 系统预装
# - 或通过系统包管理器安装（apt/yum）

apt install libxml2  # Debian/Ubuntu
yum install libxml2  # Red Hat/CentOS

# 依赖关系对 PyPI 不可见
```

**结果**：
```
PyPI/npm 只能看到自己生态内的依赖
↓
lxml 可见，libxml2 不可见
↓
GitHub 给 lxml 徽章
↓
libxml2 被忽视
```

---

## 真正值得资助的依赖

### libxml2 的贡献

**Daniel Veillard 的工作**：
- 维护 libxml2（XML 解析库）
- 被无数项目使用
- 但对大多数开发者不可见
- 被高级封装（lxml、nokogiri 等）隐藏

**投入**：
```
工作量：巨大
奉献精神：数十年
影响范围：全球
可见度：低（被封装隐藏）
```

**作者的感慨**：
> "他只是成千上万开发者中的一员，他们创造了我们至今仍在使用的卓越库。"

### 类似的隐形英雄

**其他例子**：

| 项目 | 维护者 | 可见性 | 重���性 |
|------|--------|--------|--------|
| **OpenSSL** | 小团队 | 低（被包装） | 极高 |
| **zlib** | Mark Adler 等 | 极低 | 极高 |
| **SQLite** | D. Richard Hipp | 中等 | 极高 |
| **FFmpeg** | 社区 | 低（被包装） | 极高 |
| **libpng** | 社区 | 极低 | 高 |

**共同特点**：
- 解决复杂问题
- 被广泛使用
- 但被高级库包装
- 对包管理器不可见
- 很少获得认可和资金

---

## 可见性 vs 重要性矩阵

### 四类依赖

```
        重要性高
           │
    高价值隐形  │  高价值可见
    (应资助)   │  (已获关注)
    ─────────┼─────────
    Curl      │  React
    libxml2   │  Vue
    OpenSSL   │  Flask
           │
───────────┼───────────  可见性
           │
    低价值隐形  │  低价值可见
    (无需关注)  │  (过度关注)
    ─────────┼─────────
    废弃包    │  colors
    内部工具  │  is-odd
           │  left-pad
           │
        重要性低
```

### 当前资金流向的问题

**错误的焦点**：
```
资金流向（实际）：
1. npm 高下���量包（colors、is-odd）
2. GitHub 可见的依赖（lxml）
3. 有争议的包（发生事件后）

资金应流向（理想）：
1. 解决复杂问题的库（Curl、OpenSSL）
2. 隐形但关键的基础设施（libxml2、zlib）
3. 长期稳定维护的项目（SQLite）
```

---

## 评估依赖影响的更好方式

### 当前方法的局限

**GitHub/npm 只看到**：
```python
# package.json 或 requirements.txt 中的依赖
{
  "dependencies": {
    "lxml": "^4.9.0"
  }
}

# 可见性：高
# 获得徽章：是
```

**看不到**：
```bash
# 系统级依赖
apt install libxml2

# 可见性：无
# 获得徽章：否
```

### 需要考虑的因素

**1. 技术复杂度**
```
简单：ANSI 颜色输出（colors）
中等：日期格式化（moment）
复杂：HTTP 协议（curl）
极复杂：TLS 实现（OpenSSL）
```

**2. 可替代性**
```
易替代：is-odd, left-pad
中等：date-fns, lodash
难替代：axios, express
几乎不可替代：curl, OpenSSL
```

**3. 破坏影响范围**
```
局部：内部工具
应用级：UI 组件库
生态级：构建工具
全球级：curl, OpenSSL
```

**4. 维护投入**
```
低：微包（几小时）
中：功能库（几个月）
高：框架（几年）
极高：基础设施（几十年）
```

### 更好的评估公式

```
真正价值 = 技术复杂度 × 不可替代性 × 影响范围 × 维护投入
          ÷ 可见性

示例：

Curl:
= 高复杂度(9) × 极难替代(10) × 全球影响(10) × 超长维护(10)
  ÷ 中等可见性(5)
= 1800

colors:
= 低复杂度(2) × 易替代(2) × 生态影响(7) × 低维护(2)
  ÷ 极高可见性(10)
= 5.6

libxml2:
= 极高复杂度(10) × 极难替代(10) × 全球影响(10) × 超长维护(10)
  ÷ 极低可见性(2)
= 5000  ← 最需要资助！
```

---

## 作者的结论

### 需要解决的问题

**作者的立场**：
> "显然我们需要解决开源项目的资金问题，我很高兴 GitHub Sponsors 存在。"

**但是**：
> "我们需要找到比仅仅看 npm 或其他包管理器上有多少人依赖这个更好的方式来评估库的影响。因为这远非全貌。"

### 三个层面的问题

**1. 技术层面**：
- 依赖可见性不等于重要性
- 包管理器只看到自己生态内的依赖
- 系统级依赖被忽视

**2. 社会层面**：
- 资金流向错误的地方
- 微包获得过多关注
- 基础设施被忽视

**3. 文化层面**：
- 我们庆祝错误的东西（高下载量）
- 忽视真正的英雄（隐形维护者）
- 被懒惰驱动而非价值驱动

---

## 实际建议

### 作为捐赠者/资助者

**评估依赖价值时问**：

```
□ 这个库解决了复杂问题吗？
□ 如果它消失，会有严重影响吗？
□ 维护者投入了多少时间？
□ 有多少其他库/项目依赖它（包括间接）？
□ 它是被高级库包装的底层库吗？
□ 维护者是否长期稳定维护？
```

**优先资助**：
1. ✅ 底层基础设施（libxml2、zlib）
2. ✅ 解决复杂问题的库（Curl、OpenSSL）
3. ✅ 长期稳定维护的项目（SQLite）
4. ❌ 不优先：高可见但低复杂度的微包

### 作为平台（GitHub/PyPI/npm）

**改进建议**：

1. **扩展依赖分析**
   ```python
   # 不仅爬取 package.json
   # 也分析：
   - 系统依赖（通过 apt/yum）
   - C 库依赖（通过链接分析）
   - 间接影响（谁使用了使用我的库的库）
   ```

2. **多维度评分**
   ```
   不只是：下载量
   还应考虑：
   - 代码复杂度
   - 维护时长
   - 影响范围
   - 可替代性
   ```

3. **表彰隐形英雄**
   ```
   GitHub 徽章应给：
   ✓ libxml2 (被 lxml 依赖)
   ✓ OpenSSL (被所有 HTTPS 库依赖)
   ✓ zlib (被所有压缩功能依赖)

   而不仅仅是：
   - 直接在 requirements.txt 中的包
   ```

### 作为开发者

**意识到**：

1. **你依赖的隐形英雄**
   ```bash
   # 检查你的系统依赖
   ldd /usr/bin/python3
   # 你会看到：
   # libssl.so（OpenSSL）
   # libz.so（zlib）
   # libxml2.so（libxml2）
   # ...
   ```

2. **考虑支持**
   - 不只是你 package.json 中的包
   - 也包括这些底层基础设施

3. **传播认知**
   - 在你的项目中致谢底层依赖
   - 教育团队关于隐形依赖的重要性

---

## 总结

### 核心洞察

1. **可见性 ≠ 重要性**
   - npm 下载量高不代表真正重要
   - 系统级库更重要但不可见

2. **杠杆 ≠ 价值**
   - colors 有破坏力但价值有限
   - Curl 价值巨大但无破坏力（太分散）

3. **资金流向错误**
   - 微包获得过多关注
   - 基础设施被忽视

4. **评估方法有缺陷**
   - 包管理器只看到自己生态
   - 需要更全面的影响评估

### 金句

> "许多这些依赖之所以变得基础性，不是因为它们解决了复杂问题，而是因为我们集体开始拥抱懒惰超过一切。"

> "如果 curl 消失，对社会明显有害。"

> "Daniel Veillard 没有获得徽章，因为 libxml2 被高级封装隐藏了。"

> "我们需要找到比仅仅看 npm 上有多少人依赖这个更好的方式来评估库的影响。因为这远非全貌。"

---

**下一步**：阅读 [03-技术债证券化.md](./03-技术债证券化.md) 了解依赖维护的困境
