# Chapter 07 - é¢å‘å¯¹è±¡ç¼–ç¨‹è¿›é˜¶

> **æœ¬ç« ä¸»é¢˜**: Python ç±»çš„é«˜çº§ç‰¹æ€§å’Œé­”æ³•æ–¹æ³•
> **é¢å‘**: æœ‰ Java å¼€å‘ç»éªŒçš„å­¦ä¹ è€…

---

## ç›®å½•
1. [åç§°ä¿®é¥° (Name Mangling)](#1-åç§°ä¿®é¥°-name-mangling)
2. [ç±»æ–¹æ³•ä¸é™æ€æ–¹æ³•](#2-ç±»æ–¹æ³•ä¸é™æ€æ–¹æ³•)
3. [å±æ€§ (Properties)](#3-å±æ€§-properties)
4. [é­”æ³•æ–¹æ³• (Magic Methods)](#4-é­”æ³•æ–¹æ³•-magic-methods)
5. [è¿ç®—ç¬¦é‡è½½](#5-è¿ç®—ç¬¦é‡è½½)
6. [å¯¹è±¡æ¨¡å¼åŒ¹é…](#6-å¯¹è±¡æ¨¡å¼åŒ¹é…)
7. [ç±»è£…é¥°å™¨](#7-ç±»è£…é¥°å™¨)

---

## 1. åç§°ä¿®é¥° (Name Mangling)

### 1.1 åŒä¸‹åˆ’çº¿å‰ç¼€

#### Python å®ç°
```python
class Message:
    def __init__(self):
        self.__format = "UTF-8"  # åŒä¸‹åˆ’çº¿å‰ç¼€

msg = Message()
# print(msg.__format)  # âŒ AttributeError: 'Message' object has no attribute '__format'

# å®é™…è¢«é‡å‘½åä¸º _ClassName__attribute
print(msg._Message__format)  # âœ… "UTF-8"
```

**å·¥ä½œåŸç†:**
- åŒä¸‹åˆ’çº¿å¼€å¤´çš„å±æ€§ä¼šè¢«è‡ªåŠ¨é‡å‘½åä¸º `_ClassName__attribute`
- ç›®çš„: é¿å…å­ç±»æ„å¤–è¦†ç›–çˆ¶ç±»çš„ç§æœ‰å±æ€§
- **ä¸æ˜¯çœŸæ­£çš„ç§æœ‰**,ä»ç„¶å¯ä»¥é€šè¿‡ä¿®é¥°åçš„åç§°è®¿é—®

#### Java å¯¹æ¯”
```java
public class Message {
    // Java çš„ private æ˜¯çœŸæ­£ç§æœ‰çš„
    private String format = "UTF-8";

    public Message() {
        this.format = "UTF-8";
    }

    // å¤–éƒ¨æ— æ³•è®¿é—®
    // message.format;  // ç¼–è¯‘é”™è¯¯

    // éœ€è¦æä¾› getter
    public String getFormat() {
        return format;
    }
}

Message msg = new Message();
// msg.format;  // ç¼–è¯‘é”™è¯¯: format has private access
System.out.println(msg.getFormat());  // âœ… "UTF-8"
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python Name Mangling | Java Private |
|------|---------------------|--------------|
| çœŸæ­£ç§æœ‰ | âŒ åªæ˜¯åç§°ä¿®é¥° | âœ… ç¼–è¯‘å™¨å¼ºåˆ¶ |
| è®¿é—®æ–¹å¼ | `_ClassName__attr` | âŒ æ— æ³•ç›´æ¥è®¿é—® |
| ç›®çš„ | é¿å…å‘½åå†²çª | å°è£…å’Œéšè— |
| çº¦å®š | å•ä¸‹åˆ’çº¿ `_` = protected | `private`, `protected` |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Python æ²¡æœ‰çœŸæ­£çš„ç§æœ‰å±æ€§**,éƒ½æ˜¯çº¦å®š
- âš ï¸ å•ä¸‹åˆ’çº¿ `_attr` è¡¨ç¤º"å†…éƒ¨ä½¿ç”¨,ä½†å¯ä»¥è®¿é—®"
- âš ï¸ åŒä¸‹åˆ’çº¿ `__attr` è¡¨ç¤º"å¼ºçƒˆå»ºè®®ä¸è¦è®¿é—®"
- âš ï¸ ä¸è¦è¿‡åº¦ä½¿ç”¨ name mangling,é€šå¸¸å•ä¸‹åˆ’çº¿è¶³å¤Ÿ
- ğŸ“Œ è®°å¿†: "Python é çº¦å®š,ä¸é ç¼–è¯‘å™¨å¼ºåˆ¶"

**ç›¸å…³æ–‡ä»¶:** `message.py:1-9`

---

## 2. ç±»æ–¹æ³•ä¸é™æ€æ–¹æ³•

### 2.1 å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•å¯¹æ¯”

#### Python å®ç°
```python
class SecretAgent:
    _codeword = ""  # ç±»å˜é‡

    def __init__(self, codename):
        self.codename = codename  # å®ä¾‹å˜é‡
        self._secrets = []

    # å®ä¾‹æ–¹æ³•: æ¥æ”¶ self,è®¿é—®å®ä¾‹å±æ€§
    def remember(self, secret):
        self._secrets.append(secret)

    # ç±»æ–¹æ³•: æ¥æ”¶ cls,è®¿é—®/ä¿®æ”¹ç±»å±æ€§
    @classmethod
    def inform(cls, codeword):
        cls._codeword = codeword

    # é™æ€æ–¹æ³•: ä¸æ¥æ”¶ self æˆ– cls,çº¯å‡½æ•°
    @staticmethod
    def inquire(question):
        print("I know nothing.")
```

**ä½¿ç”¨ç¤ºä¾‹:**
```python
# å®ä¾‹æ–¹æ³• - é€šè¿‡å®ä¾‹è°ƒç”¨
mouse = SecretAgent("Mouse")
mouse.remember("Secret location")

# ç±»æ–¹æ³• - é€šè¿‡ç±»æˆ–å®ä¾‹è°ƒç”¨
SecretAgent.inform("The goose honks at midnight.")
mouse.inform("The duck quacks at midnight.")  # ä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è°ƒç”¨

print(mouse._codeword)  # "The duck quacks at midnight."

# é™æ€æ–¹æ³• - é€šè¿‡ç±»æˆ–å®ä¾‹è°ƒç”¨
SecretAgent.inquire("Where is the base?")
mouse.inquire("What's the password?")
```

#### Java å¯¹æ¯”
```java
public class SecretAgent {
    // ç±»å˜é‡ (static)
    private static String codeword = "";

    // å®ä¾‹å˜é‡
    private String codename;
    private List<String> secrets;

    // æ„é€ å‡½æ•°
    public SecretAgent(String codename) {
        this.codename = codename;
        this.secrets = new ArrayList<>();
    }

    // å®ä¾‹æ–¹æ³•: å¯ä»¥è®¿é—®å®ä¾‹å’Œç±»å˜é‡
    public void remember(String secret) {
        secrets.add(secret);
    }

    // é™æ€æ–¹æ³•: åªèƒ½è®¿é—®é™æ€å˜é‡
    public static void inform(String newCodeword) {
        codeword = newCodeword;
    }

    // é™æ€æ–¹æ³•: çº¯å‡½æ•°
    public static void inquire(String question) {
        System.out.println("I know nothing.");
    }
}

// ä½¿ç”¨
SecretAgent mouse = new SecretAgent("Mouse");
mouse.remember("Secret location");

// é™æ€æ–¹æ³• - é€šè¿‡ç±»åè°ƒç”¨ (æ¨è)
SecretAgent.inform("The goose honks at midnight.");
// ä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è°ƒç”¨ (ä¸æ¨è)
mouse.inform("The duck quacks at midnight.");

SecretAgent.inquire("Where is the base?");
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| å®ä¾‹æ–¹æ³• | `def method(self):` | `public void method()` |
| ç±»æ–¹æ³• | `@classmethod def method(cls):` | âŒ æ— å¯¹åº” (ç”¨é™æ€æ–¹æ³•) |
| é™æ€æ–¹æ³• | `@staticmethod def method():` | `public static void method()` |
| ç±»æ–¹æ³•ç”¨é€” | å·¥å‚æ–¹æ³•ã€ä¿®æ”¹ç±»çŠ¶æ€ | é€šå¸¸ç”¨é™æ€æ–¹æ³•ä»£æ›¿ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `@staticmethod` = Java çš„ `static` æ–¹æ³•
- âš ï¸ **Python çš„ `@classmethod` åœ¨ Java ä¸­æ²¡æœ‰ç›´æ¥å¯¹åº”**
  - æ¥æ”¶ `cls` å‚æ•°,å¯ä»¥è®¿é—®ç±»æœ¬èº«
  - å¸¸ç”¨äºå·¥å‚æ–¹æ³•: `@classmethod def from_string(cls, s):`
  - å¯ä»¥è¢«å­ç±»æ­£ç¡®ç»§æ‰¿
- âš ï¸ Python é™æ€æ–¹æ³•ä¸èƒ½è®¿é—®ç±»æˆ–å®ä¾‹å±æ€§,çº¯å‡½æ•°
- ğŸ“Œ è®°å¿†: "classmethod æœ‰ cls,staticmethod å•¥éƒ½æ²¡æœ‰"

**ç›¸å…³æ–‡ä»¶:** `secret_agent.py:12-21`, `secret_agent_usage.py:14-20`

### 2.2 ç±»æ–¹æ³•çš„ç»§æ‰¿ç‰¹æ€§

```python
class Agent:
    @classmethod
    def create(cls, name):
        return cls(name)  # cls æ˜¯è°ƒç”¨æ—¶çš„å®é™…ç±»

class SecretAgent(Agent):
    pass

class DoubleAgent(Agent):
    pass

# cls ä¼šè‡ªåŠ¨ç»‘å®šåˆ°æ­£ç¡®çš„ç±»
secret = SecretAgent.create("Bond")    # cls = SecretAgent
double = DoubleAgent.create("Bourne")  # cls = DoubleAgent

print(type(secret))  # <class 'SecretAgent'>
print(type(double))  # <class 'DoubleAgent'>
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… ç±»æ–¹æ³•æ˜¯å·¥å‚æ¨¡å¼çš„æœ€ä½³å®è·µ
- âš ï¸ `cls` å‚æ•°è®©å·¥å‚æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†å­ç±»
- âš ï¸ Java éœ€è¦åœ¨æ¯ä¸ªå­ç±»é‡å†™å·¥å‚æ–¹æ³•
- ğŸ“Œ è®°å¿†: "classmethod = æ™ºèƒ½çš„å·¥å‚æ–¹æ³•"

---

## 3. å±æ€§ (Properties)

### 3.1 @property è£…é¥°å™¨

#### Python å®ç°
```python
class SecretAgent:
    def __init__(self, codename):
        self.codename = codename
        self._secrets = []  # ç§æœ‰å­˜å‚¨

    # æ–¹æ³• 3: ä½¿ç”¨ @property è£…é¥°å™¨ (æ¨è)
    @property
    def secret(self):
        """Getter: è¯»å–æœ€åä¸€ä¸ªç§˜å¯†"""
        return self._secrets[-1] if self._secrets else None

    @secret.setter
    def secret(self, value):
        """Setter: æ·»åŠ æ–°ç§˜å¯†"""
        self._secrets.append(self._encrypt(value))

    @secret.deleter
    def secret(self):
        """Deleter: æ¸…ç©ºæ‰€æœ‰ç§˜å¯†"""
        self._secrets = []

    @classmethod
    def _encrypt(cls, message):
        # åŠ å¯†é€»è¾‘
        return message

# ä½¿ç”¨: åƒæ™®é€šå±æ€§ä¸€æ ·è®¿é—®
mouse = SecretAgent("Mouse")
mouse.secret = "12345 Main Street"  # è°ƒç”¨ setter
print(mouse.secret)                  # è°ƒç”¨ getter
del mouse.secret                     # è°ƒç”¨ deleter
```

**å¦å¤–ä¸¤ç§å®šä¹‰æ–¹å¼:**
```python
# æ–¹å¼ 1: ä½¿ç”¨ property() å‡½æ•°
class SecretAgent:
    def _get_secret(self):
        return self._secrets[-1] if self._secrets else None

    def _set_secret(self, value):
        self._secrets.append(value)

    def _del_secret(self):
        self._secrets = []

    secret = property(fget=_get_secret, fset=_set_secret, fdel=_del_secret)

# æ–¹å¼ 2: å…ˆåˆ›å»º property,å†æ·»åŠ è£…é¥°å™¨
class SecretAgent:
    secret = property()

    @secret.getter
    def secret(self):
        return self._secrets[-1] if self._secrets else None

    @secret.setter
    def secret(self, value):
        self._secrets.append(value)
```

#### Java å¯¹æ¯”
```java
public class SecretAgent {
    private String codename;
    private List<String> secrets = new ArrayList<>();

    public SecretAgent(String codename) {
        this.codename = codename;
    }

    // Getter
    public String getSecret() {
        return secrets.isEmpty() ? null : secrets.get(secrets.size() - 1);
    }

    // Setter
    public void setSecret(String value) {
        secrets.add(encrypt(value));
    }

    // Java æ²¡æœ‰ deleter æ¦‚å¿µ,éœ€è¦å•ç‹¬çš„æ–¹æ³•
    public void clearSecrets() {
        secrets.clear();
    }

    private String encrypt(String message) {
        // åŠ å¯†é€»è¾‘
        return message;
    }
}

// ä½¿ç”¨
SecretAgent mouse = new SecretAgent("Mouse");
mouse.setSecret("12345 Main Street");  // å¿…é¡»è°ƒç”¨æ–¹æ³•
System.out.println(mouse.getSecret());
mouse.clearSecrets();
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python @property | Java Getter/Setter |
|------|------------------|-------------------|
| è¯­æ³• | åƒå±æ€§ä¸€æ ·è®¿é—® | å¿…é¡»è°ƒç”¨æ–¹æ³• |
| Getter | `@property` | `getXxx()` |
| Setter | `@xxx.setter` | `setXxx()` |
| Deleter | `@xxx.deleter` | âŒ æ— å¯¹åº” |
| å‘½åçº¦å®š | åŒå | `get/set` å‰ç¼€ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `@property` â‰ˆ Java çš„ Getter/Setter,ä½†è¯­æ³•æ›´ä¼˜é›…
- âš ï¸ **å¯ä»¥æŠŠæ–¹æ³•ä¼ªè£…æˆå±æ€§**,å¤–éƒ¨ä¸çŸ¥é“æœ‰è®¡ç®—é€»è¾‘
- âš ï¸ é€‚åˆæ·»åŠ éªŒè¯ã€è®¡ç®—ã€å»¶è¿ŸåŠ è½½ç­‰é€»è¾‘
- âš ï¸ ä¸è¦åœ¨ property ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ,ä¼šè®©äººè¯¯ä»¥ä¸ºæ˜¯ç®€å•å±æ€§è®¿é—®
- ğŸ“Œ è®°å¿†: "property = å¯è®¡ç®—çš„å±æ€§"

**ç¤ºä¾‹: è®¡ç®—å±æ€§**
```python
class GlobalCoordinates:
    def __init__(self, *, latitude, longitude):
        self._lat_deg = latitude[0]
        self._lat_min = latitude[1]
        # ...

    @property
    def latitude(self):
        """ä»åº¦åˆ†ç§’è®¡ç®—åè¿›åˆ¶çº¬åº¦"""
        return self._lat_deg + self._lat_min / 60 + self._lat_sec / 3600

# ä½¿ç”¨: åƒæ™®é€šå±æ€§ä¸€æ ·
coords = GlobalCoordinates(latitude=(37, 46, 32.6, "N"), ...)
print(coords.latitude)  # è‡ªåŠ¨è®¡ç®—
```

**ç›¸å…³æ–‡ä»¶:** `secret_agent_property.py:61-85`, `global_coordinates.py:39-49`

---

## 4. é­”æ³•æ–¹æ³• (Magic Methods)

### 4.1 å¯¹è±¡è¡¨ç¤º: `__repr__` å’Œ `__str__`

#### Python å®ç°
```python
class GlobalCoordinates:
    def __init__(self, *, latitude, longitude):
        self._lat_deg = latitude[0]
        # ... å…¶ä»–åˆå§‹åŒ–

    def __repr__(self):
        """å¼€å‘è€…å‹å¥½çš„è¡¨ç¤º,ç”¨äºè°ƒè¯•"""
        return (
            f"<GlobalCoordinates "
            f"lat={self._lat_deg}Â°{self._lat_min}'"
            f"{self._lat_sec}\"{self._lat_dir} "
            f"lon={self._lon_deg}Â°{self._lon_min}'"
            f"{self._lon_sec}\"{self._lon_dir}>"
        )

    def __str__(self):
        """ç”¨æˆ·å‹å¥½çš„è¡¨ç¤º,ç”¨äºæ˜¾ç¤º"""
        return (
            f"{self._lat_deg}Â°{self._lat_min}'"
            f"{self._lat_sec}\"{self._lat_dir} "
            f"{self._lon_deg}Â°{self._lon_min}'"
            f"{self._lon_sec}\"{self._lon_dir}>"
        )

coords = GlobalCoordinates(latitude=(37, 46, 32.6, "N"), longitude=(122, 24, 39.4, "W"))
print(repr(coords))  # <GlobalCoordinates lat=37Â°46'32.6"N lon=122Â°24'39.4"W>
print(str(coords))   # 37Â°46'32.6"N 122Â°24'39.4"W>
print(coords)        # é»˜è®¤è°ƒç”¨ __str__
```

#### Java å¯¹æ¯”
```java
public class GlobalCoordinates {
    private int latDeg;
    private int latMin;
    // ... å…¶ä»–å­—æ®µ

    public GlobalCoordinates(int[] latitude, int[] longitude) {
        this.latDeg = latitude[0];
        // ... å…¶ä»–åˆå§‹åŒ–
    }

    // ç±»ä¼¼ Python çš„ __repr__ å’Œ __str__
    @Override
    public String toString() {
        return String.format(
            "%dÂ°%d'%.1f\"%s %dÂ°%d'%.1f\"%s",
            latDeg, latMin, latSec, latDir,
            lonDeg, lonMin, lonSec, lonDir
        );
    }
}

GlobalCoordinates coords = new GlobalCoordinates(
    new int[]{37, 46, 32, 'N'},
    new int[]{122, 24, 39, 'W'}
);
System.out.println(coords);  // è°ƒç”¨ toString()
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| è°ƒè¯•è¡¨ç¤º | `__repr__` | `toString()` |
| ç”¨æˆ·è¡¨ç¤º | `__str__` | `toString()` |
| é»˜è®¤è°ƒç”¨ | `__str__`,æ²¡æœ‰åˆ™ç”¨ `__repr__` | `toString()` |
| ç›®çš„ | ä¸¤ç§ä¸åŒçš„è¡¨ç¤º | å•ä¸€è¡¨ç¤º |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `__repr__` + `__str__` â‰ˆ Java çš„ `toString()`
- âš ï¸ `__repr__` åº”è¯¥æ˜¯æ˜ç¡®çš„,æœ€å¥½èƒ½ `eval(repr(obj)) == obj`
- âš ï¸ `__str__` åº”è¯¥æ˜¯å¯è¯»çš„,é¢å‘æœ€ç»ˆç”¨æˆ·
- ğŸ“Œ è®°å¿†: "repr for developers, str for users"

**ç›¸å…³æ–‡ä»¶:** `global_coordinates.py:51-66`

### 4.2 ææ„æ–¹æ³•: `__del__`

#### Python å®ç°
```python
class SecretAgent:
    def __init__(self, codename):
        self.codename = codename

    def __del__(self):
        """å¯¹è±¡è¢«é”€æ¯æ—¶è°ƒç”¨"""
        print(f"Agent {self.codename} has been disavowed!")

weasel = SecretAgent("Weasel")
del weasel  # è§¦å‘ __del__
# è¾“å‡º: Agent Weasel has been disavowed!
```

#### Java å¯¹æ¯”
```java
public class SecretAgent {
    private String codename;

    public SecretAgent(String codename) {
        this.codename = codename;
    }

    // finalize() å·²è¢«å¼ƒç”¨
    @Deprecated
    protected void finalize() throws Throwable {
        try {
            System.out.println("Agent " + codename + " has been disavowed!");
        } finally {
            super.finalize();
        }
    }

    // æ¨èä½¿ç”¨ try-with-resources å’Œ AutoCloseable
    public void close() {
        System.out.println("Agent " + codename + " has been disavowed!");
    }
}

// ä½¿ç”¨ try-with-resources (æ¨è)
try (SecretAgent weasel = new SecretAgent("Weasel")) {
    // ä½¿ç”¨å¯¹è±¡
}  // è‡ªåŠ¨è°ƒç”¨ close()
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python `__del__` | Java `finalize()` |
|------|-----------------|-------------------|
| è°ƒç”¨æ—¶æœº | å¯¹è±¡é”€æ¯æ—¶ | GC å›æ”¶æ—¶ (ä¸ç¡®å®š) |
| å¯é æ€§ | âš ï¸ ä¸ä¿è¯è°ƒç”¨ | âš ï¸ ä¸ä¿è¯è°ƒç”¨ |
| æ¨èä½¿ç”¨ | âš ï¸ ä¸æ¨è | âŒ å·²å¼ƒç”¨ |
| æ›¿ä»£æ–¹æ¡ˆ | ä¸Šä¸‹æ–‡ç®¡ç†å™¨ | `AutoCloseable` |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **ä¸è¦ä¾èµ– `__del__` åšèµ„æºæ¸…ç†**,ä¸ä¿è¯ä½•æ—¶/æ˜¯å¦è°ƒç”¨
- âœ… ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (`with` è¯­å¥) ä»£æ›¿
- âš ï¸ Java çš„ `finalize()` ä¹Ÿä¸å¯é ,å·²è¢«å¼ƒç”¨
- ğŸ“Œ è®°å¿†: "__del__ ä»…ç”¨äºè°ƒè¯•,ä¸ç”¨äºèµ„æºç®¡ç†"

**ç›¸å…³æ–‡ä»¶:** `secret_agent_disavow.py:1-3`

---

## 5. è¿ç®—ç¬¦é‡è½½

### 5.1 æ¯”è¾ƒè¿ç®—ç¬¦: `__eq__` å’Œ `__hash__`

#### Python å®ç°
```python
class GlobalCoordinates:
    def __init__(self, *, latitude, longitude):
        # ... åˆå§‹åŒ–

    def __eq__(self, other):
        """ç›¸ç­‰æ€§æ¯”è¾ƒ: =="""
        if not isinstance(other, GlobalCoordinates):
            return NotImplemented  # è®© Python å°è¯•å…¶ä»–æ–¹å¼

        return (
            self._lat_deg == other._lat_deg
            and self._lat_min == other._lat_min
            and self._lat_sec == other._lat_sec
            and self._lat_dir == other._lat_dir
            # ... å…¶ä»–å­—æ®µ
        )

    def __hash__(self):
        """è®¡ç®—å“ˆå¸Œå€¼,ç”¨äº set å’Œ dict"""
        return hash((
            self._lat_deg, self._lat_min, self._lat_sec, self._lat_dir,
            self._lon_deg, self._lon_min, self._lon_sec, self._lon_dir
        ))

# ä½¿ç”¨
coords1 = GlobalCoordinates(latitude=(37, 46, 32.6, "N"), ...)
coords2 = GlobalCoordinates(latitude=(37, 46, 32.6, "N"), ...)

print(coords1 == coords2)  # True
print(coords1 is coords2)  # False (ä¸åŒå¯¹è±¡)

# å¯ä»¥ç”¨ä½œ dict é”®æˆ–æ”¾å…¥ set
locations = {coords1: "No Starch Press"}
```

#### Java å¯¹æ¯”
```java
public class GlobalCoordinates {
    private int latDeg, latMin;
    private double latSec;
    private char latDir;
    // ... å…¶ä»–å­—æ®µ

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;

        GlobalCoordinates other = (GlobalCoordinates) obj;
        return latDeg == other.latDeg
            && latMin == other.latMin
            && Double.compare(latSec, other.latSec) == 0
            && latDir == other.latDir;
            // ... å…¶ä»–å­—æ®µ
    }

    @Override
    public int hashCode() {
        return Objects.hash(latDeg, latMin, latSec, latDir, /* ... */);
    }
}

// ä½¿ç”¨
GlobalCoordinates coords1 = new GlobalCoordinates(...);
GlobalCoordinates coords2 = new GlobalCoordinates(...);

System.out.println(coords1.equals(coords2));  // true
System.out.println(coords1 == coords2);        // false (ä¸åŒå¯¹è±¡)

// å¯ä»¥ç”¨ä½œ HashMap é”®æˆ–æ”¾å…¥ HashSet
Map<GlobalCoordinates, String> locations = new HashMap<>();
locations.put(coords1, "No Starch Press");
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| ç›¸ç­‰æ¯”è¾ƒ | `__eq__(self, other)` | `equals(Object obj)` |
| å“ˆå¸Œå€¼ | `__hash__(self)` | `hashCode()` |
| è¿”å›å€¼ | `NotImplemented` | `false` |
| é»˜è®¤è¡Œä¸º | èº«ä»½æ¯”è¾ƒ (`is`) | èº«ä»½æ¯”è¾ƒ (`==`) |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `__eq__` = Java çš„ `equals()`
- âœ… Python çš„ `__hash__` = Java çš„ `hashCode()`
- âš ï¸ **é‡å†™ `__eq__` å¿…é¡»åŒæ—¶é‡å†™ `__hash__`**,å¦åˆ™å¯¹è±¡ä¸èƒ½ç”¨äº set/dict
- âš ï¸ è¿”å› `NotImplemented` è®© Python å°è¯•åå‘æ¯”è¾ƒ
- ğŸ“Œ è®°å¿†: "eq å’Œ hash å¿…é¡»æˆå¯¹é‡å†™"

**ç›¸å…³æ–‡ä»¶:** `global_coordinates.py:68-87`

### 5.2 ç®—æœ¯è¿ç®—ç¬¦

#### Python å®ç°
```python
class GlobalCoordinates:
    def __sub__(self, other):
        """å‡æ³•è¿ç®—ç¬¦: -"""
        if not isinstance(other, GlobalCoordinates):
            return NotImplemented

        lat_diff = self.latitude - other.latitude
        lon_diff = self.longitude - other.longitude
        return (lat_diff, lon_diff)

    def __invert__(self):
        """å–åè¿ç®—ç¬¦: ~"""
        return GlobalCoordinates(
            latitude=self.degrees_from_decimal(-self.latitude, lat=True),
            longitude=self.degrees_from_decimal(-self.longitude, lat=False)
        )

# ä½¿ç”¨
coords1 = GlobalCoordinates(latitude=(37, 46, 32.6, "N"), ...)
coords2 = GlobalCoordinates(latitude=(45, 27, 7.7, "N"), ...)

diff = coords1 - coords2  # è°ƒç”¨ __sub__
opposite = ~coords1       # è°ƒç”¨ __invert__
```

**å¸¸ç”¨ç®—æœ¯è¿ç®—ç¬¦:**
- `__add__` (`+`), `__sub__` (`-`), `__mul__` (`*`), `__truediv__` (`/`)
- `__floordiv__` (`//`), `__mod__` (`%`), `__pow__` (`**`)
- `__and__` (`&`), `__or__` (`|`), `__xor__` (`^`)
- `__lshift__` (`<<`), `__rshift__` (`>>`)
- `__neg__` (`-x`), `__pos__` (`+x`), `__invert__` (`~x`)

#### Java å¯¹æ¯”
Java ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½,éœ€è¦å®šä¹‰æ–¹æ³•:

```java
public class GlobalCoordinates {
    public Pair<Double, Double> subtract(GlobalCoordinates other) {
        double latDiff = this.getLatitude() - other.getLatitude();
        double lonDiff = this.getLongitude() - other.getLongitude();
        return new Pair<>(latDiff, lonDiff);
    }

    public GlobalCoordinates invert() {
        return new GlobalCoordinates(
            degreesFromDecimal(-getLatitude(), true),
            degreesFromDecimal(-getLongitude(), false)
        );
    }
}

// ä½¿ç”¨ - å¿…é¡»è°ƒç”¨æ–¹æ³•
GlobalCoordinates coords1 = ...;
GlobalCoordinates coords2 = ...;

Pair<Double, Double> diff = coords1.subtract(coords2);
GlobalCoordinates opposite = coords1.invert();
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Java ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½** (é™¤äº† String çš„ `+`)
- âœ… Python å¯ä»¥è®©è‡ªå®šä¹‰ç±»æ”¯æŒ `+`, `-`, `*` ç­‰è¿ç®—ç¬¦
- âš ï¸ ä¸è¦æ»¥ç”¨è¿ç®—ç¬¦é‡è½½,åªåœ¨è¯­ä¹‰æ˜ç¡®æ—¶ä½¿ç”¨
- ğŸ“Œ è®°å¿†: "Python è¿ç®—ç¬¦é‡è½½,Java åªèƒ½ç”¨æ–¹æ³•"

**ç›¸å…³æ–‡ä»¶:** `global_coordinates.py:89-101`

### 5.3 å¯è°ƒç”¨å¯¹è±¡: `__call__`

#### Python å®ç°
```python
class GlobalCoordinates:
    def __call__(self, other):
        """è®©å¯¹è±¡åƒå‡½æ•°ä¸€æ ·å¯è°ƒç”¨"""
        # è®¡ç®—ä¸¤ç‚¹é—´çš„è·ç¦» (Haversine å…¬å¼)
        EARTH_RADIUS_KM = 6371
        # ... å¤æ‚çš„æ•°å­¦è®¡ç®—
        return distance

# ä½¿ç”¨: åƒå‡½æ•°ä¸€æ ·è°ƒç”¨å¯¹è±¡
coords1 = GlobalCoordinates(latitude=(37, 46, 32.6, "N"), ...)
coords2 = GlobalCoordinates(latitude=(45, 27, 7.7, "N"), ...)

distance = coords1(coords2)  # è°ƒç”¨ __call__
print(f"Distance: {distance} km")
```

#### Java å¯¹æ¯”
Java å¯ä»¥é€šè¿‡å‡½æ•°å¼æ¥å£å®ç°ç±»ä¼¼æ•ˆæœ:

```java
@FunctionalInterface
interface DistanceCalculator {
    double calculate(GlobalCoordinates other);
}

public class GlobalCoordinates implements DistanceCalculator {
    @Override
    public double calculate(GlobalCoordinates other) {
        // è®¡ç®—è·ç¦»
        final double EARTH_RADIUS_KM = 6371;
        // ... æ•°å­¦è®¡ç®—
        return distance;
    }
}

// ä½¿ç”¨ - éœ€è¦è°ƒç”¨æ–¹æ³•
GlobalCoordinates coords1 = ...;
GlobalCoordinates coords2 = ...;

double distance = coords1.calculate(coords2);
System.out.println("Distance: " + distance + " km");

// æˆ–ä½¿ç”¨ lambda
DistanceCalculator calc = (other) -> {
    // è®¡ç®—é€»è¾‘
    return distance;
};
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… `__call__` è®©å¯¹è±¡å¯ä»¥åƒå‡½æ•°ä¸€æ ·è°ƒç”¨
- âš ï¸ é€‚ç”¨åœºæ™¯: å‡½æ•°å¯¹è±¡ã€ç­–ç•¥æ¨¡å¼ã€å›è°ƒ
- âš ï¸ Java é€šè¿‡å‡½æ•°å¼æ¥å£å®ç°ç±»ä¼¼åŠŸèƒ½
- ğŸ“Œ è®°å¿†: "__call__ = å¯è°ƒç”¨å¯¹è±¡"

**ç›¸å…³æ–‡ä»¶:** `global_coordinates.py:103-120`

---

## 6. å¯¹è±¡æ¨¡å¼åŒ¹é…

### 6.1 åŸºæœ¬å¯¹è±¡åŒ¹é…

#### Python å®ç°
```python
class Pizza:
    def __init__(self, topping, second_topping=None):
        self.first = topping
        self.second = second_topping

order = Pizza("pepperoni", "mushrooms")

match order:
    case Pizza(first='pepperoni', second='mushroom'):
        print("ANSI standard pizza")
    case Pizza(first='pineapple'):
        print("Is this even pizza?")
    case Pizza(first=first, second='cheese'):
        print(f"Very cheesy pizza with {first}.")
    case Pizza(first=first, second=second):
        print(f"Pizza with {first} and {second}.")
```

**è¾“å‡º:** `Pizza with pepperoni and mushrooms.`

#### Java å¯¹æ¯”
Java 17+ çš„æ¨¡å¼åŒ¹é… (Record Pattern):

```java
record Pizza(String first, String second) {}

Pizza order = new Pizza("pepperoni", "mushrooms");

// Java 21+ Record Pattern
String result = switch (order) {
    case Pizza(String first, String second)
        when "pepperoni".equals(first) && "mushroom".equals(second) ->
            "ANSI standard pizza";
    case Pizza(String first, _)
        when "pineapple".equals(first) ->
            "Is this even pizza?";
    case Pizza(String first, String second)
        when "cheese".equals(second) ->
            "Very cheesy pizza with " + first + ".";
    case Pizza(String first, String second) ->
        "Pizza with " + first + " and " + second + ".";
};
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python 3.10+ çš„æ¨¡å¼åŒ¹é…ç±»ä¼¼ Java 21+ çš„ Record Pattern
- âš ï¸ Python å¯ä»¥åŒ¹é…ç±»çš„å±æ€§,Java ä¸»è¦åŒ¹é… record
- âš ï¸ Python ç”¨ `case Class(attr=value)`,Java ç”¨ `case Record(type var)`
- ğŸ“Œ è®°å¿†: "æ¨¡å¼åŒ¹é… = å¼ºå¤§çš„ switch"

**ç›¸å…³æ–‡ä»¶:** `pattern_match_object.py:10-18`

### 6.2 ä½ç½®åŒ¹é…: `__match_args__`

#### Python å®ç°
```python
class Point:
    __match_args__ = ('x_pos', 'y_pos', 'z_pos')  # å®šä¹‰ä½ç½®å‚æ•°æ˜ å°„

    def __init__(self, x, y, z):
        self.x_pos = x
        self.y_pos = y
        self.z_pos = z

point = Point(0, 100, 0)

match point:
    case Point(0, 0, 0):  # ä½ç½®å‚æ•°åŒ¹é…
        print("You are here.")
    case Point(0, _, 0):  # _ è¡¨ç¤ºä»»æ„å€¼
        print("Look up!")
```

**è¾“å‡º:** `Look up!`

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ `__match_args__` å®šä¹‰äº†ä½ç½®å‚æ•°åˆ°å±æ€§çš„æ˜ å°„
- âš ï¸ å¯ä»¥ç”¨ä½ç½®å‚æ•°åŒ¹é…: `case Point(0, 100, 0)`
- âš ï¸ ä¹Ÿå¯ä»¥ç”¨å…³é”®å­—åŒ¹é…: `case Point(x_pos=0, y_pos=100)`
- ğŸ“Œ è®°å¿†: "__match_args__ = ä½ç½®å‚æ•°æ˜ å°„"

**ç›¸å…³æ–‡ä»¶:** `point.py:2-16`

---

## 7. ç±»è£…é¥°å™¨

### 7.1 è£…é¥°ç±»

#### Python å®ç°
```python
import functools

def auto_order(to_go):
    """ç±»è£…é¥°å™¨å·¥å‚"""
    def decorator(cls):
        @functools.wraps(cls)
        def wrapper(*args, **kwargs):
            # åˆ›å»ºåŸç±»çš„å®ä¾‹
            recipe = cls(*args, **kwargs)
            # è‡ªåŠ¨åˆ›å»º CoffeeOrder
            return (CoffeeOrder(recipe, to_go), recipe)
        return wrapper
    return decorator

@auto_order(to_go=True)
class CoffeeShackRecipe(CoffeeRecipe):
    pass

# ä½¿ç”¨: è‡ªåŠ¨åŒ…è£…è¿”å›å€¼
order, recipe = CoffeeShackRecipe(["tall", "decaf", "cappuccino"])
order.brew()  # æ‰“å°: "Brewing tall decaf cappuccino in a paper cup"
```

#### Java å¯¹æ¯”
Java æ²¡æœ‰ç±»è£…é¥°å™¨,ä½†å¯ä»¥ç”¨å·¥å‚æ¨¡å¼æˆ– AOP:

```java
// æ–¹å¼ 1: å·¥å‚æ–¹æ³•
public class CoffeeOrderFactory {
    public static Pair<CoffeeOrder, CoffeeRecipe> createToGo(
        Class<? extends CoffeeRecipe> recipeClass,
        List<String> parts
    ) throws Exception {
        CoffeeRecipe recipe = recipeClass
            .getConstructor(List.class)
            .newInstance(parts);
        CoffeeOrder order = new CoffeeOrder(recipe, true);
        return new Pair<>(order, recipe);
    }
}

// ä½¿ç”¨
Pair<CoffeeOrder, CoffeeRecipe> result = CoffeeOrderFactory.createToGo(
    CoffeeShackRecipe.class,
    Arrays.asList("tall", "decaf", "cappuccino")
);
result.getKey().brew();

// æ–¹å¼ 2: Spring AOP
@Aspect
public class OrderAspect {
    @Around("execution(* CoffeeRecipe.new(..))")
    public Object wrapInOrder(ProceedingJoinPoint pjp) throws Throwable {
        CoffeeRecipe recipe = (CoffeeRecipe) pjp.proceed();
        return new Pair<>(new CoffeeOrder(recipe, true), recipe);
    }
}
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ ç±»è£…é¥°å™¨å¯ä»¥ä¿®æ”¹ç±»çš„æ„é€ è¿‡ç¨‹
- âœ… é€‚ç”¨äºè‡ªåŠ¨æ³¨å†Œã€åŒ…è£…ã€éªŒè¯ç­‰åœºæ™¯
- âš ï¸ Java éœ€è¦å·¥å‚æ¨¡å¼æˆ– AOP å®ç°ç±»ä¼¼åŠŸèƒ½
- ğŸ“Œ è®°å¿†: "ç±»è£…é¥°å™¨ = å…ƒç¼–ç¨‹çš„åˆ©å™¨"

**ç›¸å…³æ–‡ä»¶:** `coffee_order_decorator.py:24-40`

---

## 8. æ€»ç»“å¯¹æ¯”è¡¨

### Python vs Java é¢å‘å¯¹è±¡ç‰¹æ€§

| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| **ç§æœ‰å±æ€§** | `__attr` (name mangling) | `private` (çœŸæ­£ç§æœ‰) |
| **ç±»æ–¹æ³•** | `@classmethod` | âŒ æ—  (ç”¨é™æ€æ–¹æ³•) |
| **é™æ€æ–¹æ³•** | `@staticmethod` | `static` |
| **å±æ€§** | `@property` | Getter/Setter |
| **ææ„å‡½æ•°** | `__del__` (ä¸æ¨è) | `finalize()` (å·²å¼ƒç”¨) |
| **è¿ç®—ç¬¦é‡è½½** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **å¯è°ƒç”¨å¯¹è±¡** | `__call__` | å‡½æ•°å¼æ¥å£ |
| **å¯¹è±¡è¡¨ç¤º** | `__repr__`, `__str__` | `toString()` |
| **ç›¸ç­‰æ¯”è¾ƒ** | `__eq__`, `__hash__` | `equals()`, `hashCode()` |
| **æ¨¡å¼åŒ¹é…** | `match-case` | Record Pattern (21+) |
| **ç±»è£…é¥°å™¨** | `@decorator` | âŒ æ—  (ç”¨ AOP) |

---

## 9. å­¦ä¹ è·¯å¾„å»ºè®®

1. **ç†è§£å‘½åçº¦å®š** - å•ä¸‹åˆ’çº¿ vs åŒä¸‹åˆ’çº¿
2. **æŒæ¡ç±»æ–¹æ³•** - å·¥å‚æ¨¡å¼çš„æœ€ä½³å®è·µ
3. **å­¦ä¹  @property** - ä¼˜é›…çš„å±æ€§è®¿é—®
4. **å®è·µé­”æ³•æ–¹æ³•** - è®©å¯¹è±¡æ›´ Pythonic
5. **è¿ç®—ç¬¦é‡è½½** - åªåœ¨è¯­ä¹‰æ˜ç¡®æ—¶ä½¿ç”¨
6. **æ¨¡å¼åŒ¹é…** - å¼ºå¤§çš„ switch è¯­å¥
7. **ç±»è£…é¥°å™¨** - å…ƒç¼–ç¨‹æŠ€å·§

---

## ğŸ“Š å‚è€ƒæ–‡ä»¶ç´¢å¼•

| ä¸»é¢˜ | æ–‡ä»¶å |
|------|--------|
| Name Mangling | `message.py` |
| ç±»æ–¹æ³•/é™æ€æ–¹æ³• | `secret_agent.py`, `secret_agent_usage.py` |
| ææ„æ–¹æ³• | `secret_agent_disavow.py` |
| @property | `secret_agent_property.py`, `global_coordinates.py` |
| é­”æ³•æ–¹æ³• | `global_coordinates.py`, `global_coordinates_usage.py` |
| å¯¹è±¡åŒ¹é… | `pattern_match_object.py`, `point.py` |
| ç±»è£…é¥°å™¨ | `coffee_order_decorator.py` |

---

**åˆ¶ä½œæ—¶é—´:** 2025-11-25
**åŸºäº:** DeadSimplePython Chapter 07 ç¤ºä¾‹ä»£ç 
**è§„èŒƒå‚è€ƒ:** `Pythonå­¦ä¹ ç¬”è®°è§„èŒƒ_for_Javaer.md`