# Chapter 08 - å¼‚å¸¸å¤„ç† (Exception Handling)

> **æœ¬ç« ä¸»é¢˜**: Python çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å’Œæœ€ä½³å®è·µ
> **é¢å‘**: æœ‰ Java å¼€å‘ç»éªŒçš„å­¦ä¹ è€…

---

## ç›®å½•
1. [å¼‚å¸¸å¤„ç†åŸºç¡€](#1-å¼‚å¸¸å¤„ç†åŸºç¡€)
2. [try-except-else-finally](#2-try-except-else-finally)
3. [å¼‚å¸¸é“¾ (Exception Chaining)](#3-å¼‚å¸¸é“¾-exception-chaining)
4. [è‡ªå®šä¹‰å¼‚å¸¸](#4-è‡ªå®šä¹‰å¼‚å¸¸)
5. [å¸¸è§å¼‚å¸¸ç±»å‹](#5-å¸¸è§å¼‚å¸¸ç±»å‹)
6. [å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ](#6-å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ)
7. [åæ¨¡å¼å’Œé™·é˜±](#7-åæ¨¡å¼å’Œé™·é˜±)

---

## 1. å¼‚å¸¸å¤„ç†åŸºç¡€

### 1.1 åŸºæœ¬ try-except

#### Python å®ç°
```python
def make_guess(target):
    guess = None
    while guess is None:
        try:
            guess = int(input("Guess: "))
        except ValueError:
            print("Enter an integer.")

    return guess == target

# ä½¿ç”¨
make_guess(42)
```

**å·¥ä½œæµç¨‹:**
1. å°è¯•æ‰§è¡Œ `try` å—ä¸­çš„ä»£ç 
2. å¦‚æœå‘ç”Ÿ `ValueError`,æ‰§è¡Œ `except` å—
3. å¦‚æœæ²¡æœ‰å¼‚å¸¸,è·³è¿‡ `except` å—

#### Java å¯¹æ¯”
```java
public boolean makeGuess(int target) {
    Integer guess = null;
    Scanner scanner = new Scanner(System.in);

    while (guess == null) {
        try {
            System.out.print("Guess: ");
            guess = Integer.parseInt(scanner.nextLine());
        } catch (NumberFormatException e) {
            System.out.println("Enter an integer.");
        }
    }

    return guess == target;
}
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| è¯­æ³• | `try...except` | `try...catch` |
| å…³é”®å­— | `except` | `catch` |
| å¼‚å¸¸å¯¹è±¡ | å¯é€‰: `except Exception as e` | å¿…é¡»: `catch (Exception e)` |
| å¤šä¸ªå¼‚å¸¸ | `except (Type1, Type2):` | å¤šä¸ª `catch` å— |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `except` = Java çš„ `catch`
- âœ… Python çš„ `ValueError` â‰ˆ Java çš„ `NumberFormatException`
- âš ï¸ Python å¯ä»¥ä¸ç»‘å®šå¼‚å¸¸å¯¹è±¡: `except ValueError:` (å¦‚æœä¸éœ€è¦å¼‚å¸¸ä¿¡æ¯)
- ğŸ“Œ è®°å¿†: "except = catch,è¯­æ³•æ›´ç®€æ´"

**ç›¸å…³æ–‡ä»¶:** `number_guess.py:10-15`

### 1.2 æ•è·å¤šä¸ªå¼‚å¸¸

#### Python å®ç°
```python
# æ–¹å¼ 1: å…ƒç»„æ•è·å¤šä¸ªå¼‚å¸¸ç±»å‹
try:
    result = average(*values)
except (ValueError, UnicodeError):
    print("ERROR: All inputs should be numeric.")

# æ–¹å¼ 2: å¤šä¸ª except å—
try:
    result = average(*values)
except ZeroDivisionError:
    print("ERROR: No values provided.")
except ValueError:
    print("ERROR: Invalid number format.")
except UnicodeError:
    print("ERROR: Invalid character.")
```

#### Java å¯¹æ¯”
```java
// æ–¹å¼ 1: Java 7+ Multi-catch
try {
    double result = average(values);
} catch (NumberFormatException | IllegalArgumentException e) {
    System.out.println("ERROR: All inputs should be numeric.");
}

// æ–¹å¼ 2: å¤šä¸ª catch å—
try {
    double result = average(values);
} catch (ArithmeticException e) {
    System.out.println("ERROR: No values provided.");
} catch (NumberFormatException e) {
    System.out.println("ERROR: Invalid number format.");
} catch (IllegalArgumentException e) {
    System.out.println("ERROR: Invalid input.");
}
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| å¤šå¼‚å¸¸è¯­æ³• | `except (Type1, Type2):` | `catch (Type1 \| Type2 e)` |
| é¡ºåºè¦æ±‚ | å…·ä½“åˆ°ä¸€èˆ¬ | å…·ä½“åˆ°ä¸€èˆ¬ |
| å¼‚å¸¸å¯¹è±¡ | å¯é€‰ | å¿…é¡»å£°æ˜ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„å…ƒç»„è¯­æ³• â‰ˆ Java 7+ çš„ multi-catch
- âš ï¸ å¤šä¸ª except å—å¿…é¡»ä»å…·ä½“å¼‚å¸¸åˆ°ä¸€èˆ¬å¼‚å¸¸
- âš ï¸ ä¸èƒ½å…ˆæ•è·çˆ¶ç±»å†æ•è·å­ç±» (Python ä¼šæŠ¥é”™)
- ğŸ“Œ è®°å¿†: "å…ƒç»„æ•è· = multi-catch"

**ç›¸å…³æ–‡ä»¶:** `average_calculator.py:20-25`

---

## 2. try-except-else-finally

### 2.1 å®Œæ•´çš„å¼‚å¸¸å¤„ç†ç»“æ„

#### Python å®ç°
```python
def average_file(path):
    file = open(path, 'r')

    try:
        numbers = [float(n) for n in file.readlines()]
    except ValueError as e:
        raise ValueError("File contains non-numeric values.") from e
    else:
        # åªæœ‰ try å—æˆåŠŸæ—¶æ‰æ‰§è¡Œ
        try:
            return sum(numbers) / len(numbers)
        except ZeroDivisionError as e:
            raise ValueError("Empty file.") from e
    finally:
        # æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œ
        print("Closing file.")
        file.close()
```

**æ‰§è¡Œé¡ºåº:**
1. `try`: å°è¯•æ‰§è¡Œ
2. `except`: å¦‚æœæœ‰å¼‚å¸¸,æ‰§è¡Œå¯¹åº”çš„ except
3. `else`: å¦‚æœæ²¡æœ‰å¼‚å¸¸,æ‰§è¡Œ else (å¯é€‰)
4. `finally`: æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œ (å¯é€‰)

#### Java å¯¹æ¯”
```java
public double averageFile(String path) throws IOException {
    BufferedReader file = new BufferedReader(new FileReader(path));

    try {
        List<Double> numbers = new ArrayList<>();
        String line;
        while ((line = file.readLine()) != null) {
            try {
                numbers.add(Double.parseDouble(line));
            } catch (NumberFormatException e) {
                throw new IllegalArgumentException(
                    "File contains non-numeric values.", e);
            }
        }

        // Java æ²¡æœ‰ else,é€»è¾‘æ”¾åœ¨ try åé¢
        if (numbers.isEmpty()) {
            throw new IllegalArgumentException("Empty file.");
        }
        return numbers.stream().mapToDouble(Double::doubleValue).average().getAsDouble();

    } finally {
        // æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œ
        System.out.println("Closing file.");
        file.close();
    }
}
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| `else` å— | âœ… æœ‰ | âŒ æ—  |
| `finally` å— | âœ… æœ‰ | âœ… æœ‰ |
| `else` ç”¨é€” | try æˆåŠŸæ—¶æ‰§è¡Œ | æ— å¯¹åº” (é€»è¾‘æ”¾ try å) |
| `finally` ç”¨é€” | æ¸…ç†èµ„æº | æ¸…ç†èµ„æº |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Python çš„ `else` å—æ˜¯ Java æ²¡æœ‰çš„ç‰¹æ€§**
  - åªæœ‰ try å—æˆåŠŸ(æ²¡æœ‰å¼‚å¸¸)æ—¶æ‰æ‰§è¡Œ
  - ç”¨äºåˆ†ç¦»"æˆåŠŸåçš„é€»è¾‘"å’Œ"å¯èƒ½å¼‚å¸¸çš„é€»è¾‘"
- âœ… `finally` å—ä¸¤è€…éƒ½æœ‰,ç”¨é€”ç›¸åŒ
- âš ï¸ Python æ¨èç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (`with`) ä»£æ›¿ finally æ¸…ç†èµ„æº
- ğŸ“Œ è®°å¿†: "else = æˆåŠŸæ‰æ‰§è¡Œ,finally = æ€»æ˜¯æ‰§è¡Œ"

**ç›¸å…³æ–‡ä»¶:** `average_file.py:4-18`

---

## 3. å¼‚å¸¸é“¾ (Exception Chaining)

### 3.1 ä½¿ç”¨ `from` é“¾æ¥å¼‚å¸¸

#### Python å®ç°
```python
def lookup_landmark(landmark):
    landmark = landmark.upper()
    try:
        city = landmarks[landmark]
        state = cities[city]
    except KeyError as e:
        # æŠ›å‡ºæ–°å¼‚å¸¸,ä½†ä¿ç•™åŸå§‹å¼‚å¸¸
        raise KeyError("Landmark not found.") from e

    print(f"{landmark} is in {city}, {state}")

# ä½¿ç”¨
try:
    lookup_landmark("alamo")
except KeyError as e:
    print(e)
    print(f"Original cause: {e.__cause__}")
```

**è¾“å‡º:**
```
Traceback (most recent call last):
  File "...", line 21, in lookup_landmark
    state = cities[city]
KeyError: 'SAN ANTONIO'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "...", line 28, in <module>
    lookup_landmark("alamo")
  File "...", line 23, in lookup_landmark
    raise KeyError("Landmark not found.") from e
KeyError: 'Landmark not found.'
```

#### Java å¯¹æ¯”
```java
public void lookupLandmark(String landmark) {
    landmark = landmark.toUpperCase();
    try {
        String city = landmarks.get(landmark);
        if (city == null) {
            throw new NoSuchElementException("Landmark not in map");
        }
        String state = cities.get(city);
        if (state == null) {
            throw new NoSuchElementException("City not in map");
        }
        System.out.println(landmark + " is in " + city + ", " + state);
    } catch (NoSuchElementException e) {
        // é“¾æ¥å¼‚å¸¸ - ä¼ é€’åŸå§‹å¼‚å¸¸ä½œä¸º cause
        throw new IllegalArgumentException("Landmark not found.", e);
    }
}

// ä½¿ç”¨
try {
    lookupLandmark("alamo");
} catch (IllegalArgumentException e) {
    System.out.println(e.getMessage());
    System.out.println("Original cause: " + e.getCause());
    e.printStackTrace();  // æ˜¾ç¤ºå®Œæ•´å †æ ˆè·Ÿè¸ª
}
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| å¼‚å¸¸é“¾è¯­æ³• | `raise NewError() from e` | `throw new Exception(msg, cause)` |
| åŸå§‹å¼‚å¸¸ | `e.__cause__` | `e.getCause()` |
| è‡ªåŠ¨é“¾æ¥ | âœ… åœ¨ except ä¸­ raise è‡ªåŠ¨é“¾æ¥ | âŒ éœ€è¦æ˜¾å¼ä¼ é€’ |
| å †æ ˆè·Ÿè¸ª | è‡ªåŠ¨æ˜¾ç¤ºé“¾ | éœ€è¦ `printStackTrace()` |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `raise ... from e` â‰ˆ Java çš„æ„é€ å‡½æ•°ä¼ é€’ cause
- âš ï¸ Python ä¼šåœ¨å †æ ˆè·Ÿè¸ªä¸­è‡ªåŠ¨æ˜¾ç¤ºå¼‚å¸¸é“¾
- âš ï¸ åœ¨ except å—ä¸­ç›´æ¥ `raise` ä¼šéšå¼é“¾æ¥å¼‚å¸¸
- ğŸ“Œ è®°å¿†: "from æ˜¾å¼é“¾æ¥,ç›´æ¥ raise éšå¼é“¾æ¥"

**ç›¸å…³æ–‡ä»¶:** `landmarks.py:17-24`, `average_file.py:10-15`

### 3.2 æŠ‘åˆ¶å¼‚å¸¸é“¾: `from None`

#### Python å®ç°
```python
try:
    # æŸäº›æ“ä½œ
    result = some_operation()
except ValueError as e:
    # æŠ›å‡ºæ–°å¼‚å¸¸,ä½†ä¸æ˜¾ç¤ºåŸå§‹å¼‚å¸¸
    raise RuntimeError("Operation failed.") from None
```

**æ•ˆæœ:** åªæ˜¾ç¤ºæ–°å¼‚å¸¸,ä¸æ˜¾ç¤ºåŸå§‹å¼‚å¸¸çš„å †æ ˆè·Ÿè¸ª

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ `from None` ç”¨äºéšè—åŸå§‹å¼‚å¸¸
- âš ï¸ é€šå¸¸ä¸æ¨èä½¿ç”¨,å› ä¸ºä¸¢å¤±äº†è°ƒè¯•ä¿¡æ¯
- ğŸ“Œ è®°å¿†: "from e é“¾æ¥,from None éšè—"

---

## 4. è‡ªå®šä¹‰å¼‚å¸¸

### 4.1 åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»

#### Python å®ç°
```python
class SillyWalkException(RuntimeError):
    def __init__(self, message="Someone walked silly."):
        super().__init__(message)

def walking():
    raise SillyWalkException("My walk has gotten rather silly.")

# ä½¿ç”¨
try:
    walking()
except SillyWalkException as e:
    print(e)  # è¾“å‡º: My walk has gotten rather silly.
```

**æœ€ä½³å®è·µ:**
```python
# æ¨è: ç»§æ‰¿è‡ªé€‚å½“çš„å†…ç½®å¼‚å¸¸
class ValidationError(ValueError):
    pass

class DatabaseError(RuntimeError):
    pass

class NotFoundError(LookupError):
    pass
```

#### Java å¯¹æ¯”
```java
// è‡ªå®šä¹‰æ£€æŸ¥å¼‚å¸¸ (checked exception)
public class SillyWalkException extends Exception {
    public SillyWalkException() {
        super("Someone walked silly.");
    }

    public SillyWalkException(String message) {
        super(message);
    }

    public SillyWalkException(String message, Throwable cause) {
        super(message, cause);
    }
}

// è‡ªå®šä¹‰éæ£€æŸ¥å¼‚å¸¸ (unchecked exception)
public class SillyWalkException extends RuntimeException {
    public SillyWalkException(String message) {
        super(message);
    }
}

// ä½¿ç”¨
public void walking() throws SillyWalkException {
    throw new SillyWalkException("My walk has gotten rather silly.");
}

try {
    walking();
} catch (SillyWalkException e) {
    System.out.println(e.getMessage());
}
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| å¼‚å¸¸ç±»å‹ | éƒ½æ˜¯éæ£€æŸ¥å¼‚å¸¸ | Checked / Unchecked |
| åŸºç±» | `Exception` æˆ–å­ç±» | `Exception` / `RuntimeException` |
| `throws` å£°æ˜ | âŒ ä¸éœ€è¦ | âœ… checked éœ€è¦ |
| å¼ºåˆ¶æ•è· | âŒ ä¸å¼ºåˆ¶ | âœ… checked å¼ºåˆ¶ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Python æ²¡æœ‰ checked exception çš„æ¦‚å¿µ**
  - æ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯éæ£€æŸ¥çš„
  - ä¸éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜
- âœ… æ¨èç»§æ‰¿è‡ªé€‚å½“çš„å†…ç½®å¼‚å¸¸ç±»:
  - `ValueError`: å€¼é”™è¯¯
  - `TypeError`: ç±»å‹é”™è¯¯
  - `RuntimeError`: è¿è¡Œæ—¶é”™è¯¯
  - `LookupError`: æŸ¥æ‰¾é”™è¯¯ (KeyError, IndexError çš„çˆ¶ç±»)
- ğŸ“Œ è®°å¿†: "Python æ‰€æœ‰å¼‚å¸¸éƒ½åƒ Java çš„ RuntimeException"

**ç›¸å…³æ–‡ä»¶:** `silly_walk_exception.py:1-13`

---

## 5. å¸¸è§å¼‚å¸¸ç±»å‹

### 5.1 Python å¸¸è§å¼‚å¸¸

#### å¼‚å¸¸å±‚æ¬¡ç»“æ„
```
BaseException
â”œâ”€â”€ SystemExit
â”œâ”€â”€ KeyboardInterrupt
â”œâ”€â”€ GeneratorExit
â””â”€â”€ Exception
    â”œâ”€â”€ StopIteration
    â”œâ”€â”€ ArithmeticError
    â”‚   â”œâ”€â”€ ZeroDivisionError
    â”‚   â”œâ”€â”€ OverflowError
    â”‚   â””â”€â”€ FloatingPointError
    â”œâ”€â”€ LookupError
    â”‚   â”œâ”€â”€ IndexError
    â”‚   â””â”€â”€ KeyError
    â”œâ”€â”€ ValueError
    â”œâ”€â”€ TypeError
    â”œâ”€â”€ OSError
    â”‚   â”œâ”€â”€ FileNotFoundError
    â”‚   â”œâ”€â”€ PermissionError
    â”‚   â””â”€â”€ IOError (åˆ«å)
    â””â”€â”€ RuntimeError
```

#### Python vs Java å¸¸è§å¼‚å¸¸å¯¹ç…§

| Python | Java | ç”¨é€” |
|--------|------|------|
| `ValueError` | `IllegalArgumentException` | å‚æ•°å€¼ä¸åˆæ³• |
| `TypeError` | `ClassCastException` | ç±»å‹ä¸åŒ¹é… |
| `KeyError` | `NoSuchElementException` | é”®ä¸å­˜åœ¨ |
| `IndexError` | `ArrayIndexOutOfBoundsException` | ç´¢å¼•è¶Šç•Œ |
| `ZeroDivisionError` | `ArithmeticException` | é™¤ä»¥é›¶ |
| `FileNotFoundError` | `FileNotFoundException` | æ–‡ä»¶ä¸å­˜åœ¨ |
| `PermissionError` | `AccessDeniedException` | æƒé™ä¸è¶³ |
| `KeyboardInterrupt` | âŒ æ— å¯¹åº” | Ctrl+C |
| `EOFError` | `EOFException` | æ–‡ä»¶ç»“æŸ |
| `NotImplementedError` | `UnsupportedOperationException` | æœªå®ç° |

#### ç¤ºä¾‹
```python
# ValueError: å€¼ä¸åˆæ³•
int("abc")  # ValueError: invalid literal for int()

# TypeError: ç±»å‹ä¸åŒ¹é…
"hello" + 5  # TypeError: can only concatenate str to str

# KeyError: é”®ä¸å­˜åœ¨
d = {"a": 1}
d["b"]  # KeyError: 'b'

# IndexError: ç´¢å¼•è¶Šç•Œ
lst = [1, 2, 3]
lst[5]  # IndexError: list index out of range

# ZeroDivisionError: é™¤ä»¥é›¶
10 / 0  # ZeroDivisionError: division by zero
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… å¤§éƒ¨åˆ† Python å¼‚å¸¸åœ¨ Java ä¸­éƒ½æœ‰å¯¹åº”
- âš ï¸ `KeyboardInterrupt` æ˜¯ Python ç‰¹æœ‰çš„,ç”¨äºæ•è· Ctrl+C
- âš ï¸ Python çš„å¼‚å¸¸å‘½åæ›´ç›´è§‚ (ZeroDivisionError vs ArithmeticException)
- ğŸ“Œ è®°å¿†: "Python å¼‚å¸¸åæ›´å…·æè¿°æ€§"

---

## 6. å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ

### 6.1 EAFP vs LBYL

#### EAFP (Easier to Ask for Forgiveness than Permission) - Python é£æ ¼
```python
# âœ… Pythonic: å…ˆåš,æœ‰é—®é¢˜å†å¤„ç†
def lookup_email(name):
    try:
        return friend_emails[name]
    except KeyError:
        return None

# âœ… Pythonic: æ–‡ä»¶æ“ä½œ
try:
    with open('file.txt') as f:
        data = f.read()
except FileNotFoundError:
    data = None
```

#### LBYL (Look Before You Leap) - Java é£æ ¼
```python
# âŒ ä¸å¤Ÿ Pythonic: å…ˆæ£€æŸ¥,å†åš
def lookup_email(name):
    if name in friend_emails:
        return friend_emails[name]
    else:
        return None

# âŒ ä¸å¤Ÿ Pythonic: æ–‡ä»¶æ“ä½œ
import os
if os.path.exists('file.txt'):
    with open('file.txt') as f:
        data = f.read()
else:
    data = None
```

#### Java å¯¹æ¯”
```java
// Java é€šå¸¸ä½¿ç”¨ LBYL é£æ ¼
public String lookupEmail(String name) {
    // å…ˆæ£€æŸ¥
    if (friendEmails.containsKey(name)) {
        return friendEmails.get(name);
    } else {
        return null;
    }
}

// æ–‡ä»¶æ“ä½œ
File file = new File("file.txt");
if (file.exists()) {
    // è¯»å–æ–‡ä»¶
} else {
    // å¤„ç†ä¸å­˜åœ¨çš„æƒ…å†µ
}
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Python æ¨å´‡ EAFP,Java æ›´å¸¸ç”¨ LBYL**
- âœ… EAFP çš„ä¼˜åŠ¿:
  - é¿å…ç«æ€æ¡ä»¶ (æ£€æŸ¥å’Œæ“ä½œä¹‹é—´æ–‡ä»¶å¯èƒ½è¢«åˆ é™¤)
  - ä»£ç æ›´ç®€æ´
  - å¤„ç†å¤šç§é”™è¯¯æƒ…å†µæ›´æ–¹ä¾¿
- âš ï¸ LBYL çš„é—®é¢˜:
  - å¯èƒ½æœ‰ç«æ€æ¡ä»¶
  - ä»£ç æ›´å†—é•¿
  - éœ€è¦æ£€æŸ¥å¤šç§æƒ…å†µ
- ğŸ“Œ è®°å¿†: "Python ç”¨ try,ä¸è¦ç”¨ if é¢„æ£€æŸ¥"

**ç›¸å…³æ–‡ä»¶:** `address_book.py:13-17`

### 6.2 å…·ä½“æ•è·,é¿å…é€šç”¨å¼‚å¸¸

#### âœ… å¥½çš„åšæ³•
```python
def calculator(a, b, op):
    try:
        a = float(a)
        b = float(b)
        # ... æ“ä½œ
    except ValueError as e:
        print("<!> Expected format: <A> <B> <OP>")
        logging.info(e)
    except TypeError as e:
        print("<!> Wrong number of arguments.")
        logging.info(e)
    except ZeroDivisionError as e:
        print("<!> Cannot divide by zero.")
        logging.info(e)
    except NotImplementedError as e:
        print("<!> Invalid operator.")
        logging.info(e)
```

#### âŒ ä¸å¥½çš„åšæ³•
```python
# åæ¨¡å¼: æ•è·æ‰€æœ‰å¼‚å¸¸
try:
    some_function()
except:  # âŒ è£¸ except,æ•è·æ‰€æœ‰å¼‚å¸¸
    print("An error occurred. Moving on!")

# ç¨å¥½,ä½†ä»ç„¶å¤ªå®½æ³›
try:
    some_function()
except Exception:  # âš ï¸ æ•è·å‡ ä¹æ‰€æœ‰å¼‚å¸¸
    print("An error occurred.")
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **æ°¸è¿œä¸è¦ä½¿ç”¨è£¸ `except:`**
  - ä¼šæ•è· `SystemExit`, `KeyboardInterrupt` ç­‰ç³»ç»Ÿå¼‚å¸¸
  - å¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸é€€å‡º
- âš ï¸ é¿å…æ•è· `Exception`,é™¤é:
  - è®°å½•æ—¥å¿—åé‡æ–°æŠ›å‡º
  - ç¡®å®éœ€è¦æ•è·æ‰€æœ‰åº”ç”¨å¼‚å¸¸
- âœ… æ€»æ˜¯æ•è·å…·ä½“çš„å¼‚å¸¸ç±»å‹
- ğŸ“Œ è®°å¿†: "å…·ä½“å¼‚å¸¸,æ˜ç¡®å¤„ç†"

**ç›¸å…³æ–‡ä»¶:** `calculator.py:33-50`, `diaper_antipattern.py` (åä¾‹)

### 6.3 ä¸è¦é˜»æ­¢é€€å‡ºä¿¡å·

#### âŒ é”™è¯¯ç¤ºä¾‹
```python
while True:
    try:
        greet()
        break
    except Exception:  # âŒ æ•è·äº† KeyboardInterrupt!
        print("Error caught")
```

**é—®é¢˜:** Ctrl+C æ— æ³•é€€å‡ºç¨‹åº,å› ä¸º `KeyboardInterrupt` ç»§æ‰¿è‡ª `BaseException`,ä½† `Exception` æ•è·ä¸åˆ°å®ƒã€‚ä½†æ˜¯,å¦‚æœæœ‰å…¶ä»–å¼‚å¸¸å¯¼è‡´æ— é™å¾ªç¯,è¿™ä¸ªä»£ç ä»ç„¶æœ‰é—®é¢˜ã€‚

#### âœ… æ­£ç¡®åšæ³•
```python
while True:
    try:
        greet()
        break
    except (KeyboardInterrupt, EOFError):
        print("\nGoodbye.")
        sys.exit(0)
    except Exception as e:
        print(f"Error caught: {e}")
```

æˆ–è€…è®©é€€å‡ºä¿¡å·è‡ªç„¶ä¼ æ’­:
```python
while True:
    try:
        greet()
        break
    except ValueError as e:  # åªæ•è·å…·ä½“çš„å¼‚å¸¸
        print(f"Invalid input: {e}")
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ `KeyboardInterrupt` å’Œ `SystemExit` ç»§æ‰¿è‡ª `BaseException`,ä¸æ˜¯ `Exception`
- âœ… è¦ä¹ˆæ˜ç¡®æ•è·å¹¶å¤„ç† Ctrl+C
- âœ… è¦ä¹ˆè®©å®ƒè‡ªç„¶ä¼ æ’­,ä¸è¦é˜»æ­¢
- ğŸ“Œ è®°å¿†: "åˆ«æ•è·é€€å‡ºä¿¡å·,é™¤éæ˜ç¡®å¤„ç†"

**ç›¸å…³æ–‡ä»¶:** `no_escape.py` (é”™è¯¯ç¤ºä¾‹), `calculator.py:45-47` (æ­£ç¡®ç¤ºä¾‹)

---

## 7. åæ¨¡å¼å’Œé™·é˜±

### 7.1 "å°¿å¸ƒåæ¨¡å¼" (Diaper Anti-Pattern)

#### âŒ åæ¨¡å¼ç¤ºä¾‹
```python
try:
    some_scary_function()
except:
    print("An error occurred. Moving on!")
```

**é—®é¢˜:**
- éšè—äº†çœŸæ­£çš„é”™è¯¯
- è®© bug éš¾ä»¥å‘ç°
- é˜»æ­¢äº†ç¨‹åºæ­£å¸¸é€€å‡º
- æ²¡æœ‰æ—¥å¿—è®°å½•

#### âœ… æ­£ç¡®åšæ³•
```python
import logging

try:
    some_function()
except SpecificError as e:
    logging.error(f"Specific error occurred: {e}")
    # æ ¹æ®æƒ…å†µå†³å®šæ˜¯å¦é‡æ–°æŠ›å‡º
    raise
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ åå­—æ¥æº: åƒå°¿å¸ƒä¸€æ ·"å…œä½ä¸€åˆ‡"
- âš ï¸ Java ä¸­ä¹Ÿå¸¸è§ç±»ä¼¼é—®é¢˜: `catch (Exception e) {}`
- âœ… åªæ•è·ä½ çŸ¥é“å¦‚ä½•å¤„ç†çš„å¼‚å¸¸
- ğŸ“Œ è®°å¿†: "ä¸è¦å½“å°¿å¸ƒ,æ•è·å…·ä½“å¼‚å¸¸"

**ç›¸å…³æ–‡ä»¶:** `diaper_antipattern.py` (åæ¨¡å¼ç¤ºä¾‹)

### 7.2 æ—¥å¿—è®°å½•æœ€ä½³å®è·µ

#### âœ… æ­£ç¡®çš„æ—¥å¿—è®°å½•
```python
import logging

logging.basicConfig(filename='log.txt', level=logging.INFO)

try:
    result = calculator(*equation)
except ValueError as e:
    print("<!> Expected format: <A> <B> <OP>")
    logging.info(e)  # è®°å½•å…·ä½“ä¿¡æ¯
except Exception as e:
    logging.exception(e)  # è®°å½•å®Œæ•´å †æ ˆè·Ÿè¸ª
    raise  # é‡æ–°æŠ›å‡º
```

#### Java å¯¹æ¯”
```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

private static final Logger logger = LoggerFactory.getLogger(Calculator.class);

try {
    double result = calculator(equation);
} catch (NumberFormatException e) {
    System.out.println("<!> Expected format: <A> <B> <OP>");
    logger.info("Invalid number format: {}", e.getMessage());
} catch (Exception e) {
    logger.error("Unexpected error", e);  // è®°å½•å®Œæ•´å †æ ˆ
    throw e;  // é‡æ–°æŠ›å‡º
}
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python çš„ `logging.exception()` è‡ªåŠ¨è®°å½•å †æ ˆè·Ÿè¸ª
- âœ… `logging.info()` åªè®°å½•æ¶ˆæ¯
- âš ï¸ ç±»ä¼¼ Java çš„ `logger.info()` vs `logger.error(msg, exception)`
- ğŸ“Œ è®°å¿†: "exception() è®°å½•å †æ ˆ,info() è®°å½•æ¶ˆæ¯"

**ç›¸å…³æ–‡ä»¶:** `calculator.py:1-50`

---

## 8. æ€»ç»“å¯¹æ¯”è¡¨

### Python vs Java å¼‚å¸¸å¤„ç†

| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| **æ•è·å¼‚å¸¸** | `try...except` | `try...catch` |
| **å¤šå¼‚å¸¸** | `except (E1, E2):` | `catch (E1 \| E2 e)` |
| **else å—** | âœ… æˆåŠŸæ—¶æ‰§è¡Œ | âŒ æ—  |
| **finally å—** | âœ… æ€»æ˜¯æ‰§è¡Œ | âœ… æ€»æ˜¯æ‰§è¡Œ |
| **å¼‚å¸¸é“¾** | `raise E() from e` | æ„é€ å‡½æ•°ä¼  cause |
| **æ£€æŸ¥å¼‚å¸¸** | âŒ æ—  | âœ… Checked Exception |
| **throws å£°æ˜** | âŒ ä¸éœ€è¦ | âœ… checked éœ€è¦ |
| **å¼‚å¸¸å¯¹è±¡** | å¯é€‰ç»‘å®š | å¿…é¡»å£°æ˜ |
| **é£æ ¼** | EAFP (å…ˆåšåæ•è·) | LBYL (å…ˆæ£€æŸ¥ååš) |
| **è£¸ catch** | `except:` (ä¸æ¨è) | `catch (Throwable e)` |

---

## 9. å­¦ä¹ è·¯å¾„å»ºè®®

1. **ç†è§£ try-except** - åŸºæœ¬å¼‚å¸¸æ•è·
2. **æŒæ¡ else å’Œ finally** - å®Œæ•´çš„å¼‚å¸¸å¤„ç†æµç¨‹
3. **å­¦ä¹ å¼‚å¸¸é“¾** - ä¿ç•™é”™è¯¯ä¸Šä¸‹æ–‡
4. **åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸** - è®¾è®¡æ¸…æ™°çš„é”™è¯¯å±‚æ¬¡
5. **éµå¾ª EAFP** - Python é£æ ¼çš„å¼‚å¸¸å¤„ç†
6. **é¿å…åæ¨¡å¼** - å…·ä½“æ•è·,æ­£ç¡®æ—¥å¿—
7. **å®è·µæœ€ä½³å®è·µ** - ç¼–å†™å¥å£®çš„å¼‚å¸¸å¤„ç†ä»£ç 

---

## ğŸ“Š å‚è€ƒæ–‡ä»¶ç´¢å¼•

| ä¸»é¢˜ | æ–‡ä»¶å |
|------|--------|
| åŸºæœ¬ try-except | `number_guess.py`, `average.py` |
| å¤šå¼‚å¸¸æ•è· | `average_calculator.py` |
| else-finally | `average_file.py`, `average_string.py` |
| å¼‚å¸¸é“¾ | `landmarks.py` |
| è‡ªå®šä¹‰å¼‚å¸¸ | `silly_walk_exception.py` |
| EAFP æ¨¡å¼ | `address_book.py` |
| å®Œæ•´ç¤ºä¾‹ | `calculator.py` |
| åæ¨¡å¼ | `diaper_antipattern.py`, `no_escape.py` |

---

**åˆ¶ä½œæ—¶é—´:** 2025-11-25
**åŸºäº:** DeadSimplePython Chapter 08 ç¤ºä¾‹ä»£ç 
**è§„èŒƒå‚è€ƒ:** `Pythonå­¦ä¹ ç¬”è®°è§„èŒƒ_for_Javaer.md`