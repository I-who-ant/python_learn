# Chapter 10 - ç”Ÿæˆå™¨ã€æ¨å¯¼å¼ä¸åç¨‹ (Generators, Comprehensions, and Coroutines)

> **æœ¬ç« ä¸»é¢˜**: Python çš„æƒ°æ€§æ±‚å€¼ã€ç”Ÿæˆå™¨å’Œåç¨‹
> **é¢å‘**: æœ‰ Java å¼€å‘ç»éªŒçš„å­¦ä¹ è€…

---

## ç›®å½•
1. [ç”Ÿæˆå™¨ (Generators)](#1-ç”Ÿæˆå™¨-generators)
2. [æ¨å¯¼å¼ (Comprehensions)](#2-æ¨å¯¼å¼-comprehensions)
3. [åç¨‹ (Coroutines)](#3-åç¨‹-coroutines)
4. [ç”Ÿæˆå™¨é«˜çº§ç‰¹æ€§](#4-ç”Ÿæˆå™¨é«˜çº§ç‰¹æ€§)

---

## 1. ç”Ÿæˆå™¨ (Generators)

### 1.1 ç”Ÿæˆå™¨å‡½æ•°åŸºç¡€

#### Python å®ç°
```python
# ç”Ÿæˆå™¨å‡½æ•° - ä½¿ç”¨ yield å…³é”®å­—
def traffic():
    colors = ['red', 'green', 'blue']
    vehicles = ['car', 'truck', 'motorcycle']

    while True:
        vehicle = choice(vehicles)
        if vehicle is None:
            return  # ç»“æŸç”Ÿæˆå™¨

        color = choice(colors)
        yield f"{color} {vehicle}"  # äº§å‡ºå€¼å¹¶æš‚åœ

# ä½¿ç”¨ç”Ÿæˆå™¨
queue = traffic()
for count, vehicle in enumerate(queue, start=1):
    print(f"Wait for {vehicle}...")
    if count >= 10:
        break
```

**å…³é”®æ¦‚å¿µ:**
- `yield` å…³é”®å­—äº§å‡ºä¸€ä¸ªå€¼,ç„¶åæš‚åœå‡½æ•°æ‰§è¡Œ
- ä¸‹æ¬¡è°ƒç”¨ `next()` æ—¶,ä»æš‚åœå¤„ç»§ç»­æ‰§è¡Œ
- ç”Ÿæˆå™¨æ˜¯æƒ°æ€§æ±‚å€¼çš„,åªåœ¨éœ€è¦æ—¶è®¡ç®—ä¸‹ä¸€ä¸ªå€¼
- ç”Ÿæˆå™¨èŠ‚çœå†…å­˜,ä¸éœ€è¦ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰å€¼

#### Java å¯¹æ¯”
Java æ²¡æœ‰å†…ç½®çš„ç”Ÿæˆå™¨è¯­æ³•,éœ€è¦ä½¿ç”¨è¿­ä»£å™¨æˆ– Stream:

```java
// Java - ä½¿ç”¨è¿­ä»£å™¨ç±»
import java.util.*;

class TrafficIterator implements Iterator<String> {
    private String[] colors = {"red", "green", "blue"};
    private String[] vehicles = {"car", "truck", "motorcycle"};
    private Random random = new Random();

    @Override
    public boolean hasNext() {
        return true;  // æ— é™è¿­ä»£å™¨
    }

    @Override
    public String next() {
        String vehicle = vehicles[random.nextInt(vehicles.length)];
        String color = colors[random.nextInt(colors.length)];
        return color + " " + vehicle;
    }
}

// ä½¿ç”¨
Iterator<String> queue = new TrafficIterator();
int count = 0;
while (queue.hasNext() && count < 10) {
    System.out.println("Wait for " + queue.next() + "...");
    count++;
}

// Java 8+ Stream (æ— é™æµ)
Stream.generate(() -> {
    String[] colors = {"red", "green", "blue"};
    String[] vehicles = {"car", "truck", "motorcycle"};
    Random random = new Random();
    String vehicle = vehicles[random.nextInt(vehicles.length)];
    String color = colors[random.nextInt(colors.length)];
    return color + " " + vehicle;
})
.limit(10)
.forEach(v -> System.out.println("Wait for " + v + "..."));
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python Generator | Java Iterator/Stream |
|------|------------------|---------------------|
| è¯­æ³• | `yield` å…³é”®å­— | å®ç° Iterator æ¥å£ |
| çŠ¶æ€ä¿å­˜ | âœ… è‡ªåŠ¨ä¿å­˜å±€éƒ¨å˜é‡ | âš ï¸ éœ€è¦å®ä¾‹å˜é‡ |
| æƒ°æ€§æ±‚å€¼ | âœ… å¤©ç„¶æ”¯æŒ | âœ… Stream æ”¯æŒ |
| ç®€æ´æ€§ | æç®€ (å‡½æ•°å†… yield) | å†—é•¿ (éœ€è¦ç±») |
| æ— é™åºåˆ— | âœ… `while True: yield` | âœ… `Stream.generate()` |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Python çš„ `yield` è®©å‡½æ•°å˜æˆç”Ÿæˆå™¨**,ä¸æ˜¯æ™®é€šå‡½æ•°
- âœ… ç”Ÿæˆå™¨ â‰ˆ Java çš„ Iterator + è‡ªåŠ¨çŠ¶æ€ç®¡ç†
- âš ï¸ è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œ,è€Œæ˜¯è¿”å›ç”Ÿæˆå™¨å¯¹è±¡
- âš ï¸ ä½¿ç”¨ `next(generator)` æˆ– `for` å¾ªç¯æ¥è·å–å€¼
- ğŸ“Œ è®°å¿†: "yield = äº§å‡º + æš‚åœ,ä¸‹æ¬¡ä»æš‚åœå¤„ç»§ç»­"

**ç›¸å…³æ–‡ä»¶:** `traffic_generator_class.py:25-33`

### 1.2 yield from - å§”æ‰˜ç”Ÿæˆå™¨

#### Python å®ç°
```python
from random import choice, randint

def biker_gang():
    """ç”Ÿæˆä¸€ç»„æ‘©æ‰˜è½¦"""
    for _ in range(randint(2, 10)):
        color = choice(['red', 'blue', 'black'])
        yield f"{color} motorcycle"

def traffic():
    """ä¸»ç”Ÿæˆå™¨,æœ‰æ—¶å§”æ‰˜ç»™ biker_gang"""
    while True:
        if randint(1, 50) == 50:  # 2% æ¦‚ç‡å‡ºç°æ‘©æ‰˜è½¦é˜Ÿ
            yield from biker_gang()  # å§”æ‰˜ç»™å­ç”Ÿæˆå™¨
            continue

        vehicle = choice(['car', 'truck', 'semi'])
        color = choice(['red', 'green', 'blue'])
        yield f"{color} {vehicle}"

# ä½¿ç”¨
for count, vehicle in enumerate(traffic()):
    print(vehicle)
    if count == 100:
        break
```

**`yield from` çš„ä½œç”¨:**
- å°†ç”Ÿæˆå§”æ‰˜ç»™å¦ä¸€ä¸ªç”Ÿæˆå™¨
- è‡ªåŠ¨è¿­ä»£å­ç”Ÿæˆå™¨,äº§å‡ºæ‰€æœ‰å€¼
- ç­‰ä»·äº `for item in sub_generator: yield item`

#### Java å¯¹æ¯”
```java
// Java - éœ€è¦æ‰‹åŠ¨è¿­ä»£å­è¿­ä»£å™¨
class BikerGang implements Iterable<String> {
    @Override
    public Iterator<String> iterator() {
        return new Iterator<String>() {
            private int count = new Random().nextInt(9) + 2;
            private int current = 0;

            @Override
            public boolean hasNext() {
                return current < count;
            }

            @Override
            public String next() {
                current++;
                String[] colors = {"red", "blue", "black"};
                return colors[new Random().nextInt(colors.length)] + " motorcycle";
            }
        };
    }
}

class Traffic implements Iterator<String> {
    private Iterator<String> bikerIterator = null;

    @Override
    public String next() {
        // å¦‚æœåœ¨å¤„ç†æ‘©æ‰˜è½¦é˜Ÿ,ç»§ç»­ä»å­è¿­ä»£å™¨è·å–
        if (bikerIterator != null && bikerIterator.hasNext()) {
            return bikerIterator.next();
        }
        bikerIterator = null;  // é‡ç½®

        // 2% æ¦‚ç‡ç”Ÿæˆæ‘©æ‰˜è½¦é˜Ÿ
        if (new Random().nextInt(50) == 0) {
            bikerIterator = new BikerGang().iterator();
            return bikerIterator.next();
        }

        // æ­£å¸¸ç”Ÿæˆè½¦è¾†
        String[] vehicles = {"car", "truck", "semi"};
        String[] colors = {"red", "green", "blue"};
        return colors[new Random().nextInt(3)] + " " +
               vehicles[new Random().nextInt(3)];
    }

    @Override
    public boolean hasNext() {
        return true;
    }
}
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python yield from | Java |
|------|-------------------|------|
| å§”æ‰˜è¯­æ³• | `yield from sub()` | æ‰‹åŠ¨è¿­ä»£ |
| ç®€æ´æ€§ | ä¸€è¡Œä»£ç  | éœ€è¦çŠ¶æ€ç®¡ç† |
| è‡ªåŠ¨åŒ– | âœ… è‡ªåŠ¨è¿­ä»£ | âŒ æ‰‹åŠ¨å¾ªç¯ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **`yield from` è‡ªåŠ¨è¿­ä»£å­ç”Ÿæˆå™¨**,éå¸¸æ–¹ä¾¿
- âœ… `yield from sub()` â‰ˆ `for item in sub(): yield item`
- ğŸ“Œ è®°å¿†: "yield from = å§”æ‰˜ç»™å­ç”Ÿæˆå™¨"

**ç›¸å…³æ–‡ä»¶:** `traffic_bikers_generator.py:7-21`

### 1.3 æ— é™ç”Ÿæˆå™¨

#### Python å®ç°
```python
from itertools import product
from string import ascii_uppercase as alphabet

def gen_license_plates():
    """ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„è½¦ç‰Œå·"""
    for letters in product(alphabet, repeat=3):
        letters = "".join(letters)
        if letters == 'GOV':  # è·³è¿‡æ”¿åºœè½¦ç‰Œ
            continue

        for numbers in range(1000):
            yield f'{letters} {numbers:03}'

# åˆ›å»ºç”Ÿæˆå™¨
license_plates = gen_license_plates()

# å¿«é€Ÿå‰è¿›åˆ°æŸä¸ªä½ç½®
for _ in range(4441888):
    next(license_plates)

# æŒ‰éœ€è·å–è½¦ç‰Œ
def new_registration(owner, plates_gen, registrations):
    if owner not in registrations:
        plate = next(plates_gen)
        registrations[owner] = plate
        return plate
    return None

registrations = {}
my_plate = new_registration("Jason", license_plates, registrations)
print(my_plate)  # ä¾‹å¦‚: DQV 888
```

**æ— é™ç”Ÿæˆå™¨çš„ä¼˜åŠ¿:**
- ä¸éœ€è¦é¢„å…ˆè®¡ç®—æ‰€æœ‰å€¼
- èŠ‚çœå†…å­˜ (åªä¿å­˜å½“å‰çŠ¶æ€)
- æ”¯æŒæ— é™åºåˆ— (å¦‚æ‰€æœ‰è½¦ç‰Œå·)
- å¯ä»¥å¿«é€Ÿè·³è¿‡ä¸éœ€è¦çš„å€¼

#### Java å¯¹æ¯”
```java
// Java - ä½¿ç”¨ Stream.generate() æˆ–è‡ªå®šä¹‰ Iterator
import java.util.stream.*;

// æ–¹å¼ 1: Stream.generate() (æ— çŠ¶æ€)
class LicensePlateSupplier implements Supplier<String> {
    private int index = 0;

    @Override
    public String get() {
        if (index >= 17576000) {  // 26^3 * 1000
            throw new NoSuchElementException();
        }

        int letterIndex = index / 1000;
        int number = index % 1000;
        index++;

        char c1 = (char) ('A' + (letterIndex / 676));
        char c2 = (char) ('A' + ((letterIndex / 26) % 26));
        char c3 = (char) ('A' + (letterIndex % 26));

        String letters = "" + c1 + c2 + c3;
        if (letters.equals("GOV")) {
            return get();  // è·³è¿‡
        }

        return String.format("%s %03d", letters, number);
    }
}

// ä½¿ç”¨
Stream<String> licensePlates = Stream.generate(new LicensePlateSupplier());

// è·³è¿‡å‰é¢çš„å€¼
licensePlates.skip(4441888)
    .limit(1)
    .forEach(System.out::println);
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python Generator | Java Stream |
|------|------------------|-------------|
| æ— é™åºåˆ— | `while True: yield` | `Stream.generate()` |
| å†…å­˜æ¶ˆè€— | æä½ (åªä¿å­˜çŠ¶æ€) | ä½ (æƒ°æ€§æ±‚å€¼) |
| å¿«é€Ÿå‰è¿› | `for _ in range(n): next()` | `skip(n)` |
| ç®€æ´æ€§ | ç®€æ´ | è¾ƒå†—é•¿ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… Python ç”Ÿæˆå™¨å¤©ç„¶æ”¯æŒæ— é™åºåˆ—
- âš ï¸ ä½¿ç”¨ `next()` é€ä¸ªè·å–å€¼,ç”¨ `skip` å¿«é€Ÿå‰è¿›
- âš ï¸ ç”Ÿæˆå™¨çŠ¶æ€ä¼šä¿ç•™,ä¸‹æ¬¡è°ƒç”¨ä»ä¸Šæ¬¡ä½ç½®ç»§ç»­
- ğŸ“Œ è®°å¿†: "ç”Ÿæˆå™¨ = æƒ°æ€§è®¡ç®— + çŠ¶æ€ä¿å­˜"

**ç›¸å…³æ–‡ä»¶:** `license_generator.py:5-12`

---

## 2. æ¨å¯¼å¼ (Comprehensions)

### 2.1 åˆ—è¡¨æ¨å¯¼å¼

#### Python å®ç°
```python
# åŸºæœ¬åˆ—è¡¨æ¨å¯¼å¼
orders = ['cold brew', 'lemongrass tea', 'chai latte', 'medium drip',
         'french press', 'mocha cappuccino', 'pumpkin spice latte']

# è¿‡æ»¤åŒ…å« 'drip' çš„è®¢å•
drip_orders = [order for order in orders if 'drip' in order]
print(drip_orders)  # ['medium drip', 'dark roast drip']

# ç­‰ä»·äºä¼ ç»Ÿ for å¾ªç¯
drip_orders = []
for order in orders:
    if 'drip' in order:
        drip_orders.append(order)

# è½¬æ¢å…ƒç´ 
upper_orders = [order.upper() for order in orders]

# å¸¦æ¡ä»¶çš„è½¬æ¢
prices = [4.95, 3.45, 5.45, 2.95]
expensive = [f"${p}" for p in prices if p > 4.0]
```

#### Java å¯¹æ¯”
```java
List<String> orders = List.of("cold brew", "lemongrass tea", "chai latte",
    "medium drip", "french press", "mocha cappuccino", "pumpkin spice latte");

// è¿‡æ»¤åŒ…å« 'drip' çš„è®¢å•
List<String> dripOrders = orders.stream()
    .filter(order -> order.contains("drip"))
    .collect(Collectors.toList());

// ä¼ ç»Ÿæ–¹å¼
List<String> dripOrders = new ArrayList<>();
for (String order : orders) {
    if (order.contains("drip")) {
        dripOrders.add(order);
    }
}

// è½¬æ¢å…ƒç´ 
List<String> upperOrders = orders.stream()
    .map(String::toUpperCase)
    .collect(Collectors.toList());

// å¸¦æ¡ä»¶çš„è½¬æ¢
List<Double> prices = List.of(4.95, 3.45, 5.45, 2.95);
List<String> expensive = prices.stream()
    .filter(p -> p > 4.0)
    .map(p -> "$" + p)
    .collect(Collectors.toList());
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python åˆ—è¡¨æ¨å¯¼å¼ | Java Stream |
|------|-------------------|-------------|
| è¯­æ³• | `[expr for x in list if cond]` | `stream().filter().map()` |
| è¿”å›å€¼ | åˆ—è¡¨ (ç«‹å³æ±‚å€¼) | éœ€è¦ collect() |
| åµŒå¥—å¾ªç¯ | `[x for a in A for x in a]` | `flatMap()` |
| å¯è¯»æ€§ | ç®€æ´ç›´è§‚ | é“¾å¼è°ƒç”¨ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… åˆ—è¡¨æ¨å¯¼å¼ â‰ˆ Java çš„ Stream.filter().map().collect()
- âš ï¸ **æ¨å¯¼å¼æ˜¯ç«‹å³æ±‚å€¼çš„**,ä¸æ˜¯æƒ°æ€§çš„
- âš ï¸ æ ¼å¼: `[è¡¨è¾¾å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡ if æ¡ä»¶]`
- ğŸ“Œ è®°å¿†: "æ¨å¯¼å¼ = ç®€æ´çš„è¿‡æ»¤+è½¬æ¢"

**ç›¸å…³æ–‡ä»¶:** `orders_comprehension.py:5`

### 2.2 å­—å…¸æ¨å¯¼å¼

#### Python å®ç°
```python
# å­—å…¸æ¨å¯¼å¼
squares = {n: n ** 2 for n in range(1, 11)}
print(squares)  # {1: 1, 2: 4, 3: 9, ..., 10: 100}

# å¸¦æ¡ä»¶çš„å­—å…¸æ¨å¯¼å¼
even_squares = {n: n ** 2 for n in range(1, 11) if n % 2 == 0}
print(even_squares)  # {2: 4, 4: 16, 6: 36, 8: 64, 10: 100}

# ä»ä¸¤ä¸ªåˆ—è¡¨åˆ›å»ºå­—å…¸
keys = ['a', 'b', 'c']
values = [1, 2, 3]
mapping = {k: v for k, v in zip(keys, values)}
print(mapping)  # {'a': 1, 'b': 2, 'c': 3}
```

#### Java å¯¹æ¯”
```java
// å­—å…¸æ¨å¯¼å¼
Map<Integer, Integer> squares = IntStream.rangeClosed(1, 10)
    .boxed()
    .collect(Collectors.toMap(n -> n, n -> n * n));

// å¸¦æ¡ä»¶çš„å­—å…¸æ¨å¯¼å¼
Map<Integer, Integer> evenSquares = IntStream.rangeClosed(1, 10)
    .filter(n -> n % 2 == 0)
    .boxed()
    .collect(Collectors.toMap(n -> n, n -> n * n));

// ä»ä¸¤ä¸ªåˆ—è¡¨åˆ›å»ºå­—å…¸
List<String> keys = List.of("a", "b", "c");
List<Integer> values = List.of(1, 2, 3);
Map<String, Integer> mapping = IntStream.range(0, keys.size())
    .boxed()
    .collect(Collectors.toMap(keys::get, values::get));
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python å­—å…¸æ¨å¯¼å¼ | Java |
|------|-------------------|------|
| è¯­æ³• | `{k: v for x in list}` | `stream().collect(toMap())` |
| ç®€æ´æ€§ | æç®€ | è¾ƒå†—é•¿ |
| å¯è¯»æ€§ | é«˜ | ä¸­ç­‰ |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… å­—å…¸æ¨å¯¼å¼ â‰ˆ Java çš„ `stream().collect(Collectors.toMap())`
- âš ï¸ æ ¼å¼: `{é”®è¡¨è¾¾å¼: å€¼è¡¨è¾¾å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡ if æ¡ä»¶}`
- ğŸ“Œ è®°å¿†: "å­—å…¸æ¨å¯¼å¼ = ç®€æ´åˆ›å»ºæ˜ å°„"

**ç›¸å…³æ–‡ä»¶:** `squares_dictionary_comprehension.py:1`

### 2.3 é›†åˆæ¨å¯¼å¼

#### Python å®ç°
```python
# é›†åˆæ¨å¯¼å¼ (è‡ªåŠ¨å»é‡)
numbers = [1, 2, 2, 3, 3, 3, 4, 4, 4, 4]
unique = {n for n in numbers}
print(unique)  # {1, 2, 3, 4}

# å¸¦æ¡ä»¶çš„é›†åˆæ¨å¯¼å¼
even_unique = {n for n in numbers if n % 2 == 0}
print(even_unique)  # {2, 4}
```

#### Java å¯¹æ¯”
```java
List<Integer> numbers = List.of(1, 2, 2, 3, 3, 3, 4, 4, 4, 4);

// é›†åˆæ¨å¯¼å¼
Set<Integer> unique = new HashSet<>(numbers);
// æˆ–ä½¿ç”¨ Stream
Set<Integer> unique = numbers.stream()
    .collect(Collectors.toSet());

// å¸¦æ¡ä»¶çš„é›†åˆæ¨å¯¼å¼
Set<Integer> evenUnique = numbers.stream()
    .filter(n -> n % 2 == 0)
    .collect(Collectors.toSet());
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… é›†åˆæ¨å¯¼å¼ â‰ˆ Java çš„ `stream().collect(Collectors.toSet())`
- âš ï¸ æ ¼å¼: `{è¡¨è¾¾å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡ if æ¡ä»¶}`
- âš ï¸ ä½¿ç”¨ `{}` ä¸”æ²¡æœ‰å†’å·å°±æ˜¯é›†åˆ,æœ‰å†’å·æ˜¯å­—å…¸
- ğŸ“Œ è®°å¿†: "é›†åˆæ¨å¯¼å¼ = è‡ªåŠ¨å»é‡çš„åˆ—è¡¨æ¨å¯¼å¼"

---

## 3. åç¨‹ (Coroutines)

### 3.1 åç¨‹åŸºç¡€

#### Python å®ç°
```python
def coroutine():
    """ç®€å•çš„åç¨‹ç¤ºä¾‹"""
    ret = None
    while True:
        print("...")
        recv = yield ret  # äº§å‡ºå€¼,å¹¶æ¥æ”¶å‘é€çš„å€¼
        print(f"recv: {recv}")
        ret = recv

# åˆ›å»ºåç¨‹
co = coroutine()

# å¯åŠ¨åç¨‹ (é¢„æ¿€æ´»)
current = co.send(None)  # æˆ– next(co)
print(f"current (ret): {current}")  # None

# å‘é€å€¼åˆ°åç¨‹
for i in range(5):
    current = co.send(i)
    print(f"current (ret): {current}")

# å…³é—­åç¨‹
co.close()
```

**åç¨‹çš„å·¥ä½œæµç¨‹:**
1. `co.send(None)` æˆ– `next(co)` å¯åŠ¨åç¨‹ (é¢„æ¿€æ´»)
2. æ‰§è¡Œåˆ° `yield ret`,äº§å‡º `ret` å¹¶æš‚åœ
3. `co.send(value)` å‘é€å€¼åˆ°åç¨‹,èµ‹ç»™ `recv`
4. åç¨‹ç»§ç»­æ‰§è¡Œ,ç›´åˆ°ä¸‹ä¸€ä¸ª `yield`
5. `co.close()` å…³é—­åç¨‹

#### Java å¯¹æ¯”
Java æ²¡æœ‰å†…ç½®çš„åç¨‹æ”¯æŒ,éœ€è¦ä½¿ç”¨çº¿ç¨‹æˆ–å…¶ä»–å¹¶å‘å·¥å…·:

```java
// Java - ä½¿ç”¨ BlockingQueue æ¨¡æ‹Ÿåç¨‹
import java.util.concurrent.*;

class Coroutine {
    private BlockingQueue<Integer> inputQueue = new LinkedBlockingQueue<>();
    private BlockingQueue<Integer> outputQueue = new LinkedBlockingQueue<>();
    private Thread thread;

    public Coroutine() {
        thread = new Thread(() -> {
            Integer ret = null;
            while (true) {
                try {
                    System.out.println("...");
                    outputQueue.put(ret != null ? ret : 0);  // yield
                    Integer recv = inputQueue.take();  // receive
                    System.out.println("recv: " + recv);
                    ret = recv;
                } catch (InterruptedException e) {
                    break;
                }
            }
        });
        thread.start();
    }

    public Integer send(Integer value) throws InterruptedException {
        inputQueue.put(value);
        return outputQueue.take();
    }

    public void close() {
        thread.interrupt();
    }
}

// ä½¿ç”¨
Coroutine co = new Coroutine();
Integer current = co.send(0);  // å¯åŠ¨
for (int i = 0; i < 5; i++) {
    current = co.send(i);
    System.out.println("current: " + current);
}
co.close();
```

#### ğŸ”‘ æ ¸å¿ƒå·®å¼‚
| ç‰¹æ€§ | Python Coroutine | Java |
|------|------------------|------|
| åŸç”Ÿæ”¯æŒ | âœ… `yield` æ¥æ”¶å€¼ | âŒ éœ€è¦çº¿ç¨‹æ¨¡æ‹Ÿ |
| è¯­æ³• | `recv = yield ret` | BlockingQueue |
| ç®€æ´æ€§ | æç®€ | éå¸¸å†—é•¿ |
| æ€§èƒ½ | è½»é‡çº§ (æ— çº¿ç¨‹) | é‡é‡çº§ (éœ€è¦çº¿ç¨‹) |

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ **Python åç¨‹æ˜¯å•çº¿ç¨‹çš„**,æ¯” Java çº¿ç¨‹æ›´è½»é‡
- âš ï¸ `yield` æ—¢å¯ä»¥äº§å‡ºå€¼,ä¹Ÿå¯ä»¥æ¥æ”¶å€¼
- âš ï¸ åç¨‹éœ€è¦å…ˆè°ƒç”¨ `send(None)` æˆ– `next()` æ¥é¢„æ¿€æ´»
- ğŸ“Œ è®°å¿†: "åç¨‹ = å¯ä»¥åŒå‘é€šä¿¡çš„ç”Ÿæˆå™¨"

**ç›¸å…³æ–‡ä»¶:** `coroutine_sequence.py:1-8`

### 3.2 åç¨‹å®é™…åº”ç”¨

#### Python å®ç°
```python
from random import choice

def color_counter(color):
    """ç»Ÿè®¡ç‰¹å®šé¢œè‰²è½¦è¾†çš„åç¨‹"""
    matches = 0
    while True:
        vehicle = yield matches  # äº§å‡ºå½“å‰è®¡æ•°,æ¥æ”¶è½¦è¾†
        if color in vehicle:
            matches += 1

def traffic():
    """ç”Ÿæˆéšæœºè½¦è¾†çš„ç”Ÿæˆå™¨"""
    colors = ['red', 'green', 'blue', 'silver']
    vehicles = ['car', 'truck', 'motorcycle']

    while True:
        vehicle = choice(vehicles)
        color = choice(colors)
        yield f"{color} {vehicle}"

# åˆ›å»ºåç¨‹å¹¶é¢„æ¿€æ´»
counter = color_counter('red')
next(counter)  # é¢„æ¿€æ´»

# ä½¿ç”¨åç¨‹å¤„ç†æ•°æ®æµ
matches = 0
for count, vehicle in enumerate(traffic(), start=1):
    if count < 100:
        matches = counter.send(vehicle)  # å‘é€è½¦è¾†,æ¥æ”¶è®¡æ•°
    else:
        counter.close()
        break

print(f"There were {matches} red vehicles.")
```

**åç¨‹çš„ä¼˜åŠ¿:**
- ç»´æŠ¤å†…éƒ¨çŠ¶æ€ (è®¡æ•°å™¨)
- æ¥æ”¶å¤–éƒ¨æ•°æ® (è½¦è¾†ä¿¡æ¯)
- è¿”å›å¤„ç†ç»“æœ (åŒ¹é…æ•°)
- å•çº¿ç¨‹,æ— é”,æ— ç«æ€æ¡ä»¶

#### Java å¯¹æ¯”
```java
// Java - éœ€è¦æ˜¾å¼çš„çŠ¶æ€ç±»
class ColorCounter {
    private int matches = 0;
    private String targetColor;

    public ColorCounter(String color) {
        this.targetColor = color;
    }

    public int process(String vehicle) {
        if (vehicle.contains(targetColor)) {
            matches++;
        }
        return matches;
    }
}

// ä½¿ç”¨
ColorCounter counter = new ColorCounter("red");
int matches = 0;
for (int count = 1; count <= 100; count++) {
    String vehicle = generateRandomVehicle();
    matches = counter.process(vehicle);
}
System.out.println("There were " + matches + " red vehicles.");
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… åç¨‹é€‚åˆæœ‰çŠ¶æ€çš„æ•°æ®å¤„ç†æµæ°´çº¿
- âš ï¸ åç¨‹æ¯”æ™®é€šå‡½æ•°æ›´å¼ºå¤§:èƒ½ä¿å­˜çŠ¶æ€å¹¶åŒå‘é€šä¿¡
- âš ï¸ Java é€šå¸¸ç”¨æ™®é€šç±»å’Œæ–¹æ³•å®ç°ç›¸åŒåŠŸèƒ½
- ğŸ“Œ è®°å¿†: "åç¨‹ = æœ‰çŠ¶æ€çš„æ•°æ®å¤„ç†å™¨"

**ç›¸å…³æ–‡ä»¶:** `traffic_colors_coroutine.py:4-9`

---

## 4. ç”Ÿæˆå™¨é«˜çº§ç‰¹æ€§

### 4.1 generator.close() - å…³é—­ç”Ÿæˆå™¨

#### Python å®ç°
```python
from random import choice

def traffic():
    colors = ['red', 'green', 'blue']
    vehicles = ['car', 'truck', 'motorcycle']

    while True:
        vehicle = choice(vehicles)
        color = choice(colors)
        try:
            yield f"{color} {vehicle}"
        except GeneratorExit:
            print("No more vehicles.")
            raise  # å¿…é¡»é‡æ–°æŠ›å‡º

def car_wash(traffic_gen, limit):
    count = 0
    for vehicle in traffic_gen:
        print(f"Washing {vehicle}.")
        count += 1
        if count >= limit:
            traffic_gen.close()  # å…³é—­ç”Ÿæˆå™¨

queue = traffic()
car_wash(queue, 10)
```

**`close()` çš„ä½œç”¨:**
- åœ¨ç”Ÿæˆå™¨å†…éƒ¨æŠ›å‡º `GeneratorExit` å¼‚å¸¸
- ç”Ÿæˆå™¨åº”è¯¥æ•è·å¹¶é‡æ–°æŠ›å‡ºè¯¥å¼‚å¸¸
- ç”¨äºæ¸…ç†èµ„æº (å¦‚å…³é—­æ–‡ä»¶ã€ç½‘ç»œè¿æ¥)

#### Java å¯¹æ¯”
```java
// Java - å®ç° AutoCloseable
class TrafficIterator implements Iterator<String>, AutoCloseable {
    private boolean closed = false;

    @Override
    public boolean hasNext() {
        return !closed;
    }

    @Override
    public String next() {
        if (closed) {
            throw new NoSuchElementException();
        }
        // ç”Ÿæˆè½¦è¾†...
        return "red car";
    }

    @Override
    public void close() {
        closed = true;
        System.out.println("No more vehicles.");
    }
}

// ä½¿ç”¨ try-with-resources
try (TrafficIterator traffic = new TrafficIterator()) {
    int count = 0;
    while (traffic.hasNext() && count < 10) {
        System.out.println("Washing " + traffic.next());
        count++;
    }
}  // è‡ªåŠ¨è°ƒç”¨ close()
```

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âœ… `generator.close()` â‰ˆ Java çš„ `AutoCloseable.close()`
- âš ï¸ ç”Ÿæˆå™¨å†…éƒ¨ä¼šæ”¶åˆ° `GeneratorExit` å¼‚å¸¸
- âš ï¸ ç”¨äºèµ„æºæ¸…ç†å’Œä¼˜é›…ç»ˆæ­¢
- ğŸ“Œ è®°å¿†: "close() = é€šçŸ¥ç”Ÿæˆå™¨åœæ­¢å¹¶æ¸…ç†"

**ç›¸å…³æ–‡ä»¶:** `traffic_infinite_generator.py:11-15`

### 4.2 generator.throw() - æŠ›å‡ºå¼‚å¸¸

#### Python å®ç°
```python
def traffic():
    colors = ['red', 'green', 'blue']
    vehicles = ['car', 'truck']

    while True:
        try:
            vehicle = choice(vehicles)
            color = choice(colors)
            yield f"{color} {vehicle}"
        except ValueError as e:
            print(f"Error: {e}")
            yield "emergency vehicle"  # äº§å‡ºç´§æ€¥è½¦è¾†

# ä½¿ç”¨
queue = traffic()
print(next(queue))  # æ­£å¸¸è½¦è¾†

# å‘ç”Ÿæˆå™¨å‘é€å¼‚å¸¸
result = queue.throw(ValueError, "Accident ahead!")
print(result)  # emergency vehicle
```

**`throw()` çš„ä½œç”¨:**
- åœ¨ç”Ÿæˆå™¨æš‚åœå¤„æŠ›å‡ºæŒ‡å®šå¼‚å¸¸
- ç”Ÿæˆå™¨å¯ä»¥æ•è·å¹¶å¤„ç†å¼‚å¸¸
- ç”¨äºé”™è¯¯å¤„ç†å’ŒçŠ¶æ€åˆ‡æ¢

#### ğŸ’¡ Javaer æ³¨æ„äº‹é¡¹
- âš ï¸ `throw()` è®©ç”Ÿæˆå™¨å†…éƒ¨æŠ›å‡ºå¼‚å¸¸
- âš ï¸ Java çš„ Iterator æ²¡æœ‰å¯¹åº”æ¦‚å¿µ
- ğŸ“Œ è®°å¿†: "throw() = å‘ç”Ÿæˆå™¨å‘é€å¼‚å¸¸ä¿¡å·"

---

## 5. æ€»ç»“å¯¹æ¯”è¡¨

### Python vs Java ç”Ÿæˆå™¨ä¸æ¨å¯¼å¼

| ç‰¹æ€§ | Python | Java |
|------|--------|------|
| **ç”Ÿæˆå™¨** | `yield` å…³é”®å­— | Iterator æ¥å£ |
| **å§”æ‰˜ç”Ÿæˆå™¨** | `yield from` | æ‰‹åŠ¨è¿­ä»£ |
| **æ— é™åºåˆ—** | `while True: yield` | `Stream.generate()` |
| **åˆ—è¡¨æ¨å¯¼å¼** | `[x for x in list if cond]` | `stream().filter().collect()` |
| **å­—å…¸æ¨å¯¼å¼** | `{k: v for x in list}` | `collect(toMap())` |
| **é›†åˆæ¨å¯¼å¼** | `{x for x in list}` | `collect(toSet())` |
| **åç¨‹** | `recv = yield ret` | éœ€è¦çº¿ç¨‹/é˜Ÿåˆ— |
| **å…³é—­ç”Ÿæˆå™¨** | `gen.close()` | `AutoCloseable` |
| **æŠ›å‡ºå¼‚å¸¸** | `gen.throw()` | âŒ ä¸æ”¯æŒ |
| **æƒ°æ€§æ±‚å€¼** | âœ… ç”Ÿæˆå™¨å¤©ç„¶ | Stream API |
| **çŠ¶æ€ä¿å­˜** | âœ… è‡ªåŠ¨ | éœ€è¦å®ä¾‹å˜é‡ |

---

## 6. å­¦ä¹ è·¯å¾„å»ºè®®

1. **ç†è§£ yield** - ç”Ÿæˆå™¨çš„æ ¸å¿ƒæ¦‚å¿µ
2. **æŒæ¡æ¨å¯¼å¼** - ç®€æ´çš„æ•°æ®å¤„ç†
3. **å­¦ä¹ ç”Ÿæˆå™¨è¡¨è¾¾å¼** - æƒ°æ€§æ±‚å€¼çš„æ¨å¯¼å¼
4. **äº†è§£åç¨‹** - åŒå‘é€šä¿¡çš„ç”Ÿæˆå™¨
5. **å®è·µæ— é™åºåˆ—** - èŠ‚çœå†…å­˜çš„æŠ€å·§
6. **å¯¹æ¯” Java Stream** - å»ºç«‹å¿ƒæ™ºæ¨¡å‹

---

## ğŸ“Š å‚è€ƒæ–‡ä»¶ç´¢å¼•

| ä¸»é¢˜ | æ–‡ä»¶å |
|------|--------|
| ç”Ÿæˆå™¨åŸºç¡€ | `traffic_generator_class.py` |
| yield from | `traffic_bikers_generator.py` |
| æ— é™ç”Ÿæˆå™¨ | `license_generator.py` |
| åˆ—è¡¨æ¨å¯¼å¼ | `orders_comprehension.py` |
| å­—å…¸æ¨å¯¼å¼ | `squares_dictionary_comprehension.py` |
| åç¨‹åŸºç¡€ | `coroutine_sequence.py` |
| åç¨‹åº”ç”¨ | `traffic_colors_coroutine.py` |
| å…³é—­ç”Ÿæˆå™¨ | `traffic_infinite_generator.py` |

---

**åˆ¶ä½œæ—¶é—´:** 2025-11-25
**åŸºäº:** DeadSimplePython Chapter 10 ç¤ºä¾‹ä»£ç 
**è§„èŒƒå‚è€ƒ:** `Pythonå­¦ä¹ ç¬”è®°è§„èŒƒ_for_Javaer.md`